const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-D9jm4vDm.js","assets/vendor-CurW8Zcn.js"])))=>i.map(i=>d[i]);
import{r as e,a as t,g as n,c as s,R as r,b as i,u as o,d as a,B as l,e as c,f as d}from"./vendor-CurW8Zcn.js";import{L as h,G as u,Q as p,B as f,I as m,a as g,b as y,U as v,C as b,X as w,M as x}from"./ui-CpPTyWS5.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var k={exports:{}},S={},C=e,T=Symbol.for("react.element"),O=Symbol.for("react.fragment"),E=Object.prototype.hasOwnProperty,N=C.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,M={key:!0,ref:!0,__self:!0,__source:!0};function j(e,t,n){var s,r={},i=null,o=null;for(s in void 0!==n&&(i=""+n),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(o=t.ref),t)E.call(t,s)&&!M.hasOwnProperty(s)&&(r[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===r[s]&&(r[s]=t[s]);return{$$typeof:T,type:e,key:i,ref:o,props:r,_owner:N.current}}S.Fragment=O,S.jsx=j,S.jsxs=j,k.exports=S;var _,A=k.exports,D=t;_=D.createRoot,D.hydrateRoot;const R=e.createContext({theme:"light",toggleTheme:()=>{}});function P({children:t}){const[n,s]=e.useState("light");return A.jsx(R.Provider,{value:{theme:n,toggleTheme:()=>{s((e=>"light"===e?"dark":"light"))}},children:t})}const I=()=>e.useContext(R),$={"For anyone":"Hi there, I'm a designer. I make beautiful things that make life better for people.",Recruiters:"A hands-on UX and product design leader known for creating impactful, user-centered solutions that drive measurable results.","Design Directors":"Bringing strategic thinking and creative excellence to every project.","Product Designers":"Empowering design teams with frameworks and mentorship to create scalable, high-quality experiences.","Product Managers":"Bridging user needs with business goals through design innovation.",Engineers:"Systems thinker, creating developer-friendly designs with technical feasibility in mind.",Executives:"Driving business growth through strategic design leadership and building design strategies that scale, from MVP to market-leading products."};function L(){const{theme:t}=I(),[n,s]=e.useState("For anyone");return A.jsx("div",{className:"min-h-screen flex flex-col w-full",children:A.jsx("div",{className:"flex-1 pt-24",children:A.jsxs("div",{className:"space-y-36",children:[A.jsxs("div",{className:"space-y-8",children:[A.jsx("div",{className:"w-screen relative left-[50%] right-[50%] -ml-[50vw] -mr-[50vw]",children:A.jsx("div",{className:"overflow-x-auto px-4 sm:px-6 lg:px-8",children:A.jsx("div",{className:"flex space-x-4 min-w-max pb-4 max-w-[100vw]",children:Object.keys($).map((e=>A.jsx("button",{onClick:()=>s(e),className:"audience-tag whitespace-nowrap "+(n===e?"dark"===t?"text-white":"text-black":""),children:e},e)))})})}),A.jsx("div",{className:"max-w-3xl",children:A.jsx("h2",{className:"headline",children:$[n]})})]}),A.jsx("img",{src:"/images/about.me.grid.png",alt:"career highlights",className:"w-full h-auto max-w-3xl"})]})})})}const B={},z=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),n=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));s=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in B)return;B[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,n&&r.setAttribute("nonce",n),document.head.appendChild(r),t?new Promise(((t,n)=>{r.addEventListener("load",t),r.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then((t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)}))};class F extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class H extends F{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class V extends F{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class U extends F{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var q,W;(W=q||(q={})).Any="any",W.ApNortheast1="ap-northeast-1",W.ApNortheast2="ap-northeast-2",W.ApSouth1="ap-south-1",W.ApSoutheast1="ap-southeast-1",W.ApSoutheast2="ap-southeast-2",W.CaCentral1="ca-central-1",W.EuCentral1="eu-central-1",W.EuWest1="eu-west-1",W.EuWest2="eu-west-2",W.EuWest3="eu-west-3",W.SaEast1="sa-east-1",W.UsEast1="us-east-1",W.UsWest1="us-west-1",W.UsWest2="us-west-2";var J=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(tm){i(tm)}}function a(e){try{l(s.throw(e))}catch(tm){i(tm)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};class K{constructor(e,{headers:t={},customFetch:n,region:s=q.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>z((async()=>{const{default:e}=await Promise.resolve().then((()=>ae));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)})(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return J(this,void 0,void 0,(function*(){try{const{headers:s,method:r,body:i}=t;let o,a={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(a["x-region"]=l),i&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",o=i):"string"==typeof i?(a["Content-Type"]="text/plain",o=i):"undefined"!=typeof FormData&&i instanceof FormData?o=i:(a["Content-Type"]="application/json",o=JSON.stringify(i)));const c=yield this.fetch(`${this.url}/${e}`,{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:o}).catch((e=>{throw new H(e)})),d=c.headers.get("x-relay-error");if(d&&"true"===d)throw new V(c);if(!c.ok)throw new U(c);let h,u=(null!==(n=c.headers.get("Content-Type"))&&void 0!==n?n:"text/plain").split(";")[0].trim();return h="application/json"===u?yield c.json():"application/octet-stream"===u?yield c.blob():"text/event-stream"===u?c:"multipart/form-data"===u?yield c.formData():yield c.text(),{data:h,error:null}}catch(s){return{data:null,error:s}}}))}}var G={},X={},Y={},Q={},Z={},ee={},te=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const ne=te.fetch,se=te.fetch.bind(te),re=te.Headers,ie=te.Request,oe=te.Response,ae=Object.freeze(Object.defineProperty({__proto__:null,Headers:re,Request:ie,Response:oe,default:se,fetch:ne},Symbol.toStringTag,{value:"Module"})),le=n(ae);var ce={};Object.defineProperty(ce,"__esModule",{value:!0});let de=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};ce.default=de;var he=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ee,"__esModule",{value:!0});const ue=he(le),pe=he(ce);ee.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=ue.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let n=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((async e=>{var t,n,s;let r=null,i=null,o=null,a=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(i="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const s=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(n=e.headers.get("content-range"))||void 0===n?void 0:n.split("/");s&&c&&c.length>1&&(o=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(i)&&(i.length>1?(r={code:"PGRST116",details:`Results contain ${i.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},i=null,o=null,a=406,l="Not Acceptable"):i=1===i.length?i[0]:null)}else{const t=await e.text();try{r=JSON.parse(t),Array.isArray(r)&&404===e.status&&(i=[],r=null,a=200,l="OK")}catch(c){404===e.status&&""===t?(a=204,l="No Content"):r={message:t}}if(r&&this.isMaybeSingle&&(null===(s=null==r?void 0:r.details)||void 0===s?void 0:s.includes("0 rows"))&&(r=null,a=200,l="OK"),r&&this.shouldThrowOnError)throw new pe.default(r)}return{error:r,data:i,count:o,status:a,statusText:l}}));return this.shouldThrowOnError||(n=n.catch((e=>{var t,n,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(n=null==e?void 0:e.stack)&&void 0!==n?n:""}`,hint:"",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}}))),n.then(e,t)}};var fe=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Z,"__esModule",{value:!0});const me=fe(ee);let ge=class extends me.default{select(e){let t=!1;const n=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e))).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:s,referencedTable:r=s}={}){const i=r?`${r}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===n?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){const s=void 0===n?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:s=n}={}){const r=void 0===s?"offset":`${s}.offset`,i=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:s=!1,wal:r=!1,format:i="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,n?"settings":null,s?"buffers":null,r?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Z.default=ge;var ye=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Q,"__esModule",{value:!0});const ve=ye(Z);let be=class extends ve.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const n=Array.from(new Set(t)).map((e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`)).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:s}={}){let r="";"plain"===s?r="pl":"phrase"===s?r="ph":"websearch"===s&&(r="w");const i=void 0===n?"":`(${n})`;return this.url.searchParams.append(e,`${r}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach((([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)})),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}};Q.default=be;var we=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Y,"__esModule",{value:!0});const xe=we(Q);Y.default=class{constructor(e,{headers:t={},schema:n,fetch:s}){this.url=e,this.headers=t,this.schema=n,this.fetch=s}select(e,{head:t=!1,count:n}={}){const s=t?"HEAD":"GET";let r=!1;const i=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!r?"":('"'===e&&(r=!r),e))).join("");return this.url.searchParams.set("select",i),n&&(this.headers.Prefer=`count=${n}`),new xe.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:n=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),n||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new xe.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:s,defaultToNull:r=!0}={}){const i=[`resolution=${n?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&i.push(this.headers.Prefer),s&&i.push(`count=${s}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new xe.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new xe.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new xe.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var ke={},Se={};Object.defineProperty(Se,"__esModule",{value:!0}),Se.version=void 0,Se.version="0.0.0-automated",Object.defineProperty(ke,"__esModule",{value:!0}),ke.DEFAULT_HEADERS=void 0;const Ce=Se;ke.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Ce.version}`};var Te=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(X,"__esModule",{value:!0});const Oe=Te(Y),Ee=Te(Q),Ne=ke;X.default=class e{constructor(e,{headers:t={},schema:n,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Ne.DEFAULT_HEADERS),t),this.schemaName=n,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new Oe.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:s=!1,count:r}={}){let i;const o=new URL(`${this.url}/rpc/${e}`);let a;n||s?(i=n?"HEAD":"GET",Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`])).forEach((([e,t])=>{o.searchParams.append(e,t)}))):(i="POST",a=t);const l=Object.assign({},this.headers);return r&&(l.Prefer=`count=${r}`),new Ee.default({method:i,url:o,headers:l,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};var Me=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(G,"__esModule",{value:!0}),G.PostgrestError=G.PostgrestBuilder=G.PostgrestTransformBuilder=G.PostgrestFilterBuilder=G.PostgrestQueryBuilder=G.PostgrestClient=void 0;const je=Me(X);G.PostgrestClient=je.default;const _e=Me(Y);G.PostgrestQueryBuilder=_e.default;const Ae=Me(Q);G.PostgrestFilterBuilder=Ae.default;const De=Me(Z);G.PostgrestTransformBuilder=De.default;const Re=Me(ee);G.PostgrestBuilder=Re.default;const Pe=Me(ce);G.PostgrestError=Pe.default;var Ie=G.default={PostgrestClient:je.default,PostgrestQueryBuilder:_e.default,PostgrestFilterBuilder:Ae.default,PostgrestTransformBuilder:De.default,PostgrestBuilder:Re.default,PostgrestError:Pe.default};const{PostgrestClient:$e,PostgrestQueryBuilder:Le,PostgrestFilterBuilder:Be,PostgrestTransformBuilder:ze,PostgrestBuilder:Fe,PostgrestError:He}=Ie,Ve={"X-Client-Info":"realtime-js/2.11.2"};var Ue,qe,We,Je,Ke,Ge,Xe,Ye,Qe,Ze,et;(qe=Ue||(Ue={}))[qe.connecting=0]="connecting",qe[qe.open=1]="open",qe[qe.closing=2]="closing",qe[qe.closed=3]="closed",(Je=We||(We={})).closed="closed",Je.errored="errored",Je.joined="joined",Je.joining="joining",Je.leaving="leaving",(Ge=Ke||(Ke={})).close="phx_close",Ge.error="phx_error",Ge.join="phx_join",Ge.reply="phx_reply",Ge.leave="phx_leave",Ge.access_token="access_token",(Xe||(Xe={})).websocket="websocket",(Qe=Ye||(Ye={})).Connecting="connecting",Qe.Open="open",Qe.Closing="closing",Qe.Closed="closed";class tt{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),r=t.getUint8(2);let i=this.HEADER_LENGTH+2;const o=n.decode(e.slice(i,i+s));i+=s;const a=n.decode(e.slice(i,i+r));i+=r;return{ref:null,topic:o,event:a,payload:JSON.parse(n.decode(e.slice(i,e.byteLength)))}}}class nt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}(et=Ze||(Ze={})).abstime="abstime",et.bool="bool",et.date="date",et.daterange="daterange",et.float4="float4",et.float8="float8",et.int2="int2",et.int4="int4",et.int4range="int4range",et.int8="int8",et.int8range="int8range",et.json="json",et.jsonb="jsonb",et.money="money",et.numeric="numeric",et.oid="oid",et.reltime="reltime",et.text="text",et.time="time",et.timestamp="timestamp",et.timestamptz="timestamptz",et.timetz="timetz",et.tsrange="tsrange",et.tstzrange="tstzrange";const st=(e,t,n={})=>{var s;const r=null!==(s=n.skipTypes)&&void 0!==s?s:[];return Object.keys(t).reduce(((n,s)=>(n[s]=rt(s,e,t,r),n)),{})},rt=(e,t,n,s)=>{const r=t.find((t=>t.name===e)),i=null==r?void 0:r.type,o=n[e];return i&&!s.includes(i)?it(i,o):ot(o)},it=(e,t)=>{if("_"===e.charAt(0)){const n=e.slice(1,e.length);return dt(t,n)}switch(e){case Ze.bool:return at(t);case Ze.float4:case Ze.float8:case Ze.int2:case Ze.int4:case Ze.int8:case Ze.numeric:case Ze.oid:return lt(t);case Ze.json:case Ze.jsonb:return ct(t);case Ze.timestamp:return ht(t);case Ze.abstime:case Ze.date:case Ze.daterange:case Ze.int4range:case Ze.int8range:case Ze.money:case Ze.reltime:case Ze.text:case Ze.time:case Ze.timestamptz:case Ze.timetz:case Ze.tsrange:case Ze.tstzrange:default:return ot(t)}},ot=e=>e,at=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},lt=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},ct=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},dt=(e,t)=>{if("string"!=typeof e)return e;const n=e.length-1,s=e[n];if("{"===e[0]&&"}"===s){let s;const i=e.slice(1,n);try{s=JSON.parse("["+i+"]")}catch(r){s=i?i.split(","):[]}return s.map((e=>it(t,e)))}return e},ht=e=>"string"==typeof e?e.replace(" ","T"):e,ut=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class pt{constructor(e,t,n={},s=1e4){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t(null===(n=this.receivedResp)||void 0===n?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ft,mt,gt,yt,vt,bt,wt,xt;(mt=ft||(ft={})).SYNC="sync",mt.JOIN="join",mt.LEAVE="leave";class kt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},(e=>{const{onJoin:t,onLeave:n,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=kt.syncState(this.state,e,t,n),this.pendingDiffs.forEach((e=>{this.state=kt.syncDiff(this.state,e,t,n)})),this.pendingDiffs=[],s()})),this.channel._on(n.diff,{},(e=>{const{onJoin:t,onLeave:n,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=kt.syncDiff(this.state,e,t,n),s())})),this.onJoin(((e,t,n)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:n})})),this.onLeave(((e,t,n)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:n})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,n,s){const r=this.cloneDeep(e),i=this.transformState(t),o={},a={};return this.map(r,((e,t)=>{i[e]||(a[e]=t)})),this.map(i,((e,t)=>{const n=r[e];if(n){const s=t.map((e=>e.presence_ref)),r=n.map((e=>e.presence_ref)),i=t.filter((e=>r.indexOf(e.presence_ref)<0)),l=n.filter((e=>s.indexOf(e.presence_ref)<0));i.length>0&&(o[e]=i),l.length>0&&(a[e]=l)}else o[e]=t})),this.syncDiff(r,{joins:o,leaves:a},n,s)}static syncDiff(e,t,n,s){const{joins:r,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(r,((t,s)=>{var r;const i=null!==(r=e[t])&&void 0!==r?r:[];if(e[t]=this.cloneDeep(s),i.length>0){const n=e[t].map((e=>e.presence_ref)),s=i.filter((e=>n.indexOf(e.presence_ref)<0));e[t].unshift(...s)}n(t,i,s)})),this.map(i,((t,n)=>{let r=e[t];if(!r)return;const i=n.map((e=>e.presence_ref));r=r.filter((e=>i.indexOf(e.presence_ref)<0)),e[t]=r,s(t,r,n),0===r.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((n=>t(n,e[n])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,n)=>{const s=e[n];return t[n]="metas"in s?s.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):s,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(yt=gt||(gt={})).ALL="*",yt.INSERT="INSERT",yt.UPDATE="UPDATE",yt.DELETE="DELETE",(bt=vt||(vt={})).BROADCAST="broadcast",bt.PRESENCE="presence",bt.POSTGRES_CHANGES="postgres_changes",bt.SYSTEM="system",(xt=wt||(wt={})).SUBSCRIBED="SUBSCRIBED",xt.TIMED_OUT="TIMED_OUT",xt.CLOSED="CLOSED",xt.CHANNEL_ERROR="CHANNEL_ERROR";class St{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=We.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new pt(this,Ke.join,this.params,this.timeout),this.rejoinTimer=new nt((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=We.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=We.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=We.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=We.errored,this.rejoinTimer.scheduleTimeout())})),this._on(Ke.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new kt(this),this.broadcastEndpointURL=ut(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:r,presence:i,private:o}}=this.params;this._onError((t=>null==e?void 0:e(wt.CHANNEL_ERROR,t))),this._onClose((()=>null==e?void 0:e(wt.CLOSED)));const a={},l={broadcast:r,presence:i,postgres_changes:null!==(s=null===(n=this.bindings.postgres_changes)||void 0===n?void 0:n.map((e=>e.filter)))&&void 0!==s?s:[],private:o};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(async({postgres_changes:t})=>{var n;if(this.socket.setAuth(),void 0!==t){const s=this.bindings.postgres_changes,r=null!==(n=null==s?void 0:s.length)&&void 0!==n?n:0,i=[];for(let n=0;n<r;n++){const r=s[n],{filter:{event:o,schema:a,table:l,filter:c}}=r,d=t&&t[n];if(!d||d.event!==o||d.schema!==a||d.table!==l||d.filter!==c)return this.unsubscribe(),void(null==e||e(wt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},r),{id:d.id}))}return this.bindings.postgres_changes=i,void(e&&e(wt.SUBSCRIBED))}null==e||e(wt.SUBSCRIBED)})).receive("error",(t=>{null==e||e(wt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{null==e||e(wt.TIMED_OUT)}))}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this._on(e,t,n)}async send(e,t={}){var n,s;if(this._canPush()||"broadcast"!==e.type)return new Promise((n=>{var s,r,i;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(r=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===r?void 0:r.broadcast)||void 0===i?void 0:i.ack)||n("ok"),o.receive("ok",(()=>n("ok"))),o.receive("error",(()=>n("error"))),o.receive("timeout",(()=>n("timed out")))}));{const{event:i,payload:o}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(n=t.timeout)&&void 0!==n?n:this.timeout);return await(null===(s=e.body)||void 0===s?void 0:s.cancel()),e.ok?"ok":"error"}catch(r){return"AbortError"===r.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=We.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ke.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise((n=>{const s=new pt(this,Ke.leave,{},e);s.receive("ok",(()=>{t(),n("ok")})).receive("timeout",(()=>{t(),n("timed out")})).receive("error",(()=>{n("error")})),s.send(),this._canPush()||s.trigger("ok",{})}))}async _fetchWithTimeout(e,t,n){const s=new AbortController,r=setTimeout((()=>s.abort()),n),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(r),i}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new pt(this,e,t,n);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,r;const i=e.toLocaleLowerCase(),{close:o,error:a,leave:l,join:c}=Ke;if(n&&[o,a,l,c].indexOf(i)>=0&&n!==this._joinRef())return;let d=this._onMessage(i,t,n);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter((e=>{var t,n,s;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(n=e.filter)||void 0===n?void 0:n.event)||void 0===s?void 0:s.toLocaleLowerCase())===i})).map((e=>e.callback(d,n))):null===(r=this.bindings[i])||void 0===r||r.filter((e=>{var n,s,r,o,a,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,o=null===(n=e.filter)||void 0===n?void 0:n.event;return i&&(null===(s=t.ids)||void 0===s?void 0:s.includes(i))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(r=t.data)||void 0===r?void 0:r.type.toLocaleLowerCase()))}{const n=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===n||n===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i})).map((e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:n,commit_timestamp:s,type:r,errors:i}=e,o={schema:t,table:n,commit_timestamp:s,eventType:r,new:{},old:{},errors:i};d=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(d,n)}))}_isClosed(){return this.state===We.closed}_isJoined(){return this.state===We.joined}_isJoining(){return this.state===We.joining}_isLeaving(){return this.state===We.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),r={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(r):this.bindings[s]=[r],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter((e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===n&&St.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ke.close,{},e)}_onError(e){this._on(Ke.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=We.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=st(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=st(e.columns,e.old_record)),t}}const Ct=()=>{},Tt="undefined"!=typeof WebSocket;class Ot{constructor(e,t){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Ve,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ct,this.conn=null,this.sendBuffer=[],this.serializer=new tt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>z((async()=>{const{default:e}=await Promise.resolve().then((()=>ae));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${Xe.websocket}`,this.httpEndpoint=ut(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=null===(n=null==t?void 0:t.params)||void 0===n?void 0:n.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new nt((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn)if(this.transport)this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});else{if(Tt)return this.conn=new WebSocket(this.endpointURL()),void this.setupConnection();this.conn=new Et(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),z((async()=>{const{default:e}=await import("./browser-D9jm4vDm.js").then((e=>e.b));return{default:e}}),__vite__mapDeps([0,1])).then((({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()}))}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map((e=>e.unsubscribe())));return this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Ue.connecting:return Ye.Connecting;case Ue.open:return Ye.Open;case Ue.closing:return Ye.Closing;default:return Ye.Closed}}isConnected(){return this.connectionState()===Ye.Open}channel(e,t={config:{}}){const n=new St(`realtime:${e}`,t,this);return this.channels.push(n),n}push(e){const{topic:t,event:n,payload:s,ref:r}=e,i=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};this.log("push",`${t} ${n} (${r})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let e=null;try{e=JSON.parse(atob(t.split(".")[1]))}catch(n){}if(e&&e.exp){if(!(Math.floor(Date.now()/1e3)-e.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`)}this.accessTokenValue=t,this.channels.forEach((e=>{t&&e.updateJoinPayload({access_token:t}),e.joinedOnce&&e._isJoined()&&e._push(Ke.access_token,{access_token:t})}))}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t._joinRef()!==e._joinRef()))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:n,payload:s,ref:r}=e;r&&r===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${t} ${n} ${r&&"("+r+")"||""}`,s),this.channels.filter((e=>e._isMember(t))).forEach((e=>e._trigger(n,s,r))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(Ke.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const n=e.match(/\?/)?"&":"?";return`${e}${n}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class Et{constructor(e,t,n){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Ue.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=n.close}}class Nt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Mt(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class jt extends Nt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class _t extends Nt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var At=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(tm){i(tm)}}function a(e){try{l(s.throw(e))}catch(tm){i(tm)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const Dt=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>z((async()=>{const{default:e}=await Promise.resolve().then((()=>ae));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},Rt=e=>{if(Array.isArray(e))return e.map((e=>Rt(e)));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach((([e,n])=>{const s=e.replace(/([-_][a-z])/gi,(e=>e.toUpperCase().replace(/[-_]/g,"")));t[s]=Rt(n)})),t};var Pt=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(tm){i(tm)}}function a(e){try{l(s.throw(e))}catch(tm){i(tm)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const It=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),$t=(e,t,n)=>Pt(void 0,void 0,void 0,(function*(){const s=yield At(void 0,void 0,void 0,(function*(){return"undefined"==typeof Response?(yield z((()=>Promise.resolve().then((()=>ae))),void 0)).Response:Response}));e instanceof s&&!(null==n?void 0:n.noResolveJson)?e.json().then((n=>{t(new jt(It(n),e.status||500))})).catch((e=>{t(new _t(It(e),e))})):t(new _t(It(e),e))}));function Lt(e,t,n,s,r,i){return Pt(this,void 0,void 0,(function*(){return new Promise(((o,a)=>{e(n,((e,t,n,s)=>{const r={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?r:(r.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),s&&(r.body=JSON.stringify(s)),Object.assign(Object.assign({},r),n))})(t,s,r,i)).then((e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()})).then((e=>o(e))).catch((e=>$t(e,a,s)))}))}))}function Bt(e,t,n,s){return Pt(this,void 0,void 0,(function*(){return Lt(e,"GET",t,n,s)}))}function zt(e,t,n,s,r){return Pt(this,void 0,void 0,(function*(){return Lt(e,"POST",t,s,r,n)}))}function Ft(e,t,n,s,r){return Pt(this,void 0,void 0,(function*(){return Lt(e,"DELETE",t,s,r,n)}))}var Ht=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(tm){i(tm)}}function a(e){try{l(s.throw(e))}catch(tm){i(tm)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const Vt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ut={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class qt{constructor(e,t={},n,s){this.url=e,this.headers=t,this.bucketId=n,this.fetch=Dt(s)}uploadOrUpdate(e,t,n,s){return Ht(this,void 0,void 0,(function*(){try{let r;const i=Object.assign(Object.assign({},Ut),s);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const a=i.metadata;"undefined"!=typeof Blob&&n instanceof Blob?(r=new FormData,r.append("cacheControl",i.cacheControl),a&&r.append("metadata",this.encodeMetadata(a)),r.append("",n)):"undefined"!=typeof FormData&&n instanceof FormData?(r=n,r.append("cacheControl",i.cacheControl),a&&r.append("metadata",this.encodeMetadata(a))):(r=n,o["cache-control"]=`max-age=${i.cacheControl}`,o["content-type"]=i.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==s?void 0:s.headers)&&(o=Object.assign(Object.assign({},o),s.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:r,headers:o},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{})),h=yield d.json();if(d.ok)return{data:{path:l,id:h.Id,fullPath:h.Key},error:null};return{data:null,error:h}}catch(r){if(Mt(r))return{data:null,error:r};throw r}}))}upload(e,t,n){return Ht(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,n)}))}uploadToSignedUrl(e,t,n,s){return Ht(this,void 0,void 0,(function*(){const r=this._removeEmptyFolders(e),i=this._getFinalPath(r),o=new URL(this.url+`/object/upload/sign/${i}`);o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:Ut.upsert},s),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&n instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",n)):"undefined"!=typeof FormData&&n instanceof FormData?(e=n,e.append("cacheControl",t.cacheControl)):(e=n,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType);const a=yield this.fetch(o.toString(),{method:"PUT",body:e,headers:i}),l=yield a.json();if(a.ok)return{data:{path:r,fullPath:l.Key},error:null};return{data:null,error:l}}catch(a){if(Mt(a))return{data:null,error:a};throw a}}))}createSignedUploadUrl(e,t){return Ht(this,void 0,void 0,(function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const r=yield zt(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),i=new URL(this.url+r.url),o=i.searchParams.get("token");if(!o)throw new Nt("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:o},error:null}}catch(n){if(Mt(n))return{data:null,error:n};throw n}}))}update(e,t,n){return Ht(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,n)}))}move(e,t,n){return Ht(this,void 0,void 0,(function*(){try{return{data:yield zt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==n?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Mt(s))return{data:null,error:s};throw s}}))}copy(e,t,n){return Ht(this,void 0,void 0,(function*(){try{return{data:{path:(yield zt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==n?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Mt(s))return{data:null,error:s};throw s}}))}createSignedUrl(e,t,n){return Ht(this,void 0,void 0,(function*(){try{let s=this._getFinalPath(e),r=yield zt(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==n?void 0:n.transform)?{transform:n.transform}:{}),{headers:this.headers});const i=(null==n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${i}`)},{data:r,error:null}}catch(s){if(Mt(s))return{data:null,error:s};throw s}}))}createSignedUrls(e,t,n){return Ht(this,void 0,void 0,(function*(){try{const s=yield zt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),r=(null==n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return{data:s.map((e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${r}`):null}))),error:null}}catch(s){if(Mt(s))return{data:null,error:s};throw s}}))}download(e,t){return Ht(this,void 0,void 0,(function*(){const n=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),r=s?`?${s}`:"";try{const t=this._getFinalPath(e),s=yield Bt(this.fetch,`${this.url}/${n}/${t}${r}`,{headers:this.headers,noResolveJson:!0});return{data:yield s.blob(),error:null}}catch(i){if(Mt(i))return{data:null,error:i};throw i}}))}info(e){return Ht(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{const e=yield Bt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Rt(e),error:null}}catch(n){if(Mt(n))return{data:null,error:n};throw n}}))}exists(e){return Ht(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{return yield function(e,t,n,s){return Pt(this,void 0,void 0,(function*(){return Lt(e,"HEAD",t,Object.assign(Object.assign({},n),{noResolveJson:!0}),s)}))}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Mt(n)&&n instanceof _t){const e=n.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:n}}throw n}}))}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],r=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==r&&s.push(r);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&s.push(o);let a=s.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${a}`)}}}remove(e){return Ht(this,void 0,void 0,(function*(){try{return{data:yield Ft(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Mt(t))return{data:null,error:t};throw t}}))}list(e,t,n){return Ht(this,void 0,void 0,(function*(){try{const s=Object.assign(Object.assign(Object.assign({},Vt),t),{prefix:e||""});return{data:yield zt(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(Mt(s))return{data:null,error:s};throw s}}))}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Wt={"X-Client-Info":"storage-js/2.7.1"};var Jt=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(tm){i(tm)}}function a(e){try{l(s.throw(e))}catch(tm){i(tm)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};class Kt{constructor(e,t={},n){this.url=e,this.headers=Object.assign(Object.assign({},Wt),t),this.fetch=Dt(n)}listBuckets(){return Jt(this,void 0,void 0,(function*(){try{return{data:yield Bt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Mt(e))return{data:null,error:e};throw e}}))}getBucket(e){return Jt(this,void 0,void 0,(function*(){try{return{data:yield Bt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Mt(t))return{data:null,error:t};throw t}}))}createBucket(e,t={public:!1}){return Jt(this,void 0,void 0,(function*(){try{return{data:yield zt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Mt(n))return{data:null,error:n};throw n}}))}updateBucket(e,t){return Jt(this,void 0,void 0,(function*(){try{const n=yield function(e,t,n,s,r){return Pt(this,void 0,void 0,(function*(){return Lt(e,"PUT",t,s,r,n)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:n,error:null}}catch(n){if(Mt(n))return{data:null,error:n};throw n}}))}emptyBucket(e){return Jt(this,void 0,void 0,(function*(){try{return{data:yield zt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Mt(t))return{data:null,error:t};throw t}}))}deleteBucket(e){return Jt(this,void 0,void 0,(function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Mt(t))return{data:null,error:t};throw t}}))}}class Gt extends Kt{constructor(e,t={},n){super(e,t,n)}from(e){return new qt(this.url,this.headers,e,this.fetch)}}let Xt="";Xt="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Yt={headers:{"X-Client-Info":`supabase-js-${Xt}/2.47.12`}},Qt={schema:"public"},Zt={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},en={};var tn=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(tm){i(tm)}}function a(e){try{l(s.throw(e))}catch(tm){i(tm)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const nn=(e,t,n)=>{const s=(e=>{let t;return t=e||("undefined"==typeof fetch?se:fetch),(...e)=>t(...e)})(n),r="undefined"==typeof Headers?re:Headers;return(n,i)=>tn(void 0,void 0,void 0,(function*(){var o;const a=null!==(o=yield t())&&void 0!==o?o:e;let l=new r(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),s(n,Object.assign(Object.assign({},i),{headers:l}))}))};var sn=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(tm){i(tm)}}function a(e){try{l(s.throw(e))}catch(tm){i(tm)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const rn="2.67.3",on={"X-Client-Info":`gotrue-js/${rn}`},an="X-Supabase-Api-Version",ln={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"};const cn=()=>"undefined"!=typeof window&&"undefined"!=typeof document,dn={tested:!1,writable:!1},hn=()=>{if(!cn())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(tm){return!1}if(dn.tested)return dn.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),dn.tested=!0,dn.writable=!0}catch(tm){dn.tested=!0,dn.writable=!1}return dn.writable};const un=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>z((async()=>{const{default:e}=await Promise.resolve().then((()=>ae));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},pn=async(e,t,n)=>{await e.setItem(t,JSON.stringify(n))},fn=async(e,t)=>{const n=await e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch(s){return n}},mn=async(e,t)=>{await e.removeItem(t)};class gn{constructor(){this.promise=new gn.promiseConstructor(((e,t)=>{this.resolve=e,this.reject=t}))}}function yn(e){const t=e.split(".");if(3!==t.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const n=t[1];return JSON.parse(function(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let n,s,r,i,o,a,l,c="",d=0;for(e=e.replace("-","+").replace("_","/");d<e.length;)i=t.indexOf(e.charAt(d++)),o=t.indexOf(e.charAt(d++)),a=t.indexOf(e.charAt(d++)),l=t.indexOf(e.charAt(d++)),n=i<<2|o>>4,s=(15&o)<<4|a>>2,r=(3&a)<<6|l,c+=String.fromCharCode(n),64!=a&&0!=s&&(c+=String.fromCharCode(s)),64!=l&&0!=r&&(c+=String.fromCharCode(r));return c}(n))}function vn(e){return("0"+e.toString(16)).substr(-2)}async function bn(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map((e=>String.fromCharCode(e))).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function wn(e,t,n=!1){const s=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let n="";for(let s=0;s<56;s++)n+=e.charAt(Math.floor(Math.random()*t));return n}return crypto.getRandomValues(e),Array.from(e,vn).join("")}();let r=s;n&&(r+="/PASSWORD_RECOVERY"),await pn(e,`${t}-code-verifier`,r);const i=await bn(s);return[i,s===i?"plain":"s256"]}gn.promiseConstructor=Promise;const xn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;class kn extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Sn(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Cn extends kn{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}class Tn extends kn{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class On extends kn{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class En extends On{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Nn extends On{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Mn extends On{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class jn extends On{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class _n extends On{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class An extends On{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Dn(e){return Sn(e)&&"AuthRetryableFetchError"===e.name}class Rn extends On{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}const Pn=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),In=[502,503,504];async function $n(e){var t,n;if(!("object"==typeof(n=e)&&null!==n&&"status"in n&&"ok"in n&&"json"in n&&"function"==typeof n.json))throw new An(Pn(e),0);if(In.includes(e.status))throw new An(Pn(e),e.status);let s,r;try{s=await e.json()}catch(tm){throw new Tn(Pn(tm),tm)}const i=function(e){const t=e.headers.get(an);if(!t)return null;if(!t.match(xn))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(tm){return null}}(e);if(i&&i.getTime()>=ln.timestamp&&"object"==typeof s&&s&&"string"==typeof s.code?r=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(r=s.error_code),r){if("weak_password"===r)throw new Rn(Pn(s),e.status,(null===(t=s.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===r)throw new En}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0))throw new Rn(Pn(s),e.status,s.weak_password.reasons);throw new Cn(Pn(s),e.status||500,r)}async function Ln(e,t,n,s){var r;const i=Object.assign({},null==s?void 0:s.headers);i[an]||(i[an]=ln.name),(null==s?void 0:s.jwt)&&(i.Authorization=`Bearer ${s.jwt}`);const o=null!==(r=null==s?void 0:s.query)&&void 0!==r?r:{};(null==s?void 0:s.redirectTo)&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(e,t,n,s,r,i){const o=((e,t,n,s)=>{const r={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),n))})(t,s,r,i);let a;try{a=await e(n,Object.assign({},o))}catch(tm){throw console.error(tm),new An(Pn(tm),0)}a.ok||await $n(a);if(null==s?void 0:s.noResolveJson)return a;try{return await a.json()}catch(tm){await $n(tm)}}(e,t,n+a,{headers:i,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}function Bn(e){var t;let n=null;var s;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(n=Object.assign({},e),e.expires_at||(n.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s)));return{data:{session:n,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function zn(e){const t=Bn(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0)&&(t.data.weak_password=e.weak_password),t}function Fn(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Hn(e){return{data:e,error:null}}function Vn(e){const{action_link:t,email_otp:n,hashed_token:s,redirect_to:r,verification_type:i}=e,o=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:n,hashed_token:s,redirect_to:r,verification_type:i},user:Object.assign({},o)},error:null}}function Un(e){return e}class qn{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=un(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await Ln(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Sn(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await Ln(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Fn})}catch(n){if(Sn(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n}(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=null==n?void 0:n.newEmail,delete s.newEmail),await Ln(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Vn,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(Sn(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Ln(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Fn})}catch(t){if(Sn(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,r,i,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=await Ln(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(r=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==r?r:""},xform:Un});if(c.error)throw c.error;const d=await c.json(),h=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,u=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return u.length>0&&(u.forEach((e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);l[`${n}Page`]=t})),l.total=parseInt(h)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(Sn(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await Ln(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Fn})}catch(t){if(Sn(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await Ln(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Fn})}catch(n){if(Sn(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){try{return await Ln(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Fn})}catch(n){if(Sn(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){try{const{data:t,error:n}=await Ln(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:n}}catch(t){if(Sn(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await Ln(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Sn(t))return{data:null,error:t};throw t}}}const Wn={getItem:e=>hn()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{hn()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{hn()&&globalThis.localStorage.removeItem(e)}};function Jn(e={}){return{getItem:t=>e[t]||null,setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}}const Kn=!!(globalThis&&hn()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Gn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Xn extends Gn{}async function Yn(e,t,n){Kn&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const s=new globalThis.AbortController;return t>0&&setTimeout((()=>{s.abort(),Kn&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)}),t),await Promise.resolve().then((()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},(async s=>{if(!s){if(0===t)throw Kn&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Xn(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Kn)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(tm){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",tm)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}Kn&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await n()}finally{Kn&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}))))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(tm){"undefined"!=typeof self&&(self.globalThis=self)}}();const Qn={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:on,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Zn=3e4;async function es(e,t,n){return await n()}class ts{constructor(e){var t,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ts.nextInstanceID,ts.nextInstanceID+=1,this.instanceID>0&&cn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Qn),e);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new qn({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=un(s.fetch),this.lock=s.lock||es,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:cn()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Yn:this.lock=es,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:hn()?this.storage=Wn:(this.memoryStorage={},this.storage=Jn(this.memoryStorage)):(this.memoryStorage={},this.storage=Jn(this.memoryStorage)),cn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(tm){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",tm)}null===(n=this.broadcastChannel)||void 0===n||n.addEventListener("message",(async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${rn}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,(async()=>await this._initialize())))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},n=new URL(e);if(n.hash&&"#"===n.hash[0])try{new URLSearchParams(n.hash.substring(1)).forEach(((e,n)=>{t[n]=e}))}catch(tm){}return n.searchParams.forEach(((e,n)=>{t[n]=e})),t}(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),cn()&&this.detectSessionInUrl&&"none"!==n){const{data:s,error:r}=await this._getSessionFromURL(t,n);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),function(e){return Sn(e)&&"AuthImplicitGrantRedirectError"===e.name}(r)){const t=null===(e=r.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:r}}return await this._removeSession(),{error:r}}const{session:i,redirectType:o}=s;return this._debug("#_initialize()","detected session in URL",i,"redirect type",o),await this._saveSession(i),setTimeout((async()=>{"recovery"===o?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)}),0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Sn(t)?{error:t}:{error:new Tn("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const r=await Ln(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(n=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken}},xform:Bn}),{data:i,error:o}=r;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(r){if(Sn(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var t,n,s;try{let r;if("email"in e){const{email:n,password:s,options:i}=e;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await wn(this.storage,this.storageKey)),r=await Ln(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:n,password:s,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},xform:Bn})}else{if(!("phone"in e))throw new Mn("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:o}=e;r=await Ln(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(n=null==o?void 0:o.data)&&void 0!==n?n:{},channel:null!==(s=null==o?void 0:o.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:Bn})}}const{data:i,error:o}=r;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(r){if(Sn(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:s,options:r}=e;t=await Ln(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:zn})}else{if(!("phone"in e))throw new Mn("You must provide either an email or phone number and a password");{const{phone:n,password:s,options:r}=e;t=await Ln(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:zn})}}const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:n&&n.session&&n.user?(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s}):{data:{user:null,session:null},error:new Nn}}catch(t){if(Sn(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,r;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(r=e.options)||void 0===r?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,(async()=>this._exchangeCodeForSession(e)))}async _exchangeCodeForSession(e){const t=await fn(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(null!=t?t:"").split("/");try{const{data:t,error:r}=await Ln(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Bn});if(await mn(this.storage,`${this.storageKey}-code-verifier`),r)throw r;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:r}):{data:{user:null,session:null,redirectType:null},error:new Nn}}catch(r){if(Sn(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:r,nonce:i}=e,o=await Ln(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:r,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Bn}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new Nn}}catch(t){if(Sn(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,r,i;try{if("email"in e){const{email:s,options:r}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=await wn(this.storage,this.storageKey));const{error:a}=await Ln(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==r?void 0:r.data)&&void 0!==t?t:{},create_user:null===(n=null==r?void 0:r.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},code_challenge:i,code_challenge_method:o},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:t,options:n}=e,{data:o,error:a}=await Ln(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==n?void 0:n.data)&&void 0!==s?s:{},create_user:null===(r=null==n?void 0:n.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},channel:null!==(i=null==n?void 0:n.channel)&&void 0!==i?i:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new Mn("You must provide either an email or phone number.")}catch(o){if(Sn(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,n;try{let s,r;"options"in e&&(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo,r=null===(n=e.options)||void 0===n?void 0:n.captchaToken);const{data:i,error:o}=await Ln(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:s,xform:Bn});if(o)throw o;if(!i)throw new Error("An error occurred on token verification.");const a=i.session,l=i.user;return(null==a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(s){if(Sn(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{let r=null,i=null;return"pkce"===this.flowType&&([r,i]=await wn(this.storage,this.storageKey)),await Ln(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==n?n:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:i}),headers:this.headers,xform:Hn})}catch(r){if(Sn(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._reauthenticate()))}async _reauthenticate(){try{return await this._useSession((async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new En;const{error:s}=await Ln(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}}))}catch(e){if(Sn(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:r}=e,{error:i}=await Ln(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){const{phone:n,type:s,options:r}=e,{data:i,error:o}=await Ln(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new Mn("You must provide either an email or phone number and a type")}catch(t){if(Sn(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,(async()=>this._useSession((async e=>e))))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch(tm){}})()),n}return await this.lock(`lock:${this.storageKey}`,e,(async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(tm){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await fn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=!!e.expires_at&&e.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,n,s)=>(t||"user"!==n||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,n,s))})}return{data:{session:e},error:null}}const{session:s,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,(async()=>await this._getUser()))}async _getUser(e){try{return e?await Ln(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Fn}):await this._useSession((async e=>{var t,n,s;const{data:r,error:i}=e;if(i)throw i;return(null===(t=r.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Ln(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(s=null===(n=r.session)||void 0===n?void 0:n.access_token)&&void 0!==s?s:void 0,xform:Fn}):{data:{user:null},error:new En}}))}catch(t){if(Sn(t))return function(e){return Sn(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await mn(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._updateUser(e,t)))}async _updateUser(e,t={}){try{return await this._useSession((async n=>{const{data:s,error:r}=n;if(r)throw r;if(!s.session)throw new En;const i=s.session;let o=null,a=null;"pkce"===this.flowType&&null!=e.email&&([o,a]=await wn(this.storage,this.storageKey));const{data:l,error:c}=await Ln(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:a}),jwt:i.access_token,xform:Fn});if(c)throw c;return i.user=l.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}))}catch(n){if(Sn(n))return{data:{user:null},error:n};throw n}}_decodeJWT(e){return yn(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._setSession(e)))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new En;const t=Date.now()/1e3;let n=t,s=!0,r=null;const i=yn(e.access_token);if(i.exp&&(n=i.exp,s=n<=t),s){const{session:t,error:n}=await this._callRefreshToken(e.refresh_token);if(n)return{data:{user:null,session:null},error:n};if(!t)return{data:{user:null,session:null},error:null};r=t}else{const{data:s,error:i}=await this._getUser(e.access_token);if(i)throw i;r={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(t){if(Sn(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._refreshSession(e)))}async _refreshSession(e){try{return await this._useSession((async t=>{var n;if(!e){const{data:s,error:r}=t;if(r)throw r;e=null!==(n=s.session)&&void 0!==n?n:void 0}if(!(null==e?void 0:e.refresh_token))throw new En;const{session:s,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(Sn(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!cn())throw new jn("No browser detected.");if(e.error||e.error_description||e.error_code)throw new jn(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new _n("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new jn("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new _n("No code detected.");const{data:t,error:n}=await this._exchangeCodeForSession(e.code);if(n)throw n;const s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:r,refresh_token:i,expires_in:o,expires_at:a,token_type:l}=e;if(!(r&&o&&i&&l))throw new jn("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(o);let h=c+d;a&&(h=parseInt(a));const u=h-c;1e3*u<=Zn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${u}s, should have been closer to ${d}s`);const p=h-d;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,h,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,h,c);const{data:f,error:m}=await this._getUser(r);if(m)throw m;const g={provider_token:n,provider_refresh_token:s,access_token:r,expires_in:d,expires_at:h,refresh_token:i,token_type:l,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:e.type},error:null}}catch(n){if(Sn(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await fn(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._signOut(e)))}async _signOut({scope:e}={scope:"global"}){return await this._useSession((async t=>{var n;const{data:s,error:r}=t;if(r)return{error:r};const i=null===(n=s.session)||void 0===n?void 0:n.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!function(e){return Sn(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await mn(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>{await this.initializePromise,await this._acquireLock(-1,(async()=>{this._emitInitialSession(t)}))})(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession((async t=>{var n,s;try{const{data:{session:s},error:r}=t;if(r)throw r;await(null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(r){await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}}))}async resetPasswordForEmail(e,t={}){let n=null,s=null;"pkce"===this.flowType&&([n,s]=await wn(this.storage,this.storageKey,!0));try{return await Ln(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(Sn(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Sn(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:s}=await this._useSession((async t=>{var n,s,r,i,o;const{data:a,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(n=e.options)||void 0===n?void 0:n.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:!0});return await Ln(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(o=null===(i=a.session)||void 0===i?void 0:i.access_token)&&void 0!==o?o:void 0})}));if(s)throw s;return cn()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==n?void 0:n.url),{data:{provider:e.provider,url:null==n?void 0:n.url},error:null}}catch(n){if(Sn(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession((async t=>{var n,s;const{data:r,error:i}=t;if(i)throw i;return await Ln(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(n=r.session)||void 0===n?void 0:n.access_token)&&void 0!==s?s:void 0})}))}catch(t){if(Sn(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await(n=async n=>(n>0&&await async function(e){return await new Promise((t=>{setTimeout((()=>t(null)),e)}))}(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await Ln(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Bn})),s=(e,t)=>{const n=200*Math.pow(2,e);return t&&Dn(t)&&Date.now()+n-r<Zn},new Promise(((e,t)=>{(async()=>{for(let r=0;r<1/0;r++)try{const t=await n(r);if(!s(r,null,t))return void e(t)}catch(tm){if(!s(r,tm))return void t(tm)}})()})))}catch(r){if(this._debug(t,"error",r),Sn(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}var n,s}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),cn()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const n=await fn(this.storage,this.storageKey);if(this._debug(t,"session from storage",n),!this._isValidSession(n))return this._debug(t,"session is not valid"),void(null!==n&&await this._removeSession());const s=Math.round(Date.now()/1e3),r=(null!==(e=n.expires_at)&&void 0!==e?e:1/0)<s+10;if(this._debug(t,`session has${r?"":" not"} expired with margin of 10s`),r){if(this.autoRefreshToken&&n.refresh_token){const{error:e}=await this._callRefreshToken(n.refresh_token);e&&(console.error(e),Dn(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){return this._debug(t,"error",n),void console.error(n)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new En;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new gn;const{data:t,error:n}=await this._refreshAccessToken(e);if(n)throw n;if(!t.session)throw new En;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const s={session:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(r){if(this._debug(s,"error",r),Sn(r)){const e={session:null,error:r};return Dn(r)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(n=this.refreshingDeferred)||void 0===n||n.reject(r),r}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],r=Array.from(this.stateChangeEmitters.values()).map((async n=>{try{await n.callback(e,t)}catch(tm){s.push(tm)}}));if(await Promise.all(r),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await pn(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await mn(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&cn()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(tm){console.error("removing visibilitychange callback failed",tm)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval((()=>this._autoRefreshTokenTick()),Zn);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout((async()=>{await this.initializePromise,await this._autoRefreshTokenTick()}),0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,(async()=>{try{const e=Date.now();try{return await this._useSession((async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*n.expires_at-e)/Zn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(n.refresh_token)}))}catch(tm){console.error("Auto refresh tick failed with error. This is likely a transient error.",tm)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(tm){if(!(tm.isAcquireTimeout||tm instanceof Gn))throw tm;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!cn()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,(async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if((null==n?void 0:n.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),(null==n?void 0:n.scopes)&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),"pkce"===this.flowType){const[e,t]=await wn(this.storage,this.storageKey),n=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});s.push(n.toString())}if(null==n?void 0:n.queryParams){const e=new URLSearchParams(n.queryParams);s.push(e.toString())}return(null==n?void 0:n.skipBrowserRedirect)&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession((async t=>{var n;const{data:s,error:r}=t;return r?{data:null,error:r}:await Ln(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(n=null==s?void 0:s.session)||void 0===n?void 0:n.access_token})}))}catch(t){if(Sn(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession((async t=>{var n,s;const{data:r,error:i}=t;if(i)return{data:null,error:i};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:l}=await Ln(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(n=null==r?void 0:r.session)||void 0===n?void 0:n.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(s=null==a?void 0:a.totp)||void 0===s?void 0:s.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}))}catch(t){if(Sn(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var n;const{data:s,error:r}=t;if(r)return{data:null,error:r};const{data:i,error:o}=await Ln(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(n=null==s?void 0:s.session)||void 0===n?void 0:n.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})}))}catch(t){if(Sn(t))return{data:null,error:t};throw t}}))}async _challenge(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var n;const{data:s,error:r}=t;return r?{data:null,error:r}:await Ln(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(n=null==s?void 0:s.session)||void 0===n?void 0:n.access_token})}))}catch(t){if(Sn(t))return{data:null,error:t};throw t}}))}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=(null==e?void 0:e.factors)||[],s=n.filter((e=>"totp"===e.factor_type&&"verified"===e.status)),r=n.filter((e=>"phone"===e.factor_type&&"verified"===e.status));return{data:{all:n,totp:s,phone:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,(async()=>await this._useSession((async e=>{var t,n;const{data:{session:s},error:r}=e;if(r)return{data:null,error:r};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const i=this._decodeJWT(s.access_token);let o=null;i.aal&&(o=i.aal);let a=o;(null!==(n=null===(t=s.user.factors)||void 0===t?void 0:t.filter((e=>"verified"===e.status)))&&void 0!==n?n:[]).length>0&&(a="aal2");return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:i.amr||[]},error:null}}))))}}ts.nextInstanceID=0;const ns=ts;class ss extends ns{constructor(e){super(e)}}var rs=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(tm){i(tm)}}function a(e){try{l(s.throw(e))}catch(tm){i(tm)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};class is{constructor(e,t,n){var s,r,i;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=e.replace(/\/$/,"");this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const a=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l=function(e,t){const{db:n,auth:s,realtime:r,global:i}=e,{db:o,auth:a,realtime:l,global:c}=t,d={db:Object.assign(Object.assign({},o),n),auth:Object.assign(Object.assign({},a),s),realtime:Object.assign(Object.assign({},l),r),global:Object.assign(Object.assign({},c),i),accessToken:()=>sn(this,void 0,void 0,(function*(){return""}))};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=n?n:{},{db:Qt,realtime:en,auth:Object.assign(Object.assign({},Zt),{storageKey:a}),global:Yt});this.storageKey=null!==(s=l.auth.storageKey)&&void 0!==s?s:"",this.headers=null!==(r=l.global.headers)&&void 0!==r?r:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(i=l.auth)&&void 0!==i?i:{},this.headers,l.global.fetch),this.fetch=nn(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.rest=new $e(`${o}/rest/v1`,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),l.accessToken||this._listenForAuthEvents()}get functions(){return new K(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Gt(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return rs(this,void 0,void 0,(function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return null!==(t=null===(e=n.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,storageKey:r,flowType:i,lock:o,debug:a},l,c){var d;const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ss({url:this.authUrl,headers:Object.assign(Object.assign({},h),l),storageKey:r,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,flowType:i,lock:o,debug:a,fetch:c,hasCustomAuthorizationHeader:null!==(d="Authorization"in this.headers)&&void 0!==d&&d})}_initRealtimeClient(e){return new Ot(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)}))}_handleTokenChanged(e,t,n){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===n?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=n}}const as=new is("","",{auth:{persistSession:!0,autoRefreshToken:!0},global:{headers:{"x-application-name":"portfolio"}}});function ls(){return Boolean(void 0)}const cs=[{id:"affinity-canvas",title:"Affinity Canvas",client:"Stagebase",image:"https://images.unsplash.com/photo-1522071820081-009f0129c71c",description:"A unified workspace for small business lenders to efficiently evaluate loan applications.",year:"2022"},{id:"smart-home",title:"Smart Home App",client:"Pura",image:"https://images.unsplash.com/photo-1558002038-1055907df827",description:"IoT mobile app for controlling smart home fragrance devices.",year:"2023"},{id:"tax-credit",title:"Tax Credit Platform",client:"Lendio",image:"https://images.unsplash.com/photo-1454165804606-c3d57bc86b40",description:"Web application for businesses to claim employee retention tax credits.",year:"2023"}];function ds({onCaseStudyClick:t}){I();const[n,s]=e.useState("grid"),[r,i]=e.useState([]),[o,a]=e.useState(!0);e.useEffect((()=>{l()}),[]);const l=async()=>{try{a(!0);const e=await async function(){if(!ls())return console.log("Using fallback projects (Supabase not connected)"),cs;try{const{data:e,error:t}=await as.from("case_studies").select("*").order("created_at",{ascending:!1});if(t)throw t;const n=(e||[]).map((e=>({id:e.id,title:e.title,client:e.client,image:e.thumbnail_image||"https://images.unsplash.com/photo-1522071820081-009f0129c71c",description:e.challenge||"",year:e.year||""})));return n.length>0?n:cs}catch(e){return console.error("Error fetching projects:",e),cs}}();i(e)}catch(e){console.error("Error loading projects:",e)}finally{a(!1)}};e.useEffect((()=>{const e=()=>{window.innerWidth<768?s("list"):s("grid")};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);return o?A.jsxs("div",{className:"w-full max-w-3xl",children:[A.jsx("div",{className:"flex justify-between items-center mb-16",children:A.jsx("h2",{className:"text-4xl font-light",children:"Selected Work"})}),A.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3].map((e=>A.jsxs("div",{className:"animate-pulse",children:[A.jsx("div",{className:"bg-gray-200 aspect-[4/3] rounded-[23.33px] mb-4"}),A.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]},e)))})]}):(ls()||console.log("Using fallback projects (Supabase not connected)"),A.jsxs("div",{className:"w-full max-w-3xl",children:[A.jsxs("div",{className:"flex justify-between items-center mb-16",children:[A.jsx("h2",{className:"text-4xl font-light",children:"Selected Work"}),A.jsxs("div",{className:"hidden md:flex space-x-2",children:[A.jsx("button",{onClick:()=>s("list"),className:"view-toggle-btn "+("list"===n?"bg-gray-100":""),children:A.jsx(h,{size:20})}),A.jsx("button",{onClick:()=>s("grid"),className:"view-toggle-btn "+("grid"===n?"bg-gray-100":""),children:A.jsx(u,{size:20})})]})]}),"grid"===n?A.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map((e=>A.jsx("div",{className:"group relative rounded-[23.33px] overflow-hidden [box-shadow:2.92px_2.92px_26.25px_0px_#333B501F] hover:[box-shadow:2.92px_2.92px_26.25px_0px_#333B501F] transition-shadow",children:A.jsx("button",{onClick:()=>t(e.id),className:"block w-full text-left",children:A.jsxs("div",{className:"relative",children:[e.image?A.jsx("img",{src:e.image,alt:e.title,className:"w-full aspect-[4/3] object-cover"}):A.jsx("div",{className:"w-full aspect-[4/3] bg-gray-100 flex items-center justify-center text-gray-400",children:"No image"}),A.jsx("span",{className:"absolute top-4 left-4 bg-blue-500 text-white text-sm px-4 py-1.5 rounded-full",children:e.title})]})})},e.id)))}):A.jsx("div",{className:"space-y-12 md:space-y-24",children:r.map((e=>{return A.jsx("div",{children:A.jsxs("button",{onClick:()=>t(e.id),className:"block w-full text-left",children:[A.jsxs("div",{className:"relative overflow-hidden rounded-[23.33px]",children:[e.image?A.jsx("img",{src:e.image,alt:e.title,className:"w-full aspect-[16/9] object-cover"}):A.jsx("div",{className:"w-full aspect-[16/9] bg-gray-100 flex items-center justify-center text-gray-400",children:"No image"}),A.jsx("span",{className:"absolute top-4 left-4 bg-blue-500 text-white text-sm px-4 py-1.5 rounded-full",children:e.title})]}),A.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-baseline gap-2 mt-6",children:[A.jsx("span",{className:"text-sm text-gray-400",children:e.year}),A.jsx("span",{className:"text-sm text-gray-500 line-clamp-2 md:line-clamp-none",children:(n=e.description,n.replace(/<[^>]*>/g,"").trim())})]})]})},e.id);var n}))})]}))}const hs=[{title:"Human-Centered",description:"Every decision starts with understanding the people we're designing for."},{title:"Simplicity",description:"Removing complexity to create clear, intuitive experiences."},{title:"Impact",description:"Focusing on solutions that create meaningful change."},{title:"Collaboration",description:"Working together to achieve the best possible outcomes."}];function us(){return A.jsxs("div",{className:"w-full max-w-3xl px-4 sm:px-6 lg:px-8",children:[A.jsx("h2",{className:"text-4xl font-light mb-12",children:"Design Values"}),A.jsx("div",{className:"space-y-16",children:hs.map(((e,t)=>A.jsxs("div",{className:"group",children:[A.jsx("h3",{className:"text-2xl font-medium mb-4",children:e.title}),A.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:e.description})]},t)))})]})}const ps=[{school:"Central Washington University",degrees:["Bachelor of Fine Arts, Graphic Design","Bachelor of Arts, Russian"]}];function fs(){return A.jsxs("section",{children:[A.jsx("h3",{className:"text-2xl mb-10",children:"Education"}),A.jsx("div",{className:"space-y-12",children:ps.map(((e,t)=>A.jsxs("div",{children:[A.jsxs("div",{className:"flex justify-between items-baseline mb-3",children:[A.jsx("h4",{className:"text-xl underline decoration-1 underline-offset-8 decoration-blue-500",children:e.school}),e.year&&A.jsx("span",{className:"text-gray-400 text-sm",children:e.year})]}),A.jsx("div",{className:"space-y-1",children:e.degrees.map(((e,t)=>A.jsx("p",{className:"text-gray-600 text-lg leading-relaxed",children:e},t)))})]},t)))})]})}function ms(){return A.jsxs("div",{className:"max-w-3xl",children:[A.jsx("h2",{className:"text-4xl font-light mb-16",children:"Background"}),A.jsxs("div",{className:"space-y-20",children:[A.jsxs("section",{children:[A.jsx("h3",{className:"text-2xl mb-10",children:"Experience"}),A.jsxs("div",{className:"space-y-12",children:[A.jsxs("div",{children:[A.jsxs("div",{className:"flex justify-between items-baseline mb-3",children:[A.jsx("h4",{className:"text-xl underline decoration-1 underline-offset-8 decoration-blue-500",children:"Product / UX Design Consultant, SparkVault"}),A.jsx("span",{className:"text-gray-400 text-sm",children:"2023Current"})]}),A.jsxs("ul",{className:"text-gray-600 text-lg leading-relaxed list-disc pl-5 space-y-2",children:[A.jsxs("li",{children:[A.jsx("strong",{children:"Design Excellence"}),": Deliver professional-grade assets including wire-frames, user flows, Figma mockups and prototypes that elevate client brand presence."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Strategic Advisory"}),": Provide high-level design strategy consulting for SaaS clients and guiding design practices to ensure brand alignment and impact."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Cross-functional Collaboration"}),": Partner with executive teams to translate business goals into creative strategies that align with user needs."]})]})]}),A.jsxs("div",{children:[A.jsxs("div",{className:"flex justify-between items-baseline mb-3",children:[A.jsx("h4",{className:"text-xl underline decoration-1 underline-offset-8 decoration-blue-500",children:"Senior Manager UX, Pura"}),A.jsx("span",{className:"text-gray-400 text-sm",children:"03/202310/2024"})]}),A.jsxs("ul",{className:"text-gray-600 text-lg leading-relaxed list-disc pl-5 space-y-2",children:[A.jsxs("li",{children:[A.jsx("strong",{children:"High-Impact Design"}),": Directed the design of an e-commerce site, smart home app, and IoT consumer electronics, supporting Pura's rank as the #1 fastest-growing tech company on Utah Business' Fast 50 List for 2024."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Executive Communication"}),": Presented design strategies to senior management, incorporating feedback to align deliverables with brand vision and objectives."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Creative Leadership"}),": Led a team of five designers in developing visually compelling and brand-aligned assets across app and web platforms."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Strategic Brand Management"}),": Collaborated with Marketing, Product, and Engineering teams to ensure cohesive brand messaging and seamless user experience across all channels."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Mentorship & Development"}),": Fostered a collaborative and innovative environment for designers, providing guidance on design principles, workflows, and professional growth with 75% promotions and bonus rate in 18 months."]})]})]}),A.jsxs("div",{children:[A.jsxs("div",{className:"flex justify-between items-baseline mb-3",children:[A.jsx("h4",{className:"text-xl underline decoration-1 underline-offset-8 decoration-blue-500",children:"UX Director, Lendio"}),A.jsx("span",{className:"text-gray-400 text-sm",children:"03/202201/2023"})]}),A.jsxs("ul",{className:"text-gray-600 text-lg leading-relaxed list-disc pl-5 space-y-2",children:[A.jsxs("li",{children:[A.jsx("strong",{children:"Hands-on Design"}),": Developed and launched UX/UI for Lendio's flagship mobile app, contributing to product vision as part of the company's strategic tiger team."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Driving Revenue"}),": Sole designer for an industry-leading tax credit web application, which resulted in $3MM+ in revenue in the first quarter."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Talent Development"}),": Mentored mid-level and junior designers, fostering a collaborative environment and encouraging creative innovation."]})]})]}),A.jsxs("div",{children:[A.jsxs("div",{className:"flex justify-between items-baseline mb-3",children:[A.jsx("h4",{className:"text-xl underline decoration-1 underline-offset-8 decoration-blue-500",children:"Senior UX Designer, The Church of Jesus Christ of Latter-Day Saints"}),A.jsx("span",{className:"text-gray-400 text-sm",children:"5/20163/2022"})]}),A.jsxs("ul",{className:"text-gray-600 text-lg leading-relaxed list-disc pl-5 space-y-2",children:[A.jsxs("li",{children:[A.jsx("strong",{children:"Product Design"}),": Responsible for UX on eight products, with a team of three Product Managers and eight developers."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Global Reach"}),": Supported a 16MM+ user base in 10+ languages, aligning UX design with business goals, research data, and user insights."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Leadership Roles"}),": Served as Team Lead for UX in the Church History Department."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"A/B Testing"}),": Directed UX for multi-variate (A/B) testing to optimize user engagement."]})]})]}),A.jsxs("div",{children:[A.jsxs("div",{className:"flex justify-between items-baseline mb-3",children:[A.jsx("h4",{className:"text-xl underline decoration-1 underline-offset-8 decoration-blue-500",children:"Principal UX Designer, StageBase"}),A.jsx("span",{className:"text-gray-400 text-sm",children:"8/201811/2021"})]}),A.jsxs("ul",{className:"text-gray-600 text-lg leading-relaxed list-disc pl-5 space-y-2",children:[A.jsxs("li",{children:[A.jsx("strong",{children:"Leadership"}),": Built UX discipline from ground up as founding team member, scaling from initial startup through $1MM pre-seed round."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Strategy"}),": Partnered with founders to translate complex business challenges into design solutions."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Design Process"}),": Created comprehensive UX deliverables including workflow diagrams, wire-frames, high fidelity mockups, and usability requirements."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Product Design"}),": Owned end-to-end UI/UX development across product."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Collaboration"}),": Maintained close partnership with engineering team in fast-paced and iterative development environment."]})]})]}),A.jsxs("div",{children:[A.jsxs("div",{className:"flex justify-between items-baseline mb-3",children:[A.jsx("h4",{className:"text-xl underline decoration-1 underline-offset-8 decoration-blue-500",children:"Manager of Digital Content / UX, Central Washington University"}),A.jsx("span",{className:"text-gray-400 text-sm",children:"3/20105/2016"})]}),A.jsxs("ul",{className:"text-gray-600 text-lg leading-relaxed list-disc pl-5 space-y-2",children:[A.jsxs("li",{children:[A.jsx("strong",{children:"Product Ownership"}),": Spearheaded UX design initiatives, from concept to production for university web platform, enterprise systems, and native apps."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Stakeholder Management"}),": Delivered regular briefings and presentations to executive leadership and technical teams."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Mentorship"}),": Guided team of five student designers on design principles, workflows, and career track."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Team Leadership"}),": Directed the work of a 13-person cross-functional team of content specialists and developers."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Executive Partnership"}),": Collaborated directly with university Chief of Staff on strategic digital initiatives."]}),A.jsxs("li",{children:[A.jsx("strong",{children:"Cost Optimization"}),": Generated $1MM in savings through strategic design thinking approach to website redesign project."]})]})]})]})]}),A.jsx(fs,{})]})]})}const gs=[{quote:"David is an outstanding problem-solver and collaborator, combining creativity with strategic thinking to tackle challenges and elevate customer experience. His commitment to quality is unwaveringhe never compromises on customer or brand experience. As I've witnessed David managing his team, I've seen him be both respectful and empowering, always advocating for his team and aligning their strengths to create value. Working with David is genuinely enjoyable; his positive energy and dedication make every project smoother and more engaging. Any team would be lucky to have someone as driven, thoughtful, and skilled as David.",author:"Rachel Beckstead",role:"Sr. Director of Product Management at Pura"},{quote:"David is a talented UX Designer with a knack for diving deep and figuring out complex systems and how to improve them. He's a strong leader who can give good design critique and stoke your brain to the next level of what's possible to make your design better. A humble guy with a great sense of humor who is fun to work with and helps make those around him better. If you get the chance to work with David, you'll see what I mean.",author:"Isaac Gerke",role:"Director of User Experience, Lendio"},{quote:"I had the privilege of bringing on David to our team at Lendio, and I have no regrets. We immediately put him to work on one of the most complex, technical, and ambiguous areas of of product, and he made an almost immediate impact. His impact continued to grow as he took on new opportunities, most especially his contribution of our Lendio Product Vision tiger team and his transition to Director of Lender SaaS. David is a leader who leads with integrity, smarts, and humility. I hope I get the chance to work with him again.",author:"Grant Zabriskie",role:"Senior UX Manager, Lendio"},{quote:"David is a joy to work with, including his kind personality, positive attitude, and his super power of making sense of the most complex problems. Put a dry erase marker in his hand and watch him diagram the problem with ease. Everyone loves David and any company will benefit from having him!",author:"Jon Smith, MBA",role:"Senior UX Designer, Pura"},{quote:"He is a good designer, but more importantly David is a creative thinker and a problem solver. He is constantly exploring better ways to meet our clients needs, whether it relates directly to his job or not. He is a true team player with a great attitude. There is no question that I would hire David again if the opportunity presented itself. If you are looking for someone with a great amount of energy, enthusiasm, creativity and drive, I would strongly recommend adding David to your team.",author:"Chad McCraine",role:"Advertising/B2B Design Manager, The Seattle Times"},{quote:"Every once in while you have an opportunity to work with someone that that is truly special. The kind of person that thinks out of the box, is wiling to share their ideas, and takes the initiative to bring positive change to an organization. David is one such person and I would recommend him without hesitation.",author:"Arthur Thomas",role:"Business Development Sales Manager, The Seattle Times"}];function ys(){return A.jsxs("div",{className:"w-full max-w-3xl px-4 sm:px-6 lg:px-8",children:[A.jsx("h2",{className:"text-4xl font-light mb-16",children:"Recommendations"}),A.jsx("div",{className:"space-y-20",children:gs.map(((e,t)=>A.jsxs("div",{className:"group",children:[A.jsx(p,{size:32,className:"mb-6 text-gray-300"}),A.jsxs("blockquote",{className:"text-xl font-light mb-8 leading-relaxed text-gray-600",children:['"',e.quote,'"']}),A.jsxs("div",{children:[A.jsx("div",{className:"font-medium text-lg",children:e.author}),A.jsx("div",{className:"text-gray-500",children:e.role})]})]},t)))})]})}function vs(){return A.jsxs("div",{className:"w-full max-w-3xl px-4 sm:px-6 lg:px-8",children:[A.jsx("h2",{className:"text-4xl font-light mb-12",children:"Get in Touch"}),A.jsxs("div",{className:"space-y-12",children:[A.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-300 leading-relaxed",children:"I'm always interested in hearing about new projects and opportunities. Let's discuss how we can work together to create meaningful experiences."}),A.jsx("div",{children:A.jsxs("a",{href:"https://www.linkedin.com/in/davidmatayoshi",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center space-x-3 px-8 py-4 bg-[#0A66C2] hover:bg-[#004182] text-white rounded-lg transition-colors duration-200 shadow-sm hover:shadow-md",children:[A.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",className:"shrink-0",children:A.jsx("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),A.jsx("span",{className:"text-lg font-medium",children:"Connect on LinkedIn"})]})})]})]})}function bs({id:t,onClose:n}){const[s,r]=e.useState(null),[i,o]=e.useState(!0);e.useEffect((()=>{a()}),[t]);const a=async()=>{try{o(!0);const{data:e,error:n}=await as.from("case_studies").select('\n          *,\n          case_study_phases (\n            title,\n            description,\n            image,\n            "order"\n          )\n        ').eq("id",t).single();if(n)throw n;if(e){const t=e.case_study_phases||[];t.sort(((e,t)=>e.order-t.order)),r({...e,process:t.map((e=>({title:e.title||"",description:e.description||"",image:e.image||""})))})}}catch(e){console.error("Error loading case study:",e)}finally{o(!1)}};return i?A.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:A.jsx("div",{className:"text-gray-500",children:"Loading case study..."})}):s?A.jsxs("article",{className:"space-y-24",children:[A.jsxs("header",{className:"space-y-12",children:[A.jsx("h1",{className:"text-5xl font-light",children:s.title}),A.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-8",children:[A.jsxs("div",{children:[A.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Client"}),A.jsx("p",{children:s.client})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Role"}),A.jsx("p",{children:s.role})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Duration"}),A.jsx("p",{children:s.duration})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Team"}),A.jsx("p",{children:s.team})]})]})]}),A.jsxs("section",{className:"space-y-8",children:[A.jsx("h2",{className:"text-3xl font-light",children:"Challenge"}),A.jsx("div",{className:"text-xl text-gray-600 leading-relaxed prose",dangerouslySetInnerHTML:{__html:s.challenge||""}})]}),A.jsxs("section",{className:"space-y-8",children:[A.jsx("h2",{className:"text-3xl font-light",children:"Solution"}),A.jsx("div",{className:"text-xl text-gray-600 leading-relaxed prose",dangerouslySetInnerHTML:{__html:s.solution||""}})]}),A.jsxs("section",{className:"space-y-8",children:[A.jsx("h2",{className:"text-3xl font-light",children:"Impact"}),A.jsx("ul",{className:"space-y-4",children:s.impact.map(((e,t)=>A.jsx("li",{className:"text-xl text-gray-600",children:e},t)))})]}),A.jsxs("section",{className:"space-y-12",children:[A.jsx("h2",{className:"text-3xl font-light",children:"Process"}),s.process.map(((e,t)=>A.jsxs("div",{className:"space-y-6",children:[A.jsx("h3",{className:"text-2xl",children:e.title}),e.image&&A.jsx("img",{src:e.image,alt:e.title,className:"w-full max-w-[800px] aspect-[16/9] object-cover rounded-lg"}),A.jsx("div",{className:"text-xl text-gray-600 leading-relaxed prose",dangerouslySetInnerHTML:{__html:e.description||""}})]},t)))]})]}):A.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:A.jsx("div",{className:"text-gray-500",children:"Case study not found"})})}function ws(e){this.content=e}function xs(e,t,n){for(let s=0;;s++){if(s==e.childCount||s==t.childCount)return e.childCount==t.childCount?null:n;let r=e.child(s),i=t.child(s);if(r!=i){if(!r.sameMarkup(i))return n;if(r.isText&&r.text!=i.text){for(let e=0;r.text[e]==i.text[e];e++)n++;return n}if(r.content.size||i.content.size){let e=xs(r.content,i.content,n+1);if(null!=e)return e}n+=r.nodeSize}else n+=r.nodeSize}}function ks(e,t,n,s){for(let r=e.childCount,i=t.childCount;;){if(0==r||0==i)return r==i?null:{a:n,b:s};let o=e.child(--r),a=t.child(--i),l=o.nodeSize;if(o!=a){if(!o.sameMarkup(a))return{a:n,b:s};if(o.isText&&o.text!=a.text){let e=0,t=Math.min(o.text.length,a.text.length);for(;e<t&&o.text[o.text.length-e-1]==a.text[a.text.length-e-1];)e++,n--,s--;return{a:n,b:s}}if(o.content.size||a.content.size){let e=ks(o.content,a.content,n-1,s-1);if(e)return e}n-=l,s-=l}else n-=l,s-=l}}ws.prototype={constructor:ws,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return-1==t?void 0:this.content[t+1]},update:function(e,t,n){var s=n&&n!=e?this.remove(n):this,r=s.find(e),i=s.content.slice();return-1==r?i.push(n||e,t):(i[r+1]=t,n&&(i[r]=n)),new ws(i)},remove:function(e){var t=this.find(e);if(-1==t)return this;var n=this.content.slice();return n.splice(t,2),new ws(n)},addToStart:function(e,t){return new ws([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new ws(n)},addBefore:function(e,t,n){var s=this.remove(t),r=s.content.slice(),i=s.find(e);return r.splice(-1==i?r.length:i,0,t,n),new ws(r)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return(e=ws.from(e)).size?new ws(e.content.concat(this.subtract(e).content)):this},append:function(e){return(e=ws.from(e)).size?new ws(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=ws.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},toObject:function(){var e={};return this.forEach((function(t,n){e[t]=n})),e},get size(){return this.content.length>>1}},ws.from=function(e){if(e instanceof ws)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new ws(t)};class Ss{constructor(e,t){if(this.content=e,this.size=t||0,null==t)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,s=0,r){for(let i=0,o=0;o<t;i++){let a=this.content[i],l=o+a.nodeSize;if(l>e&&!1!==n(a,s+o,r||null,i)&&a.content.size){let r=o+1;a.nodesBetween(Math.max(0,e-r),Math.min(a.content.size,t-r),n,s+r)}o=l}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,s){let r="",i=!0;return this.nodesBetween(e,t,((o,a)=>{let l=o.isText?o.text.slice(Math.max(e,a)-a,t-a):o.isLeaf?s?"function"==typeof s?s(o):s:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&l||o.isTextblock)&&n&&(i?i=!1:r+=n),r+=l}),0),r}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,s=this.content.slice(),r=0;for(t.isText&&t.sameMarkup(n)&&(s[s.length-1]=t.withText(t.text+n.text),r=1);r<e.content.length;r++)s.push(e.content[r]);return new Ss(s,this.size+e.size)}cut(e,t=this.size){if(0==e&&t==this.size)return this;let n=[],s=0;if(t>e)for(let r=0,i=0;i<t;r++){let o=this.content[r],a=i+o.nodeSize;a>e&&((i<e||a>t)&&(o=o.isText?o.cut(Math.max(0,e-i),Math.min(o.text.length,t-i)):o.cut(Math.max(0,e-i-1),Math.min(o.content.size,t-i-1))),n.push(o),s+=o.nodeSize),i=a}return new Ss(n,s)}cutByIndex(e,t){return e==t?Ss.empty:0==e&&t==this.content.length?this:new Ss(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let s=this.content.slice(),r=this.size+t.nodeSize-n.nodeSize;return s[e]=t,new Ss(s,r)}addToStart(e){return new Ss([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Ss(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let s=this.content[t];e(s,n,t),n+=s.nodeSize}}findDiffStart(e,t=0){return xs(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return ks(this,e,t,n)}findIndex(e,t=-1){if(0==e)return Ts(0,e);if(e==this.size)return Ts(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,s=0;;n++){let r=s+this.child(n).nodeSize;if(r>=e)return r==e||t>0?Ts(n+1,r):Ts(n,s);s=r}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((e=>e.toJSON())):null}static fromJSON(e,t){if(!t)return Ss.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new Ss(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Ss.empty;let t,n=0;for(let s=0;s<e.length;s++){let r=e[s];n+=r.nodeSize,s&&r.isText&&e[s-1].sameMarkup(r)?(t||(t=e.slice(0,s)),t[t.length-1]=r.withText(t[t.length-1].text+r.text)):t&&t.push(r)}return new Ss(t||e,n)}static from(e){if(!e)return Ss.empty;if(e instanceof Ss)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Ss([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Ss.empty=new Ss([],0);const Cs={index:0,offset:0};function Ts(e,t){return Cs.index=e,Cs.offset=t,Cs}function Os(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!Os(e[n],t[n]))return!1}else{for(let n in e)if(!(n in t)||!Os(e[n],t[n]))return!1;for(let n in t)if(!(n in e))return!1}return!0}let Es=class e{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let s=0;s<e.length;s++){let r=e[s];if(this.eq(r))return e;if(this.type.excludes(r.type))t||(t=e.slice(0,s));else{if(r.type.excludes(this.type))return e;!n&&r.type.rank>this.type.rank&&(t||(t=e.slice(0,s)),t.push(this),n=!0),t&&t.push(r)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Os(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let s=n.create(t.attrs);return n.checkAttrs(s.attrs),s}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&0==t.length)return e.none;if(t instanceof e)return[t];let n=t.slice();return n.sort(((e,t)=>e.type.rank-t.type.rank)),n}};Es.none=[];class Ns extends Error{}class Ms{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=_s(this.content,e+this.openStart,t);return n&&new Ms(n,this.openStart,this.openEnd)}removeBetween(e,t){return new Ms(js(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Ms.empty;let n=t.openStart||0,s=t.openEnd||0;if("number"!=typeof n||"number"!=typeof s)throw new RangeError("Invalid input for Slice.fromJSON");return new Ms(Ss.fromJSON(e,t.content),n,s)}static maxOpen(e,t=!0){let n=0,s=0;for(let r=e.firstChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.firstChild)n++;for(let r=e.lastChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.lastChild)s++;return new Ms(e,n,s)}}function js(e,t,n){let{index:s,offset:r}=e.findIndex(t),i=e.maybeChild(s),{index:o,offset:a}=e.findIndex(n);if(r==t||i.isText){if(a!=n&&!e.child(o).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(s!=o)throw new RangeError("Removing non-flat range");return e.replaceChild(s,i.copy(js(i.content,t-r-1,n-r-1)))}function _s(e,t,n,s){let{index:r,offset:i}=e.findIndex(t),o=e.maybeChild(r);if(i==t||o.isText)return e.cut(0,t).append(n).append(e.cut(t));let a=_s(o.content,t-i-1,n);return a&&e.replaceChild(r,o.copy(a))}function As(e,t,n){if(n.openStart>e.depth)throw new Ns("Inserted content deeper than insertion position");if(e.depth-n.openStart!=t.depth-n.openEnd)throw new Ns("Inconsistent open depths");return Ds(e,t,n,0)}function Ds(e,t,n,s){let r=e.index(s),i=e.node(s);if(r==t.index(s)&&s<e.depth-n.openStart){let o=Ds(e,t,n,s+1);return i.copy(i.content.replaceChild(r,o))}if(n.content.size){if(n.openStart||n.openEnd||e.depth!=s||t.depth!=s){let{start:r,end:o}=function(e,t){let n=t.depth-e.openStart,s=t.node(n).copy(e.content);for(let r=n-1;r>=0;r--)s=t.node(r).copy(Ss.from(s));return{start:s.resolveNoCache(e.openStart+n),end:s.resolveNoCache(s.content.size-e.openEnd-n)}}(n,e);return Ls(i,Bs(e,r,o,t,s))}{let s=e.parent,r=s.content;return Ls(s,r.cut(0,e.parentOffset).append(n.content).append(r.cut(t.parentOffset)))}}return Ls(i,zs(e,t,s))}function Rs(e,t){if(!t.type.compatibleContent(e.type))throw new Ns("Cannot join "+t.type.name+" onto "+e.type.name)}function Ps(e,t,n){let s=e.node(n);return Rs(s,t.node(n)),s}function Is(e,t){let n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function $s(e,t,n,s){let r=(t||e).node(n),i=0,o=t?t.index(n):r.childCount;e&&(i=e.index(n),e.depth>n?i++:e.textOffset&&(Is(e.nodeAfter,s),i++));for(let a=i;a<o;a++)Is(r.child(a),s);t&&t.depth==n&&t.textOffset&&Is(t.nodeBefore,s)}function Ls(e,t){return e.type.checkContent(t),e.copy(t)}function Bs(e,t,n,s,r){let i=e.depth>r&&Ps(e,t,r+1),o=s.depth>r&&Ps(n,s,r+1),a=[];return $s(null,e,r,a),i&&o&&t.index(r)==n.index(r)?(Rs(i,o),Is(Ls(i,Bs(e,t,n,s,r+1)),a)):(i&&Is(Ls(i,zs(e,t,r+1)),a),$s(t,n,r,a),o&&Is(Ls(o,zs(n,s,r+1)),a)),$s(s,null,r,a),new Ss(a)}function zs(e,t,n){let s=[];if($s(null,e,n,s),e.depth>n){Is(Ls(Ps(e,t,n+1),zs(e,t,n+1)),s)}return $s(t,null,n,s),new Ss(s)}Ms.empty=new Ms(Ss.empty,0,0);class Fs{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return null==e?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[3*this.resolveDepth(e)]}index(e){return this.path[3*this.resolveDepth(e)+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e!=this.depth||this.textOffset?1:0)}start(e){return 0==(e=this.resolveDepth(e))?0:this.path[3*e-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]}after(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]+this.path[3*e].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],s=e.child(t);return n?e.child(t).cut(n):s}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):0==e?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[3*t],s=0==t?0:this.path[3*t-1]+1;for(let r=0;r<e;r++)s+=n.child(r).nodeSize;return s}marks(){let e=this.parent,t=this.index();if(0==e.content.size)return Es.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),s=e.maybeChild(t);if(!n){let e=n;n=s,s=e}let r=n.marks;for(var i=0;i<r.length;i++)!1!==r[i].type.spec.inclusive||s&&r[i].isInSet(s.marks)||(r=r[i--].removeFromSet(r));return r}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,s=e.parent.maybeChild(e.index());for(var r=0;r<n.length;r++)!1!==n[r].type.spec.inclusive||s&&n[r].isInSet(s.marks)||(n=n[r--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new qs(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],s=0,r=t;for(let i=e;;){let{index:e,offset:t}=i.content.findIndex(r),o=r-t;if(n.push(i,e,s+t),!o)break;if(i=i.child(e),i.isText)break;r=o-1,s+=t+1}return new Fs(t,n,r)}static resolveCached(e,t){let n=Us.get(e);if(n)for(let r=0;r<n.elts.length;r++){let e=n.elts[r];if(e.pos==t)return e}else Us.set(e,n=new Hs);let s=n.elts[n.i]=Fs.resolve(e,t);return n.i=(n.i+1)%Vs,s}}class Hs{constructor(){this.elts=[],this.i=0}}const Vs=12,Us=new WeakMap;class qs{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Ws=Object.create(null);let Js=class e{constructor(e,t,n,s=Es.none){this.type=e,this.attrs=t,this.marks=s,this.content=n||Ss.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,s=0){this.content.nodesBetween(e,t,n,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,s){return this.content.textBetween(e,t,n,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&Os(this.attrs,t||e.defaultAttrs||Ws)&&Es.sameSet(this.marks,n||Es.none)}copy(t=null){return t==this.content?this:new e(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new e(this.type,this.attrs,this.content,t)}cut(e,t=this.content.size){return 0==e&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return Ms.empty;let s=this.resolve(e),r=this.resolve(t),i=n?0:s.sharedDepth(t),o=s.start(i),a=s.node(i).content.cut(s.pos-o,r.pos-o);return new Ms(a,s.depth-i,r.depth-i)}replace(e,t,n){return As(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:s}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(s==e||t.isText)return t;e-=s+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(0==e)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let s=this.content.child(t-1);return{node:s,index:t-1,offset:n-s.nodeSize}}resolve(e){return Fs.resolveCached(this,e)}resolveNoCache(e){return Fs.resolve(this,e)}rangeHasMark(e,t,n){let s=!1;return t>e&&this.nodesBetween(e,t,(e=>(n.isInSet(e.marks)&&(s=!0),!s))),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Gs(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=Ss.empty,s=0,r=n.childCount){let i=this.contentMatchAt(e).matchFragment(n,s,r),o=i&&i.matchFragment(this.content,t);if(!o||!o.validEnd)return!1;for(let a=s;a<r;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0}canReplaceWith(e,t,n,s){if(s&&!this.type.allowsMarks(s))return!1;let r=this.contentMatchAt(e).matchType(n),i=r&&r.matchFragment(this.content,t);return!!i&&i.validEnd}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Es.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!Es.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((e=>e.type.name))}`);this.content.forEach((e=>e.check()))}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map((e=>e.toJSON()))),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if("text"==t.type){if("string"!=typeof t.text)throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let s=Ss.fromJSON(e,t.content),r=e.nodeType(t.type).create(t.attrs,s,n);return r.type.checkAttrs(r.attrs),r}};Js.prototype.text=void 0;class Ks extends Js{constructor(e,t,n,s){if(super(e,t,null,s),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Gs(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Ks(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Ks(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return 0==e&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function Gs(e,t){for(let n=e.length-1;n>=0;n--)t=e[n].type.name+"("+t+")";return t}class Xs{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new Ys(e,t);if(null==n.next)return Xs.empty;let s=Qs(n);n.next&&n.err("Unexpected trailing text");let r=function(e){let t=Object.create(null);return n(rr(e,0));function n(s){let r=[];s.forEach((t=>{e[t].forEach((({term:t,to:n})=>{if(!t)return;let s;for(let e=0;e<r.length;e++)r[e][0]==t&&(s=r[e][1]);rr(e,n).forEach((e=>{s||r.push([t,s=[]]),-1==s.indexOf(e)&&s.push(e)}))}))}));let i=t[s.join(",")]=new Xs(s.indexOf(e.length-1)>-1);for(let e=0;e<r.length;e++){let s=r[e][1].sort(sr);i.next.push({type:r[e][0],next:t[s.join(",")]||n(s)})}return i}}(function(e){let t=[[]];return r(i(e,0),n()),t;function n(){return t.push([])-1}function s(e,n,s){let r={term:s,to:n};return t[e].push(r),r}function r(e,t){e.forEach((e=>e.to=t))}function i(e,t){if("choice"==e.type)return e.exprs.reduce(((e,n)=>e.concat(i(n,t))),[]);if("seq"!=e.type){if("star"==e.type){let o=n();return s(t,o),r(i(e.expr,o),o),[s(o)]}if("plus"==e.type){let o=n();return r(i(e.expr,t),o),r(i(e.expr,o),o),[s(o)]}if("opt"==e.type)return[s(t)].concat(i(e.expr,t));if("range"==e.type){let o=t;for(let t=0;t<e.min;t++){let t=n();r(i(e.expr,o),t),o=t}if(-1==e.max)r(i(e.expr,o),o);else for(let t=e.min;t<e.max;t++){let t=n();s(o,t),r(i(e.expr,o),t),o=t}return[s(o)]}if("name"==e.type)return[s(t,void 0,e.value)];throw new Error("Unknown expr type")}for(let s=0;;s++){let o=i(e.exprs[s],t);if(s==e.exprs.length-1)return o;r(o,t=n())}}}(s));return function(e,t){for(let n=0,s=[e];n<s.length;n++){let e=s[n],r=!e.validEnd,i=[];for(let t=0;t<e.next.length;t++){let{type:n,next:o}=e.next[t];i.push(n.name),!r||n.isText||n.hasRequiredAttrs()||(r=!1),-1==s.indexOf(o)&&s.push(o)}r&&t.err("Only non-generatable nodes ("+i.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(r,n),r}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let s=this;for(let r=t;s&&r<n;r++)s=s.matchType(e.child(r).type);return s}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!t.isText&&!t.hasRequiredAttrs())return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let s=[this];return function r(i,o){let a=i.matchFragment(e,n);if(a&&(!t||a.validEnd))return Ss.from(o.map((e=>e.createAndFill())));for(let e=0;e<i.next.length;e++){let{type:t,next:n}=i.next[e];if(!t.isText&&!t.hasRequiredAttrs()&&-1==s.indexOf(n)){s.push(n);let e=r(n,o.concat(t));if(e)return e}}return null}(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let s=n.shift(),r=s.match;if(r.matchType(e)){let e=[];for(let t=s;t.type;t=t.via)e.push(t.type);return e.reverse()}for(let e=0;e<r.next.length;e++){let{type:i,next:o}=r.next[e];i.isLeaf||i.hasRequiredAttrs()||i.name in t||s.type&&!o.validEnd||(n.push({match:i.contentMatch,type:i,via:s}),t[i.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];return function t(n){e.push(n);for(let s=0;s<n.next.length;s++)-1==e.indexOf(n.next[s].next)&&t(n.next[s].next)}(this),e.map(((t,n)=>{let s=n+(t.validEnd?"*":" ")+" ";for(let r=0;r<t.next.length;r++)s+=(r?", ":"")+t.next[r].type.name+"->"+e.indexOf(t.next[r].next);return s})).join("\n")}}Xs.empty=new Xs(!0);class Ys{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Qs(e){let t=[];do{t.push(Zs(e))}while(e.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}function Zs(e){let t=[];do{t.push(er(e))}while(e.next&&")"!=e.next&&"|"!=e.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}function er(e){let t=function(e){if(e.eat("(")){let t=Qs(e);return e.eat(")")||e.err("Missing closing paren"),t}if(!/\W/.test(e.next)){let t=function(e,t){let n=e.nodeTypes,s=n[t];if(s)return[s];let r=[];for(let i in n){let e=n[i];e.isInGroup(t)&&r.push(e)}0==r.length&&e.err("No node type or group '"+t+"' found");return r}(e,e.next).map((t=>(null==e.inline?e.inline=t.isInline:e.inline!=t.isInline&&e.err("Mixing inline and block content"),{type:"name",value:t})));return e.pos++,1==t.length?t[0]:{type:"choice",exprs:t}}e.err("Unexpected token '"+e.next+"'")}(e);for(;;)if(e.eat("+"))t={type:"plus",expr:t};else if(e.eat("*"))t={type:"star",expr:t};else if(e.eat("?"))t={type:"opt",expr:t};else{if(!e.eat("{"))break;t=nr(e,t)}return t}function tr(e){/\D/.test(e.next)&&e.err("Expected number, got '"+e.next+"'");let t=Number(e.next);return e.pos++,t}function nr(e,t){let n=tr(e),s=n;return e.eat(",")&&(s="}"!=e.next?tr(e):-1),e.eat("}")||e.err("Unclosed braced range"),{type:"range",min:n,max:s,expr:t}}function sr(e,t){return t-e}function rr(e,t){let n=[];return function t(s){let r=e[s];if(1==r.length&&!r[0].term)return t(r[0].to);n.push(s);for(let e=0;e<r.length;e++){let{term:s,to:i}=r[e];s||-1!=n.indexOf(i)||t(i)}}(t),n.sort(sr)}function ir(e){let t=Object.create(null);for(let n in e){let s=e[n];if(!s.hasDefault)return null;t[n]=s.default}return t}function or(e,t){let n=Object.create(null);for(let s in e){let r=t&&t[s];if(void 0===r){let t=e[s];if(!t.hasDefault)throw new RangeError("No value supplied for attribute "+s);r=t.default}n[s]=r}return n}function ar(e,t,n,s){for(let r in t)if(!(r in e))throw new RangeError(`Unsupported attribute ${r} for ${n} of type ${r}`);for(let r in e){let n=e[r];n.validate&&n.validate(t[r])}}function lr(e,t){let n=Object.create(null);if(t)for(let s in t)n[s]=new dr(e,s,t[s]);return n}let cr=class e{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=lr(e,n.attrs),this.defaultAttrs=ir(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==e),this.isText="text"==e}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Xs.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:or(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Js(this,this.computeAttrs(e),Ss.from(t),Es.setFrom(n))}createChecked(e=null,t,n){return t=Ss.from(t),this.checkContent(t),new Js(this,this.computeAttrs(e),t,Es.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),(t=Ss.from(t)).size){let e=this.contentMatch.fillBefore(t);if(!e)return null;t=e.append(t)}let s=this.contentMatch.matchFragment(t),r=s&&s.fillBefore(Ss.empty,!0);return r?new Js(this,e,t.append(r),Es.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){ar(this.attrs,e,"node",this.name)}allowsMarkType(e){return null==this.markSet||this.markSet.indexOf(e)>-1}allowsMarks(e){if(null==this.markSet)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(null==this.markSet)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:Es.none:e}static compile(t,n){let s=Object.create(null);t.forEach(((t,r)=>s[t]=new e(t,n,r)));let r=n.spec.topNode||"doc";if(!s[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!s.text)throw new RangeError("Every schema needs a 'text' type");for(let e in s.text.attrs)throw new RangeError("The text node type should not have attributes");return s}};class dr{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate="string"==typeof n.validate?function(e,t,n){let s=n.split("|");return n=>{let r=null===n?"null":typeof n;if(s.indexOf(r)<0)throw new RangeError(`Expected value of type ${s} for attribute ${t} on type ${e}, got ${r}`)}}(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class hr{constructor(e,t,n,s){this.name=e,this.rank=t,this.schema=n,this.spec=s,this.attrs=lr(e,s.attrs),this.excluded=null;let r=ir(this.attrs);this.instance=r?new Es(this,r):null}create(e=null){return!e&&this.instance?this.instance:new Es(this,or(this.attrs,e))}static compile(e,t){let n=Object.create(null),s=0;return e.forEach(((e,r)=>n[e]=new hr(e,s++,t,r))),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){ar(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class ur{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let s in e)t[s]=e[s];t.nodes=ws.from(e.nodes),t.marks=ws.from(e.marks||{}),this.nodes=cr.compile(this.spec.nodes,this),this.marks=hr.compile(this.spec.marks,this);let n=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let e=this.nodes[s],t=e.spec.content||"",r=e.spec.marks;if(e.contentMatch=n[t]||(n[t]=Xs.parse(t,this.nodes)),e.inlineContent=e.contentMatch.inlineContent,e.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!e.isInline||!e.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=e}e.markSet="_"==r?null:r?pr(this,r.split(" ")):""!=r&&e.inlineContent?null:[]}for(let s in this.marks){let e=this.marks[s],t=e.spec.excludes;e.excluded=null==t?[e]:""==t?[]:pr(this,t.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,s){if("string"==typeof e)e=this.nodeType(e);else{if(!(e instanceof cr))throw new RangeError("Invalid node type: "+e);if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}return e.createChecked(t,n,s)}text(e,t){let n=this.nodes.text;return new Ks(n,n.defaultAttrs,e,Es.setFrom(t))}mark(e,t){return"string"==typeof e&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return Js.fromJSON(this,e)}markFromJSON(e){return Es.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function pr(e,t){let n=[];for(let s=0;s<t.length;s++){let r=t[s],i=e.marks[r],o=i;if(i)n.push(i);else for(let t in e.marks){let s=e.marks[t];("_"==r||s.spec.group&&s.spec.group.split(" ").indexOf(r)>-1)&&n.push(o=s)}if(!o)throw new SyntaxError("Unknown mark type: '"+t[s]+"'")}return n}class fr{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach((e=>{if(function(e){return null!=e.tag}(e))this.tags.push(e);else if(function(e){return null!=e.style}(e)){let t=/[^=]*/.exec(e.style)[0];n.indexOf(t)<0&&n.push(t),this.styles.push(e)}})),this.normalizeLists=!this.tags.some((t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let n=e.nodes[t.node];return n.contentMatch.matchType(n)}))}parse(e,t={}){let n=new wr(this,t,!1);return n.addAll(e,Es.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new wr(this,t,!0);return n.addAll(e,Es.none,t.from,t.to),Ms.maxOpen(n.finish())}matchTag(e,t,n){for(let s=n?this.tags.indexOf(n)+1:0;s<this.tags.length;s++){let n=this.tags[s];if(xr(e,n.tag)&&(void 0===n.namespace||e.namespaceURI==n.namespace)&&(!n.context||t.matchesContext(n.context))){if(n.getAttrs){let t=n.getAttrs(e);if(!1===t)continue;n.attrs=t||void 0}return n}}}matchStyle(e,t,n,s){for(let r=s?this.styles.indexOf(s)+1:0;r<this.styles.length;r++){let s=this.styles[r],i=s.style;if(!(0!=i.indexOf(e)||s.context&&!n.matchesContext(s.context)||i.length>e.length&&(61!=i.charCodeAt(e.length)||i.slice(e.length+1)!=t))){if(s.getAttrs){let e=s.getAttrs(t);if(!1===e)continue;s.attrs=e||void 0}return s}}}static schemaRules(e){let t=[];function n(e){let n=null==e.priority?50:e.priority,s=0;for(;s<t.length;s++){let e=t[s];if((null==e.priority?50:e.priority)<n)break}t.splice(s,0,e)}for(let s in e.marks){let t=e.marks[s].spec.parseDOM;t&&t.forEach((e=>{n(e=kr(e)),e.mark||e.ignore||e.clearMark||(e.mark=s)}))}for(let s in e.nodes){let t=e.nodes[s].spec.parseDOM;t&&t.forEach((e=>{n(e=kr(e)),e.node||e.ignore||e.mark||(e.node=s)}))}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new fr(e,fr.schemaRules(e)))}}const mr={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},gr={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},yr={ol:!0,ul:!0};function vr(e,t,n){return null!=t?(t?1:0)|("full"===t?2:0):e&&"pre"==e.whitespace?3:-5&n}class br{constructor(e,t,n,s,r,i){this.type=e,this.attrs=t,this.marks=n,this.solid=s,this.options=i,this.content=[],this.activeMarks=Es.none,this.match=r||(4&i?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Ss.from(e));if(!t){let t,n=this.type.contentMatch;return(t=n.findWrapping(e.type))?(this.match=n,t):null}this.match=this.type.contentMatch.matchFragment(t)}return this.match.findWrapping(e.type)}finish(e){if(!(1&this.options)){let e,t=this.content[this.content.length-1];if(t&&t.isText&&(e=/[ \t\r\n\u000c]+$/.exec(t.text))){let n=t;t.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length))}}let t=Ss.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Ss.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!mr.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class wr{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0;let s,r=t.topNode,i=vr(null,t.preserveWhitespace,0)|(n?4:0);s=r?new br(r.type,r.attrs,Es.none,!0,t.topMatch||r.type.contentMatch,i):new br(n?null:e.schema.topNodeType,null,Es.none,!0,null,i),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){3==e.nodeType?this.addTextNode(e,t):1==e.nodeType&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,s=this.top;if(2&s.options||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(1&s.options)n=2&s.options?n.replace(/\r\n?/g,"\n"):n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let t=s.content[s.content.length-1],r=e.previousSibling;(!t||r&&"BR"==r.nodeName||t.isText&&/[ \t\r\n\u000c]$/.test(t.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),t),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let s,r=e.nodeName.toLowerCase();yr.hasOwnProperty(r)&&this.parser.normalizeLists&&function(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let e=1==t.nodeType?t.nodeName.toLowerCase():null;e&&yr.hasOwnProperty(e)&&n?(n.appendChild(t),t=n):"li"==e?n=t:e&&(n=null)}}(e);let i=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(s=this.parser.matchTag(e,this,n));if(i?i.ignore:gr.hasOwnProperty(r))this.findInside(e),this.ignoreFallback(e,t);else if(!i||i.skip||i.closeParent){i&&i.closeParent?this.open=Math.max(0,this.open-1):i&&i.skip.nodeType&&(e=i.skip);let n,s=this.top,o=this.needsBlock;if(mr.hasOwnProperty(r))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),n=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild)return void this.leafFallback(e,t);let a=i&&i.skip?t:this.readStyles(e,t);a&&this.addAll(e,a),n&&this.sync(s),this.needsBlock=o}else{let n=this.readStyles(e,t);n&&this.addElementByRule(e,i,n,!1===i.consuming?s:void 0)}}leafFallback(e,t){"BR"==e.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode("\n"),t)}ignoreFallback(e,t){"BR"!=e.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),t)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let e=this.parser.matchedStyles[s],r=n.getPropertyValue(e);if(r)for(let n;;){let s=this.parser.matchStyle(e,r,this,n);if(!s)break;if(s.ignore)return null;if(t=s.clearMark?t.filter((e=>!s.clearMark(e))):t.concat(this.parser.schema.marks[s.mark].create(s.attrs)),!1!==s.consuming)break;n=s}}return t}addElementByRule(e,t,n,s){let r,i;if(t.node)if(i=this.parser.schema.nodes[t.node],i.isLeaf)this.insertNode(i.create(t.attrs),n)||this.leafFallback(e,n);else{let e=this.enter(i,t.attrs||null,n,t.preserveWhitespace);e&&(r=!0,n=e)}else{let e=this.parser.schema.marks[t.mark];n=n.concat(e.create(t.attrs))}let o=this.top;if(i&&i.isLeaf)this.findInside(e);else if(s)this.addElement(e,n,s);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach((e=>this.insertNode(e,n)));else{let s=e;"string"==typeof t.contentElement?s=e.querySelector(t.contentElement):"function"==typeof t.contentElement?s=t.contentElement(e):t.contentElement&&(s=t.contentElement),this.findAround(e,s,!0),this.addAll(s,n),this.findAround(e,s,!1)}r&&this.sync(o)&&this.open--}addAll(e,t,n,s){let r=n||0;for(let i=n?e.childNodes[n]:e.firstChild,o=null==s?null:e.childNodes[s];i!=o;i=i.nextSibling,++r)this.findAtPoint(e,r),this.addDOM(i,t);this.findAtPoint(e,r)}findPlace(e,t){let n,s;for(let r=this.open;r>=0;r--){let t=this.nodes[r],i=t.findWrapping(e);if(i&&(!n||n.length>i.length)&&(n=i,s=t,!i.length))break;if(t.solid)break}if(!n)return null;this.sync(s);for(let r=0;r<n.length;r++)t=this.enterInner(n[r],null,t,!1);return t}insertNode(e,t){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&(t=this.enterInner(e,null,t))}let n=this.findPlace(e,t);if(n){this.closeExtra();let t=this.top;t.match&&(t.match=t.match.matchType(e.type));let s=Es.none;for(let r of n.concat(e.marks))(t.type?t.type.allowsMarkType(r.type):Sr(r.type,e.type))&&(s=r.addToSet(s));return t.content.push(e.mark(s)),!0}return!1}enter(e,t,n,s){let r=this.findPlace(e.create(t),n);return r&&(r=this.enterInner(e,t,n,!0,s)),r}enterInner(e,t,n,s=!1,r){this.closeExtra();let i=this.top;i.match=i.match&&i.match.matchType(e);let o=vr(e,r,i.options);4&i.options&&0==i.content.length&&(o|=4);let a=Es.none;return n=n.filter((t=>!(i.type?i.type.allowsMarkType(t.type):Sr(t.type,e))||(a=t.addToSet(a),!1))),this.nodes.push(new br(e,t,a,s,null,o)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let t=n.length-1;t>=0;t--)e+=n[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)null==this.find[t].pos&&1==e.nodeType&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let s=0;s<this.find.length;s++)if(null==this.find[s].pos&&1==e.nodeType&&e.contains(this.find[s].node)){t.compareDocumentPosition(this.find[s].node)&(n?2:4)&&(this.find[s].pos=this.currentPos)}}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,s=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),r=-(n?n.depth+1:0)+(s?0:1),i=(e,o)=>{for(;e>=0;e--){let a=t[e];if(""==a){if(e==t.length-1||0==e)continue;for(;o>=r;o--)if(i(e-1,o))return!0;return!1}{let e=o>0||0==o&&s?this.nodes[o].type:n&&o>=r?n.node(o-r).type:null;if(!e||e.name!=a&&!e.isInGroup(a))return!1;o--}}return!0};return i(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let e=this.parser.schema.nodes[t];if(e.isTextblock&&e.defaultAttrs)return e}}}function xr(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function kr(e){let t={};for(let n in e)t[n]=e[n];return t}function Sr(e,t){let n=t.schema.nodes;for(let s in n){let r=n[s];if(!r.allowsMarkType(e))continue;let i=[],o=e=>{i.push(e);for(let n=0;n<e.edgeCount;n++){let{type:s,next:r}=e.edge(n);if(s==t)return!0;if(i.indexOf(r)<0&&o(r))return!0}};if(o(r.contentMatch))return!0}}class Cr{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=Or(t).createDocumentFragment());let s=n,r=[];return e.forEach((e=>{if(r.length||e.marks.length){let n=0,i=0;for(;n<r.length&&i<e.marks.length;){let t=e.marks[i];if(this.marks[t.type.name]){if(!t.eq(r[n][0])||!1===t.type.spec.spanning)break;n++,i++}else i++}for(;n<r.length;)s=r.pop()[1];for(;i<e.marks.length;){let n=e.marks[i++],o=this.serializeMark(n,e.isInline,t);o&&(r.push([n,s]),s.appendChild(o.dom),s=o.contentDOM||o.dom)}}s.appendChild(this.serializeNodeInner(e,t))})),n}serializeNodeInner(e,t){let{dom:n,contentDOM:s}=Mr(Or(t),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,s)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let s=e.marks.length-1;s>=0;s--){let r=this.serializeMark(e.marks[s],e.isInline,t);r&&((r.contentDOM||r.dom).appendChild(n),n=r.dom)}return n}serializeMark(e,t,n={}){let s=this.marks[e.type.name];return s&&Mr(Or(n),s(e,t),null,e.attrs)}static renderSpec(e,t,n=null,s){return Mr(e,t,n,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Cr(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Tr(e.nodes);return t.text||(t.text=e=>e.text),t}static marksFromSchema(e){return Tr(e.marks)}}function Tr(e){let t={};for(let n in e){let s=e[n].spec.toDOM;s&&(t[n]=s)}return t}function Or(e){return e.document||window.document}const Er=new WeakMap;function Nr(e){let t=Er.get(e);return void 0===t&&Er.set(e,t=function(e){let t=null;function n(e){if(e&&"object"==typeof e)if(Array.isArray(e))if("string"==typeof e[0])t||(t=[]),t.push(e);else for(let t=0;t<e.length;t++)n(e[t]);else for(let t in e)n(e[t])}return n(e),t}(e)),t}function Mr(e,t,n,s){if("string"==typeof t)return{dom:e.createTextNode(t)};if(null!=t.nodeType)return{dom:t};if(t.dom&&null!=t.dom.nodeType)return t;let r,i=t[0];if("string"!=typeof i)throw new RangeError("Invalid array passed to renderSpec");if(s&&(r=Nr(s))&&r.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o,a=i.indexOf(" ");a>0&&(n=i.slice(0,a),i=i.slice(a+1));let l=n?e.createElementNS(n,i):e.createElement(i),c=t[1],d=1;if(c&&"object"==typeof c&&null==c.nodeType&&!Array.isArray(c)){d=2;for(let e in c)if(null!=c[e]){let t=e.indexOf(" ");t>0?l.setAttributeNS(e.slice(0,t),e.slice(t+1),c[e]):l.setAttribute(e,c[e])}}for(let h=d;h<t.length;h++){let r=t[h];if(0===r){if(h<t.length-1||h>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}{let{dom:t,contentDOM:i}=Mr(e,r,n,s);if(l.appendChild(t),i){if(o)throw new RangeError("Multiple content holes");o=i}}}return{dom:l,contentDOM:o}}const jr=Math.pow(2,16);function _r(e){return 65535&e}class Ar{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class Dr{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Dr.empty)return Dr.empty}recover(e){let t=0,n=_r(e);if(!this.inverted)for(let s=0;s<n;s++)t+=this.ranges[3*s+2]-this.ranges[3*s+1];return this.ranges[3*n]+t+function(e){return(e-(65535&e))/jr}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let s=0,r=this.inverted?2:1,i=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let a=this.ranges[o]-(this.inverted?s:0);if(a>e)break;let l=this.ranges[o+r],c=this.ranges[o+i],d=a+l;if(e<=d){let r=a+s+((l?e==a?-1:e==d?1:t:t)<0?0:c);if(n)return r;let i=e==(t<0?a:d)?null:o/3+(e-a)*jr,h=e==a?2:e==d?1:4;return(t<0?e!=a:e!=d)&&(h|=8),new Ar(r,h,i)}s+=c-l}return n?e+s:new Ar(e+s,0,null)}touches(e,t){let n=0,s=_r(t),r=this.inverted?2:1,i=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let t=this.ranges[o]-(this.inverted?n:0);if(t>e)break;let a=this.ranges[o+r];if(e<=t+a&&o==3*s)return!0;n+=this.ranges[o+i]-a}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let s=0,r=0;s<this.ranges.length;s+=3){let i=this.ranges[s],o=i-(this.inverted?r:0),a=i+(this.inverted?0:r),l=this.ranges[s+t],c=this.ranges[s+n];e(o,o+l,a,a+c),r+=c-l}}invert(){return new Dr(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return 0==e?Dr.empty:new Dr(e<0?[0,-e,0]:[0,0,e])}}Dr.empty=new Dr([]);class Rr{constructor(e=[],t,n=0,s=e.length){this.maps=e,this.mirror=t,this.from=n,this.to=s}slice(e=0,t=this.maps.length){return new Rr(this.maps,this.mirror,e,t)}copy(){return new Rr(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),null!=t&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,n=this.maps.length;t<e.maps.length;t++){let s=e.getMirror(t);this.appendMap(e.maps[t],null!=s&&s<t?n+s:void 0)}}getMirror(e){if(this.mirror)for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this.maps.length+e.maps.length;t>=0;t--){let s=e.getMirror(t);this.appendMap(e.maps[t].invert(),null!=s&&s>t?n-s-1:void 0)}}invert(){let e=new Rr;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this.maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let s=0;for(let r=this.from;r<this.to;r++){let n=this.maps[r].mapResult(e,t);if(null!=n.recover){let t=this.getMirror(r);if(null!=t&&t>r&&t<this.to){r=t,e=this.maps[t].recover(n.recover);continue}}s|=n.delInfo,e=n.pos}return n?e:new Ar(e,s,null)}}const Pr=Object.create(null);class Ir{getMap(){return Dr.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=Pr[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in Pr)throw new RangeError("Duplicate use of step JSON ID "+e);return Pr[e]=t,t.prototype.jsonID=e,t}}class $r{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new $r(e,null)}static fail(e){return new $r(null,e)}static fromReplace(e,t,n,s){try{return $r.ok(e.replace(t,n,s))}catch(tm){if(tm instanceof Ns)return $r.fail(tm.message);throw tm}}}function Lr(e,t,n){let s=[];for(let r=0;r<e.childCount;r++){let i=e.child(r);i.content.size&&(i=i.copy(Lr(i.content,t,i))),i.isInline&&(i=t(i,n,r)),s.push(i)}return Ss.fromArray(s)}class Br extends Ir{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),s=n.node(n.sharedDepth(this.to)),r=new Ms(Lr(t.content,((e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e),s),t.openStart,t.openEnd);return $r.fromReplace(e,this.from,this.to,r)}invert(){return new zr(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Br(t.pos,n.pos,this.mark)}merge(e){return e instanceof Br&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Br(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Br(t.from,t.to,e.markFromJSON(t.mark))}}Ir.jsonID("addMark",Br);class zr extends Ir{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Ms(Lr(t.content,(e=>e.mark(this.mark.removeFromSet(e.marks))),e),t.openStart,t.openEnd);return $r.fromReplace(e,this.from,this.to,n)}invert(){return new Br(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new zr(t.pos,n.pos,this.mark)}merge(e){return e instanceof zr&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new zr(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new zr(t.from,t.to,e.markFromJSON(t.mark))}}Ir.jsonID("removeMark",zr);class Fr extends Ir{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return $r.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return $r.fromReplace(e,this.pos,this.pos+1,new Ms(Ss.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let e=this.mark.addToSet(t.marks);if(e.length==t.marks.length){for(let n=0;n<t.marks.length;n++)if(!t.marks[n].isInSet(e))return new Fr(this.pos,t.marks[n]);return new Fr(this.pos,this.mark)}}return new Hr(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Fr(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Fr(t.pos,e.markFromJSON(t.mark))}}Ir.jsonID("addNodeMark",Fr);class Hr extends Ir{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return $r.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return $r.fromReplace(e,this.pos,this.pos+1,new Ms(Ss.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new Fr(this.pos,this.mark):this}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Hr(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Hr(t.pos,e.markFromJSON(t.mark))}}Ir.jsonID("removeNodeMark",Hr);class Vr extends Ir{constructor(e,t,n,s=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=s}apply(e){return this.structure&&qr(e,this.from,this.to)?$r.fail("Structure replace would overwrite content"):$r.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Dr([this.from,this.to-this.from,this.slice.size])}invert(e){return new Vr(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new Vr(t.pos,Math.max(t.pos,n.pos),this.slice)}merge(e){if(!(e instanceof Vr)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let t=this.slice.size+e.slice.size==0?Ms.empty:new Ms(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Vr(e.from,this.to,t,this.structure)}}{let t=this.slice.size+e.slice.size==0?Ms.empty:new Ms(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Vr(this.from,this.to+(e.to-e.from),t,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Vr(t.from,t.to,Ms.fromJSON(e,t.slice),!!t.structure)}}Ir.jsonID("replace",Vr);class Ur extends Ir{constructor(e,t,n,s,r,i,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=s,this.slice=r,this.insert=i,this.structure=o}apply(e){if(this.structure&&(qr(e,this.from,this.gapFrom)||qr(e,this.gapTo,this.to)))return $r.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return $r.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?$r.fromReplace(e,this.from,this.to,n):$r.fail("Content does not fit in gap")}getMap(){return new Dr([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Ur(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),s=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),r=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||s<t.pos||r>n.pos?null:new Ur(t.pos,n.pos,s,r,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to||"number"!=typeof t.gapFrom||"number"!=typeof t.gapTo||"number"!=typeof t.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Ur(t.from,t.to,t.gapFrom,t.gapTo,Ms.fromJSON(e,t.slice),t.insert,!!t.structure)}}function qr(e,t,n){let s=e.resolve(t),r=n-t,i=s.depth;for(;r>0&&i>0&&s.indexAfter(i)==s.node(i).childCount;)i--,r--;if(r>0){let e=s.node(i).maybeChild(s.indexAfter(i));for(;r>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,r--}}return!1}function Wr(e,t,n,s=n.contentMatch,r=!0){let i=e.doc.nodeAt(t),o=[],a=t+1;for(let l=0;l<i.childCount;l++){let t=i.child(l),c=a+t.nodeSize,d=s.matchType(t.type);if(d){s=d;for(let s=0;s<t.marks.length;s++)n.allowsMarkType(t.marks[s].type)||e.step(new zr(a,c,t.marks[s]));if(r&&t.isText&&"pre"!=n.whitespace){let e,s,r=/\r?\n|\r/g;for(;e=r.exec(t.text);)s||(s=new Ms(Ss.from(n.schema.text(" ",n.allowedMarks(t.marks))),0,0)),o.push(new Vr(a+e.index,a+e.index+e[0].length,s))}}else o.push(new Vr(a,c,Ms.empty));a=c}if(!s.validEnd){let t=s.fillBefore(Ss.empty,!0);e.replace(a,a,new Ms(t,0,0))}for(let l=o.length-1;l>=0;l--)e.step(o[l])}function Jr(e,t,n){return(0==t||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function Kr(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let n=e.depth;;--n){let s=e.$from.node(n),r=e.$from.index(n),i=e.$to.indexAfter(n);if(n<e.depth&&s.canReplace(r,i,t))return n;if(0==n||s.type.spec.isolating||!Jr(s,r,i))break}return null}function Gr(e,t,n=null,s=e){let r=function(e,t){let{parent:n,startIndex:s,endIndex:r}=e,i=n.contentMatchAt(s).findWrapping(t);if(!i)return null;let o=i.length?i[0]:t;return n.canReplaceWith(s,r,o)?i:null}(e,t),i=r&&function(e,t){let{parent:n,startIndex:s,endIndex:r}=e,i=n.child(s),o=t.contentMatch.findWrapping(i.type);if(!o)return null;let a=(o.length?o[o.length-1]:t).contentMatch;for(let l=s;a&&l<r;l++)a=a.matchType(n.child(l).type);return a&&a.validEnd?o:null}(s,t);return i?r.map(Xr).concat({type:t,attrs:n}).concat(i.map(Xr)):null}function Xr(e){return{type:e,attrs:null}}function Yr(e,t,n,s){t.forEach(((r,i)=>{if(r.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(r.text);){let r=e.mapping.slice(s).map(n+1+i+o.index);e.replaceWith(r,r+1,t.type.schema.linebreakReplacement.create())}}}))}function Qr(e,t,n,s){t.forEach(((r,i)=>{if(r.type==r.type.schema.linebreakReplacement){let r=e.mapping.slice(s).map(n+1+i);e.replaceWith(r,r+1,t.type.schema.text("\n"))}}))}function Zr(e,t,n=1,s){let r=e.resolve(t),i=r.depth-n,o=s&&s[s.length-1]||r.parent;if(i<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!o.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let c=r.depth-1,d=n-2;c>i;c--,d--){let e=r.node(c),t=r.index(c);if(e.type.spec.isolating)return!1;let n=e.content.cutByIndex(t,e.childCount),i=s&&s[d+1];i&&(n=n.replaceChild(0,i.type.create(i.attrs)));let o=s&&s[d]||e;if(!e.canReplace(t+1,e.childCount)||!o.type.validContent(n))return!1}let a=r.indexAfter(i),l=s&&s[0];return r.node(i).canReplaceWith(a,a,l?l.type:r.node(i+1).type)}function ei(e,t){let n=e.resolve(t),s=n.index();return ti(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(s,s+1)}function ti(e,t){return!(!e||!t||e.isLeaf||!function(e,t){t.content.size||e.type.compatibleContent(t.type);let n=e.contentMatchAt(e.childCount),{linebreakReplacement:s}=e.type.schema;for(let r=0;r<t.childCount;r++){let i=t.child(r),o=i.type==s?e.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n)return!1;if(!e.type.allowsMarks(i.marks))return!1}return n.validEnd}(e,t))}function ni(e,t,n=-1){let s=e.resolve(t);for(let r=s.depth;;r--){let e,i,o=s.index(r);if(r==s.depth?(e=s.nodeBefore,i=s.nodeAfter):n>0?(e=s.node(r+1),o++,i=s.node(r).maybeChild(o)):(e=s.node(r).maybeChild(o-1),i=s.node(r+1)),e&&!e.isTextblock&&ti(e,i)&&s.node(r).canReplace(o,o+1))return t;if(0==r)break;t=n<0?s.before(r):s.after(r)}}function si(e,t,n){let s=e.resolve(t);if(!n.content.size)return t;let r=n.content;for(let i=0;i<n.openStart;i++)r=r.firstChild.content;for(let i=1;i<=(0==n.openStart&&n.size?2:1);i++)for(let e=s.depth;e>=0;e--){let t=e==s.depth?0:s.pos<=(s.start(e+1)+s.end(e+1))/2?-1:1,n=s.index(e)+(t>0?1:0),o=s.node(e),a=!1;if(1==i)a=o.canReplace(n,n,r);else{let e=o.contentMatchAt(n).findWrapping(r.firstChild.type);a=e&&o.canReplaceWith(n,n,e[0])}if(a)return 0==t?s.pos:t<0?s.before(e+1):s.after(e+1)}return null}function ri(e,t,n=t,s=Ms.empty){if(t==n&&!s.size)return null;let r=e.resolve(t),i=e.resolve(n);return ii(r,i,s)?new Vr(t,n,s):new oi(r,i,s).fit()}function ii(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}Ir.jsonID("replaceAround",Ur);class oi{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=Ss.empty;for(let s=0;s<=e.depth;s++){let t=e.node(s);this.frontier.push({type:t.type,match:t.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=Ss.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,s=this.close(e<0?this.$to:n.doc.resolve(e));if(!s)return null;let r=this.placed,i=n.depth,o=s.depth;for(;i&&o&&1==r.childCount;)r=r.firstChild.content,i--,o--;let a=new Ms(r,i,o);return e>-1?new Ur(n.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||n.pos!=this.$to.pos?new Vr(n.pos,s.pos,a):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,s=this.unplaced.openEnd;n<e;n++){let r=t.firstChild;if(t.childCount>1&&(s=0),r.type.spec.isolating&&s<=n){e=n;break}t=r.content}for(let t=1;t<=2;t++)for(let n=1==t?e:this.unplaced.openStart;n>=0;n--){let e,s=null;n?(s=ci(this.unplaced.content,n-1).firstChild,e=s.content):e=this.unplaced.content;let r=e.firstChild;for(let i=this.depth;i>=0;i--){let e,{type:o,match:a}=this.frontier[i],l=null;if(1==t&&(r?a.matchType(r.type)||(l=a.fillBefore(Ss.from(r),!1)):s&&o.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:i,parent:s,inject:l};if(2==t&&r&&(e=a.findWrapping(r.type)))return{sliceDepth:n,frontierDepth:i,parent:s,wrap:e};if(s&&a.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=ci(e,t);return!(!s.childCount||s.firstChild.isLeaf)&&(this.unplaced=new Ms(e,t+1,Math.max(n,s.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=ci(e,t);if(s.childCount<=1&&t>0){let r=e.size-t<=t+s.size;this.unplaced=new Ms(ai(e,t-1,1),t-1,r?t-1:n)}else this.unplaced=new Ms(ai(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:s,wrap:r}){for(;this.depth>t;)this.closeFrontierNode();if(r)for(let f=0;f<r.length;f++)this.openFrontierNode(r[f]);let i=this.unplaced,o=n?n.content:i.content,a=i.openStart-e,l=0,c=[],{match:d,type:h}=this.frontier[t];if(s){for(let e=0;e<s.childCount;e++)c.push(s.child(e));d=d.matchFragment(s)}let u=o.size+e-(i.content.size-i.openEnd);for(;l<o.childCount;){let e=o.child(l),t=d.matchType(e.type);if(!t)break;l++,(l>1||0==a||e.content.size)&&(d=t,c.push(di(e.mark(h.allowedMarks(e.marks)),1==l?a:0,l==o.childCount?u:-1)))}let p=l==o.childCount;p||(u=-1),this.placed=li(this.placed,t,Ss.from(c)),this.frontier[t].match=d,p&&u<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let f=0,m=o;f<u;f++){let e=m.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),m=e.content}this.unplaced=p?0==e?Ms.empty:new Ms(ai(i.content,e-1,1),e-1,u<0?i.openEnd:e-1):new Ms(ai(i.content,e,l),i.openStart,i.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e,t=this.frontier[this.depth];if(!t.type.isTextblock||!hi(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,s=this.$to.after(n);for(;n>1&&s==this.$to.end(--n);)++s;return s}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:s}=this.frontier[t],r=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),i=hi(e,t,s,n,r);if(i){for(let n=t-1;n>=0;n--){let{match:t,type:s}=this.frontier[n],r=hi(e,n,s,t,!0);if(!r||r.childCount)continue e}return{depth:t,fit:i,move:r?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=li(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),s=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,s)}return e}openFrontierNode(e,t=null,n){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=li(this.placed,this.depth,Ss.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(Ss.empty,!0);e.childCount&&(this.placed=li(this.placed,this.frontier.length,e))}}function ai(e,t,n){return 0==t?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(ai(e.firstChild.content,t-1,n)))}function li(e,t,n){return 0==t?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(li(e.lastChild.content,t-1,n)))}function ci(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function di(e,t,n){if(t<=0)return e;let s=e.content;return t>1&&(s=s.replaceChild(0,di(s.firstChild,t-1,1==s.childCount?n-1:0))),t>0&&(s=e.type.contentMatch.fillBefore(s).append(s),n<=0&&(s=s.append(e.type.contentMatch.matchFragment(s).fillBefore(Ss.empty,!0)))),e.copy(s)}function hi(e,t,n,s,r){let i=e.node(t),o=r?e.indexAfter(t):e.index(t);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=s.fillBefore(i.content,!0,o);return a&&!function(e,t,n){for(let s=n;s<t.childCount;s++)if(!e.allowsMarks(t.child(s).marks))return!0;return!1}(n,i.content,o)?a:null}function ui(e,t,n,s,r){if(t<n){let r=e.firstChild;e=e.replaceChild(0,r.copy(ui(r.content,t+1,n,s,r)))}if(t>s){let t=r.contentMatchAt(0),n=t.fillBefore(e).append(e);e=n.append(t.matchFragment(n).fillBefore(Ss.empty,!0))}return e}function pi(e,t){let n=[];for(let s=Math.min(e.depth,t.depth);s>=0;s--){let r=e.start(s);if(r<e.pos-(e.depth-s)||t.end(s)>t.pos+(t.depth-s)||e.node(s).type.spec.isolating||t.node(s).type.spec.isolating)break;(r==t.start(s)||s==e.depth&&s==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&s&&t.start(s-1)==r-1)&&n.push(s)}return n}class fi extends Ir{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return $r.fail("No node at attribute step's position");let n=Object.create(null);for(let r in t.attrs)n[r]=t.attrs[r];n[this.attr]=this.value;let s=t.type.create(n,null,t.marks);return $r.fromReplace(e,this.pos,this.pos+1,new Ms(Ss.from(s),0,t.isLeaf?0:1))}getMap(){return Dr.empty}invert(e){return new fi(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new fi(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if("number"!=typeof t.pos||"string"!=typeof t.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new fi(t.pos,t.attr,t.value)}}Ir.jsonID("attr",fi);class mi extends Ir{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let s in e.attrs)t[s]=e.attrs[s];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return $r.ok(n)}getMap(){return Dr.empty}invert(e){return new mi(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if("string"!=typeof t.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new mi(t.attr,t.value)}}Ir.jsonID("docAttr",mi);let gi=class extends Error{};gi=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},(gi.prototype=Object.create(Error.prototype)).constructor=gi,gi.prototype.name="TransformError";class yi{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Rr}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new gi(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=Ms.empty){let s=ri(this.doc,e,t,n);return s&&this.step(s),this}replaceWith(e,t,n){return this.replace(e,t,new Ms(Ss.from(n),0,0))}delete(e,t){return this.replace(e,t,Ms.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return function(e,t,n,s){if(!s.size)return e.deleteRange(t,n);let r=e.doc.resolve(t),i=e.doc.resolve(n);if(ii(r,i,s))return e.step(new Vr(t,n,s));let o=pi(r,e.doc.resolve(n));0==o[o.length-1]&&o.pop();let a=-(r.depth+1);o.unshift(a);for(let p=r.depth,f=r.pos-1;p>0;p--,f--){let e=r.node(p).type.spec;if(e.defining||e.definingAsContext||e.isolating)break;o.indexOf(p)>-1?a=p:r.before(p)==f&&o.splice(1,0,-p)}let l=o.indexOf(a),c=[],d=s.openStart;for(let p=s.content,f=0;;f++){let e=p.firstChild;if(c.push(e),f==s.openStart)break;p=e.content}for(let p=d-1;p>=0;p--){let e=c[p],t=(h=e.type).spec.defining||h.spec.definingForContent;if(t&&!e.sameMarkup(r.node(Math.abs(a)-1)))d=p;else if(t||!e.type.isTextblock)break}var h;for(let p=s.openStart;p>=0;p--){let t=(p+d+1)%(s.openStart+1),a=c[t];if(a)for(let c=0;c<o.length;c++){let d=o[(c+l)%o.length],h=!0;d<0&&(h=!1,d=-d);let u=r.node(d-1),p=r.index(d-1);if(u.canReplaceWith(p,p,a.type,a.marks))return e.replace(r.before(d),h?i.after(d):n,new Ms(ui(s.content,0,s.openStart,t),t,s.openEnd))}}let u=e.steps.length;for(let p=o.length-1;p>=0&&(e.replace(t,n,s),!(e.steps.length>u));p--){let e=o[p];e<0||(t=r.before(e),n=i.after(e))}}(this,e,t,n),this}replaceRangeWith(e,t,n){return function(e,t,n,s){if(!s.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let r=function(e,t,n){let s=e.resolve(t);if(s.parent.canReplaceWith(s.index(),s.index(),n))return t;if(0==s.parentOffset)for(let r=s.depth-1;r>=0;r--){let e=s.index(r);if(s.node(r).canReplaceWith(e,e,n))return s.before(r+1);if(e>0)return null}if(s.parentOffset==s.parent.content.size)for(let r=s.depth-1;r>=0;r--){let e=s.indexAfter(r);if(s.node(r).canReplaceWith(e,e,n))return s.after(r+1);if(e<s.node(r).childCount)return null}return null}(e.doc,t,s.type);null!=r&&(t=n=r)}e.replaceRange(t,n,new Ms(Ss.from(s),0,0))}(this,e,t,n),this}deleteRange(e,t){return function(e,t,n){let s=e.doc.resolve(t),r=e.doc.resolve(n),i=pi(s,r);for(let o=0;o<i.length;o++){let t=i[o],n=o==i.length-1;if(n&&0==t||s.node(t).type.contentMatch.validEnd)return e.delete(s.start(t),r.end(t));if(t>0&&(n||s.node(t-1).canReplace(s.index(t-1),r.indexAfter(t-1))))return e.delete(s.before(t),r.after(t))}for(let o=1;o<=s.depth&&o<=r.depth;o++)if(t-s.start(o)==s.depth-o&&n>s.end(o)&&r.end(o)-n!=r.depth-o&&s.start(o-1)==r.start(o-1)&&s.node(o-1).canReplace(s.index(o-1),r.index(o-1)))return e.delete(s.before(o),n);e.delete(t,n)}(this,e,t),this}lift(e,t){return function(e,t,n){let{$from:s,$to:r,depth:i}=t,o=s.before(i+1),a=r.after(i+1),l=o,c=a,d=Ss.empty,h=0;for(let f=i,m=!1;f>n;f--)m||s.index(f)>0?(m=!0,d=Ss.from(s.node(f).copy(d)),h++):l--;let u=Ss.empty,p=0;for(let f=i,m=!1;f>n;f--)m||r.after(f+1)<r.end(f)?(m=!0,u=Ss.from(r.node(f).copy(u)),p++):c++;e.step(new Ur(l,c,o,a,new Ms(d.append(u),h,p),d.size-h,!0))}(this,e,t),this}join(e,t=1){return function(e,t,n){let s=null,{linebreakReplacement:r}=e.doc.type.schema,i=e.doc.resolve(t-n),o=i.node().type;if(r&&o.inlineContent){let e="pre"==o.whitespace,t=!!o.contentMatch.matchType(r);e&&!t?s=!1:!e&&t&&(s=!0)}let a=e.steps.length;if(!1===s){let s=e.doc.resolve(t+n);Qr(e,s.node(),s.before(),a)}o.inlineContent&&Wr(e,t+n-1,o,i.node().contentMatchAt(i.index()),null==s);let l=e.mapping.slice(a),c=l.map(t-n);if(e.step(new Vr(c,l.map(t+n,-1),Ms.empty,!0)),!0===s){let t=e.doc.resolve(c);Yr(e,t.node(),t.before(),e.steps.length)}}(this,e,t),this}wrap(e,t){return function(e,t,n){let s=Ss.empty;for(let o=n.length-1;o>=0;o--){if(s.size){let e=n[o].type.contentMatch.matchFragment(s);if(!e||!e.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=Ss.from(n[o].type.create(n[o].attrs,s))}let r=t.start,i=t.end;e.step(new Ur(r,i,r,i,new Ms(s,0,0),n.length,!0))}(this,e,t),this}setBlockType(e,t=e,n,s=null){return function(e,t,n,s,r){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=e.steps.length;e.doc.nodesBetween(t,n,((t,n)=>{let o="function"==typeof r?r(t):r;if(t.isTextblock&&!t.hasMarkup(s,o)&&function(e,t,n){let s=e.resolve(t),r=s.index();return s.parent.canReplaceWith(r,r+1,n)}(e.doc,e.mapping.slice(i).map(n),s)){let r=null;if(s.schema.linebreakReplacement){let e="pre"==s.whitespace,t=!!s.contentMatch.matchType(s.schema.linebreakReplacement);e&&!t?r=!1:!e&&t&&(r=!0)}!1===r&&Qr(e,t,n,i),Wr(e,e.mapping.slice(i).map(n,1),s,void 0,null===r);let a=e.mapping.slice(i),l=a.map(n,1),c=a.map(n+t.nodeSize,1);return e.step(new Ur(l,c,l+1,c-1,new Ms(Ss.from(s.create(o,null,t.marks)),0,0),1,!0)),!0===r&&Yr(e,t,n,i),!1}}))}(this,e,t,n,s),this}setNodeMarkup(e,t,n=null,s){return function(e,t,n,s,r){let i=e.doc.nodeAt(t);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(s,null,r||i.marks);if(i.isLeaf)return e.replaceWith(t,t+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);e.step(new Ur(t,t+i.nodeSize,t+1,t+i.nodeSize-1,new Ms(Ss.from(o),0,0),1,!0))}(this,e,t,n,s),this}setNodeAttribute(e,t,n){return this.step(new fi(e,t,n)),this}setDocAttribute(e,t){return this.step(new mi(e,t)),this}addNodeMark(e,t){return this.step(new Fr(e,t)),this}removeNodeMark(e,t){if(!(t instanceof Es)){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(!(t=t.isInSet(n.marks)))return this}return this.step(new Hr(e,t)),this}split(e,t=1,n){return function(e,t,n=1,s){let r=e.doc.resolve(t),i=Ss.empty,o=Ss.empty;for(let a=r.depth,l=r.depth-n,c=n-1;a>l;a--,c--){i=Ss.from(r.node(a).copy(i));let e=s&&s[c];o=Ss.from(e?e.type.create(e.attrs,o):r.node(a).copy(o))}e.step(new Vr(t,t,new Ms(i.append(o),n,n),!0))}(this,e,t,n),this}addMark(e,t,n){return function(e,t,n,s){let r,i,o=[],a=[];e.doc.nodesBetween(t,n,((e,l,c)=>{if(!e.isInline)return;let d=e.marks;if(!s.isInSet(d)&&c.type.allowsMarkType(s.type)){let c=Math.max(l,t),h=Math.min(l+e.nodeSize,n),u=s.addToSet(d);for(let e=0;e<d.length;e++)d[e].isInSet(u)||(r&&r.to==c&&r.mark.eq(d[e])?r.to=h:o.push(r=new zr(c,h,d[e])));i&&i.to==c?i.to=h:a.push(i=new Br(c,h,s))}})),o.forEach((t=>e.step(t))),a.forEach((t=>e.step(t)))}(this,e,t,n),this}removeMark(e,t,n){return function(e,t,n,s){let r=[],i=0;e.doc.nodesBetween(t,n,((e,o)=>{if(!e.isInline)return;i++;let a=null;if(s instanceof hr){let t,n=e.marks;for(;t=s.isInSet(n);)(a||(a=[])).push(t),n=t.removeFromSet(n)}else s?s.isInSet(e.marks)&&(a=[s]):a=e.marks;if(a&&a.length){let s=Math.min(o+e.nodeSize,n);for(let e=0;e<a.length;e++){let n,l=a[e];for(let e=0;e<r.length;e++){let t=r[e];t.step==i-1&&l.eq(r[e].style)&&(n=t)}n?(n.to=s,n.step=i):r.push({style:l,from:Math.max(o,t),to:s,step:i})}}})),r.forEach((t=>e.step(new zr(t.from,t.to,t.style))))}(this,e,t,n),this}clearIncompatible(e,t,n){return Wr(this,e,t,n),this}}const vi=Object.create(null);class bi{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new wi(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Ms.empty){let n=t.content.lastChild,s=null;for(let o=0;o<t.openEnd;o++)s=n,n=n.lastChild;let r=e.steps.length,i=this.ranges;for(let o=0;o<i.length;o++){let{$from:a,$to:l}=i[o],c=e.mapping.slice(r);e.replaceRange(c.map(a.pos),c.map(l.pos),o?Ms.empty:t),0==o&&ji(e,r,(n?n.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,s=this.ranges;for(let r=0;r<s.length;r++){let{$from:i,$to:o}=s[r],a=e.mapping.slice(n),l=a.map(i.pos),c=a.map(o.pos);r?e.deleteRange(l,c):(e.replaceRangeWith(l,c,t),ji(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let s=e.parent.inlineContent?new Si(e):Mi(e.node(0),e.parent,e.pos,e.index(),t,n);if(s)return s;for(let r=e.depth-1;r>=0;r--){let s=t<0?Mi(e.node(0),e.node(r),e.before(r+1),e.index(r),t,n):Mi(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,n);if(s)return s}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Ei(e.node(0))}static atStart(e){return Mi(e,e,0,0,1)||new Ei(e)}static atEnd(e){return Mi(e,e,e.content.size,e.childCount,-1)||new Ei(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=vi[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in vi)throw new RangeError("Duplicate use of selection JSON ID "+e);return vi[e]=t,t.prototype.jsonID=e,t}getBookmark(){return Si.between(this.$anchor,this.$head).getBookmark()}}bi.prototype.visible=!0;class wi{constructor(e,t){this.$from=e,this.$to=t}}let xi=!1;function ki(e){xi||e.parent.inlineContent||(xi=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class Si extends bi{constructor(e,t=e){ki(e),ki(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return bi.near(n);let s=e.resolve(t.map(this.anchor));return new Si(s.parent.inlineContent?s:n,n)}replace(e,t=Ms.empty){if(super.replace(e,t),t==Ms.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof Si&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Ci(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new Si(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let s=e.resolve(t);return new this(s,n==t?s:e.resolve(n))}static between(e,t,n){let s=e.pos-t.pos;if(n&&!s||(n=s>=0?1:-1),!t.parent.inlineContent){let e=bi.findFrom(t,n,!0)||bi.findFrom(t,-n,!0);if(!e)return bi.near(t,n);t=e.$head}return e.parent.inlineContent||(0==s||(e=(bi.findFrom(e,-n,!0)||bi.findFrom(e,n,!0)).$anchor).pos<t.pos!=s<0)&&(e=t),new Si(e,t)}}bi.jsonID("text",Si);class Ci{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Ci(e.map(this.anchor),e.map(this.head))}resolve(e){return Si.between(e.resolve(this.anchor),e.resolve(this.head))}}class Ti extends bi{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:s}=t.mapResult(this.anchor),r=e.resolve(s);return n?bi.near(r):new Ti(r)}content(){return new Ms(Ss.from(this.node),0,0)}eq(e){return e instanceof Ti&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Oi(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Ti(e.resolve(t.anchor))}static create(e,t){return new Ti(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}Ti.prototype.visible=!1,bi.jsonID("node",Ti);class Oi{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new Ci(n,n):new Oi(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&Ti.isSelectable(n)?new Ti(t):bi.near(t)}}class Ei extends bi{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Ms.empty){if(t==Ms.empty){e.delete(0,e.doc.content.size);let t=bi.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new Ei(e)}map(e){return new Ei(e)}eq(e){return e instanceof Ei}getBookmark(){return Ni}}bi.jsonID("all",Ei);const Ni={map(){return this},resolve:e=>new Ei(e)};function Mi(e,t,n,s,r,i=!1){if(t.inlineContent)return Si.create(e,n);for(let o=s-(r>0?0:1);r>0?o<t.childCount:o>=0;o+=r){let s=t.child(o);if(s.isAtom){if(!i&&Ti.isSelectable(s))return Ti.create(e,n-(r<0?s.nodeSize:0))}else{let t=Mi(e,s,n+r,r<0?s.childCount:0,r,i);if(t)return t}n+=s.nodeSize*r}return null}function ji(e,t,n){let s=e.steps.length-1;if(s<t)return;let r,i=e.steps[s];(i instanceof Vr||i instanceof Ur)&&(e.mapping.maps[s].forEach(((e,t,n,s)=>{null==r&&(r=s)})),e.setSelection(bi.near(e.doc.resolve(r),n)))}class _i extends yi{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=-3&this.updated|1,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=2,this}ensureMarks(e){return Es.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(e,t){super.addStep(e,t),this.updated=-3&this.updated,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||Es.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let s=this.doc.type.schema;if(null==t)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(null==n&&(n=t),n=null==n?t:n,!e)return this.deleteRange(t,n);let r=this.storedMarks;if(!r){let e=this.doc.resolve(t);r=n==t?e.marks():e.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,s.text(e,r)),this.selection.empty||this.setSelection(bi.near(this.selection.$to)),this}}setMeta(e,t){return this.meta["string"==typeof e?e:e.key]=t,this}getMeta(e){return this.meta["string"==typeof e?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function Ai(e,t){return t&&e?e.bind(t):e}class Di{constructor(e,t,n){this.name=e,this.init=Ai(t.init,n),this.apply=Ai(t.apply,n)}}const Ri=[new Di("doc",{init:e=>e.doc||e.schema.topNodeType.createAndFill(),apply:e=>e.doc}),new Di("selection",{init:(e,t)=>e.selection||bi.atStart(t.doc),apply:e=>e.selection}),new Di("storedMarks",{init:e=>e.storedMarks||null,apply:(e,t,n,s)=>s.selection.$cursor?e.storedMarks:null}),new Di("scrollToSelection",{init:()=>0,apply:(e,t)=>e.scrolledIntoView?t+1:t})];class Pi{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Ri.slice(),t&&t.forEach((e=>{if(this.pluginsByKey[e.key])throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")");this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new Di(e.key,e.spec.state,e))}))}}class Ii{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let t=this.config.plugins[n];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),s=null;for(;;){let r=!1;for(let i=0;i<this.config.plugins.length;i++){let o=this.config.plugins[i];if(o.spec.appendTransaction){let a=s?s[i].n:0,l=s?s[i].state:this,c=a<t.length&&o.spec.appendTransaction.call(o,a?t.slice(a):t,l,n);if(c&&n.filterTransaction(c,i)){if(c.setMeta("appendedTransaction",e),!s){s=[];for(let e=0;e<this.config.plugins.length;e++)s.push(e<i?{state:n,n:t.length}:{state:this,n:0})}t.push(c),n=n.applyInner(c),r=!0}s&&(s[i]={state:n,n:t.length})}}if(!r)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new Ii(this.config),n=this.config.fields;for(let s=0;s<n.length;s++){let r=n[s];t[r.name]=r.apply(e,this[r.name],this,t)}return t}get tr(){return new _i(this)}static create(e){let t=new Pi(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new Ii(t);for(let s=0;s<t.fields.length;s++)n[t.fields[s].name]=t.fields[s].init(e,n);return n}reconfigure(e){let t=new Pi(this.schema,e.plugins),n=t.fields,s=new Ii(t);for(let r=0;r<n.length;r++){let t=n[r].name;s[t]=this.hasOwnProperty(t)?this[t]:n[r].init(e,s)}return s}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map((e=>e.toJSON()))),e&&"object"==typeof e)for(let n in e){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[n],r=s.spec.state;r&&r.toJSON&&(t[n]=r.toJSON.call(s,this[s.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new Pi(e.schema,e.plugins),r=new Ii(s);return s.fields.forEach((s=>{if("doc"==s.name)r.doc=Js.fromJSON(e.schema,t.doc);else if("selection"==s.name)r.selection=bi.fromJSON(r.doc,t.selection);else if("storedMarks"==s.name)t.storedMarks&&(r.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let i in n){let o=n[i],a=o.spec.state;if(o.key==s.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(t,i))return void(r[s.name]=a.fromJSON.call(o,e,t[i],r))}r[s.name]=s.init(e,r)}})),r}}function $i(e,t,n){for(let s in e){let r=e[s];r instanceof Function?r=r.bind(t):"handleDOMEvents"==s&&(r=$i(r,t,{})),n[s]=r}return n}class Li{constructor(e){this.spec=e,this.props={},e.props&&$i(e.props,this,this.props),this.key=e.key?e.key.key:zi("plugin")}getState(e){return e[this.key]}}const Bi=Object.create(null);function zi(e){return e in Bi?e+"$"+ ++Bi[e]:(Bi[e]=0,e+"$")}class Fi{constructor(e="key"){this.key=zi(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Hi=function(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t},Vi=function(e){let t=e.assignedSlot||e.parentNode;return t&&11==t.nodeType?t.host:t};let Ui=null;const qi=function(e,t,n){let s=Ui||(Ui=document.createRange());return s.setEnd(e,null==n?e.nodeValue.length:n),s.setStart(e,t||0),s},Wi=function(e,t,n,s){return n&&(Ki(e,t,n,s,-1)||Ki(e,t,n,s,1))},Ji=/^(img|br|input|textarea|hr)$/i;function Ki(e,t,n,s,r){for(;;){if(e==n&&t==s)return!0;if(t==(r<0?0:Gi(e))){let n=e.parentNode;if(!n||1!=n.nodeType||Xi(e)||Ji.test(e.nodeName)||"false"==e.contentEditable)return!1;t=Hi(e)+(r<0?0:1),e=n}else{if(1!=e.nodeType)return!1;if("false"==(e=e.childNodes[t+(r<0?-1:0)]).contentEditable)return!1;t=r<0?Gi(e):0}}}function Gi(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function Xi(e){let t;for(let n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}const Yi=function(e){return e.focusNode&&Wi(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function Qi(e,t){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=e,n.key=n.code=t,n}const Zi="undefined"!=typeof navigator?navigator:null,eo="undefined"!=typeof document?document:null,to=Zi&&Zi.userAgent||"",no=/Edge\/(\d+)/.exec(to),so=/MSIE \d/.exec(to),ro=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(to),io=!!(so||ro||no),oo=so?document.documentMode:ro?+ro[1]:no?+no[1]:0,ao=!io&&/gecko\/(\d+)/i.test(to);ao&&(/Firefox\/(\d+)/.exec(to)||[0,0])[1];const lo=!io&&/Chrome\/(\d+)/.exec(to),co=!!lo,ho=lo?+lo[1]:0,uo=!io&&!!Zi&&/Apple Computer/.test(Zi.vendor),po=uo&&(/Mobile\/\w+/.test(to)||!!Zi&&Zi.maxTouchPoints>2),fo=po||!!Zi&&/Mac/.test(Zi.platform),mo=!!Zi&&/Win/.test(Zi.platform),go=/Android \d/.test(to),yo=!!eo&&"webkitFontSmoothing"in eo.documentElement.style,vo=yo?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function bo(e){let t=e.defaultView&&e.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function wo(e,t){return"number"==typeof e?e:e[t]}function xo(e){let t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,s=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*n,top:t.top,bottom:t.top+e.clientHeight*s}}function ko(e,t,n){let s=e.someProp("scrollThreshold")||0,r=e.someProp("scrollMargin")||5,i=e.dom.ownerDocument;for(let o=n||e.dom;o;o=Vi(o)){if(1!=o.nodeType)continue;let e=o,n=e==i.body,a=n?bo(i):xo(e),l=0,c=0;if(t.top<a.top+wo(s,"top")?c=-(a.top-t.top+wo(r,"top")):t.bottom>a.bottom-wo(s,"bottom")&&(c=t.bottom-t.top>a.bottom-a.top?t.top+wo(r,"top")-a.top:t.bottom-a.bottom+wo(r,"bottom")),t.left<a.left+wo(s,"left")?l=-(a.left-t.left+wo(r,"left")):t.right>a.right-wo(s,"right")&&(l=t.right-a.right+wo(r,"right")),l||c)if(n)i.defaultView.scrollBy(l,c);else{let n=e.scrollLeft,s=e.scrollTop;c&&(e.scrollTop+=c),l&&(e.scrollLeft+=l);let r=e.scrollLeft-n,i=e.scrollTop-s;t={left:t.left-r,top:t.top-i,right:t.right-r,bottom:t.bottom-i}}if(n||/^(fixed|sticky)$/.test(getComputedStyle(o).position))break}}function So(e){let t=[],n=e.ownerDocument;for(let s=e;s&&(t.push({dom:s,top:s.scrollTop,left:s.scrollLeft}),e!=n);s=Vi(s));return t}function Co(e,t){for(let n=0;n<e.length;n++){let{dom:s,top:r,left:i}=e[n];s.scrollTop!=r+t&&(s.scrollTop=r+t),s.scrollLeft!=i&&(s.scrollLeft=i)}}let To=null;function Oo(e,t){let n,s,r,i,o=2e8,a=0,l=t.top,c=t.top;for(let d=e.firstChild,h=0;d;d=d.nextSibling,h++){let e;if(1==d.nodeType)e=d.getClientRects();else{if(3!=d.nodeType)continue;e=qi(d).getClientRects()}for(let u=0;u<e.length;u++){let p=e[u];if(p.top<=l&&p.bottom>=c){l=Math.max(p.bottom,l),c=Math.min(p.top,c);let e=p.left>t.left?p.left-t.left:p.right<t.left?t.left-p.right:0;if(e<o){n=d,o=e,s=e&&3==n.nodeType?{left:p.right<t.left?p.right:p.left,top:t.top}:t,1==d.nodeType&&e&&(a=h+(t.left>=(p.left+p.right)/2?1:0));continue}}else p.top>t.top&&!r&&p.left<=t.left&&p.right>=t.left&&(r=d,i={left:Math.max(p.left,Math.min(p.right,t.left)),top:p.top});!n&&(t.left>=p.right&&t.top>=p.top||t.left>=p.left&&t.top>=p.bottom)&&(a=h+1)}}return!n&&r&&(n=r,s=i,o=0),n&&3==n.nodeType?function(e,t){let n=e.nodeValue.length,s=document.createRange();for(let r=0;r<n;r++){s.setEnd(e,r+1),s.setStart(e,r);let n=_o(s,1);if(n.top!=n.bottom&&Eo(t,n))return{node:e,offset:r+(t.left>=(n.left+n.right)/2?1:0)}}return{node:e,offset:0}}(n,s):!n||o&&1==n.nodeType?{node:e,offset:a}:Oo(n,s)}function Eo(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function No(e,t,n){let s=e.childNodes.length;if(s&&n.top<n.bottom)for(let r=Math.max(0,Math.min(s-1,Math.floor(s*(t.top-n.top)/(n.bottom-n.top))-2)),i=r;;){let n=e.childNodes[i];if(1==n.nodeType){let e=n.getClientRects();for(let s=0;s<e.length;s++){let r=e[s];if(Eo(t,r))return No(n,t,r)}}if((i=(i+1)%s)==r)break}return e}function Mo(e,t){let n,s=e.dom.ownerDocument,r=0,i=function(e,t,n){if(e.caretPositionFromPoint)try{let s=e.caretPositionFromPoint(t,n);if(s)return{node:s.offsetNode,offset:Math.min(Gi(s.offsetNode),s.offset)}}catch(s){}if(e.caretRangeFromPoint){let s=e.caretRangeFromPoint(t,n);if(s)return{node:s.startContainer,offset:Math.min(Gi(s.startContainer),s.startOffset)}}}(s,t.left,t.top);i&&({node:n,offset:r}=i);let o,a=(e.root.elementFromPoint?e.root:s).elementFromPoint(t.left,t.top);if(!a||!e.dom.contains(1!=a.nodeType?a.parentNode:a)){let n=e.dom.getBoundingClientRect();if(!Eo(t,n))return null;if(a=No(e.dom,t,n),!a)return null}if(uo)for(let c=a;n&&c;c=Vi(c))c.draggable&&(n=void 0);if(a=function(e,t){let n=e.parentNode;return n&&/^li$/i.test(n.nodeName)&&t.left<e.getBoundingClientRect().left?n:e}(a,t),n){if(ao&&1==n.nodeType&&(r=Math.min(r,n.childNodes.length),r<n.childNodes.length)){let e,s=n.childNodes[r];"IMG"==s.nodeName&&(e=s.getBoundingClientRect()).right<=t.left&&e.bottom>t.top&&r++}let s;yo&&r&&1==n.nodeType&&1==(s=n.childNodes[r-1]).nodeType&&"false"==s.contentEditable&&s.getBoundingClientRect().top>=t.top&&r--,n==e.dom&&r==n.childNodes.length-1&&1==n.lastChild.nodeType&&t.top>n.lastChild.getBoundingClientRect().bottom?o=e.state.doc.content.size:0!=r&&1==n.nodeType&&"BR"==n.childNodes[r-1].nodeName||(o=function(e,t,n,s){let r=-1;for(let i=t,o=!1;i!=e.dom;){let t=e.docView.nearestDesc(i,!0);if(!t)return null;if(1==t.dom.nodeType&&(t.node.isBlock&&t.parent||!t.contentDOM)){let e=t.dom.getBoundingClientRect();if(t.node.isBlock&&t.parent&&(!o&&e.left>s.left||e.top>s.top?r=t.posBefore:(!o&&e.right<s.left||e.bottom<s.top)&&(r=t.posAfter),o=!0),!t.contentDOM&&r<0&&!t.node.isText)return(t.node.isBlock?s.top<(e.top+e.bottom)/2:s.left<(e.left+e.right)/2)?t.posBefore:t.posAfter}i=t.dom.parentNode}return r>-1?r:e.docView.posFromDOM(t,n,-1)}(e,n,r,t))}null==o&&(o=function(e,t,n){let{node:s,offset:r}=Oo(t,n),i=-1;if(1==s.nodeType&&!s.firstChild){let e=s.getBoundingClientRect();i=e.left!=e.right&&n.left>(e.left+e.right)/2?1:-1}return e.docView.posFromDOM(s,r,i)}(e,a,t));let l=e.docView.nearestDesc(a,!0);return{pos:o,inside:l?l.posAtStart-l.border:-1}}function jo(e){return e.top<e.bottom||e.left<e.right}function _o(e,t){let n=e.getClientRects();if(n.length){let e=n[t<0?0:n.length-1];if(jo(e))return e}return Array.prototype.find.call(n,jo)||e.getBoundingClientRect()}const Ao=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Do(e,t,n){let{node:s,offset:r,atom:i}=e.docView.domFromPos(t,n<0?-1:1),o=yo||ao;if(3==s.nodeType){if(!o||!Ao.test(s.nodeValue)&&(n<0?r:r!=s.nodeValue.length)){let e=r,t=r,i=n<0?1:-1;return n<0&&!r?(t++,i=-1):n>=0&&r==s.nodeValue.length?(e--,i=1):n<0?e--:t++,Ro(_o(qi(s,e,t),i),i<0)}{let e=_o(qi(s,r,r),n);if(ao&&r&&/\s/.test(s.nodeValue[r-1])&&r<s.nodeValue.length){let t=_o(qi(s,r-1,r-1),-1);if(t.top==e.top){let n=_o(qi(s,r,r+1),-1);if(n.top!=e.top)return Ro(n,n.left<t.left)}}return e}}if(!e.state.doc.resolve(t-(i||0)).parent.inlineContent){if(null==i&&r&&(n<0||r==Gi(s))){let e=s.childNodes[r-1];if(1==e.nodeType)return Po(e.getBoundingClientRect(),!1)}if(null==i&&r<Gi(s)){let e=s.childNodes[r];if(1==e.nodeType)return Po(e.getBoundingClientRect(),!0)}return Po(s.getBoundingClientRect(),n>=0)}if(null==i&&r&&(n<0||r==Gi(s))){let e=s.childNodes[r-1],t=3==e.nodeType?qi(e,Gi(e)-(o?0:1)):1!=e.nodeType||"BR"==e.nodeName&&e.nextSibling?null:e;if(t)return Ro(_o(t,1),!1)}if(null==i&&r<Gi(s)){let e=s.childNodes[r];for(;e.pmViewDesc&&e.pmViewDesc.ignoreForCoords;)e=e.nextSibling;let t=e?3==e.nodeType?qi(e,0,o?0:1):1==e.nodeType?e:null:null;if(t)return Ro(_o(t,-1),!0)}return Ro(_o(3==s.nodeType?qi(s):s,-n),n>=0)}function Ro(e,t){if(0==e.width)return e;let n=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:n,right:n}}function Po(e,t){if(0==e.height)return e;let n=t?e.top:e.bottom;return{top:n,bottom:n,left:e.left,right:e.right}}function Io(e,t,n){let s=e.state,r=e.root.activeElement;s!=t&&e.updateState(t),r!=e.dom&&e.focus();try{return n()}finally{s!=t&&e.updateState(s),r!=e.dom&&r&&r.focus()}}const $o=/[\u0590-\u08ac]/;let Lo=null,Bo=null,zo=!1;function Fo(e,t,n){return Lo==t&&Bo==n?zo:(Lo=t,Bo=n,zo="up"==n||"down"==n?function(e,t,n){let s=t.selection,r="up"==n?s.$from:s.$to;return Io(e,t,(()=>{let{node:t}=e.docView.domFromPos(r.pos,"up"==n?-1:1);for(;;){let n=e.docView.nearestDesc(t,!0);if(!n)break;if(n.node.isBlock){t=n.contentDOM||n.dom;break}t=n.dom.parentNode}let s=Do(e,r.pos,1);for(let e=t.firstChild;e;e=e.nextSibling){let t;if(1==e.nodeType)t=e.getClientRects();else{if(3!=e.nodeType)continue;t=qi(e,0,e.nodeValue.length).getClientRects()}for(let e=0;e<t.length;e++){let r=t[e];if(r.bottom>r.top+1&&("up"==n?s.top-r.top>2*(r.bottom-s.top):r.bottom-s.bottom>2*(s.bottom-r.top)))return!1}}return!0}))}(e,t,n):function(e,t,n){let{$head:s}=t.selection;if(!s.parent.isTextblock)return!1;let r=s.parentOffset,i=!r,o=r==s.parent.content.size,a=e.domSelection();return a?$o.test(s.parent.textContent)&&a.modify?Io(e,t,(()=>{let{focusNode:t,focusOffset:r,anchorNode:i,anchorOffset:o}=e.domSelectionRange(),l=a.caretBidiLevel;a.modify("move",n,"character");let c=s.depth?e.docView.domAfterPos(s.before()):e.dom,{focusNode:d,focusOffset:h}=e.domSelectionRange(),u=d&&!c.contains(1==d.nodeType?d:d.parentNode)||t==d&&r==h;try{a.collapse(i,o),t&&(t!=i||r!=o)&&a.extend&&a.extend(t,r)}catch(p){}return null!=l&&(a.caretBidiLevel=l),u})):"left"==n||"backward"==n?i:o:s.pos==s.start()||s.pos==s.end()}(e,t,n))}class Ho{constructor(e,t,n,s){this.parent=e,this.children=t,this.dom=n,this.contentDOM=s,this.dirty=0,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let s=this.children[t];if(s==e)return n;n+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(1==e.nodeType?e:e.parentNode)){if(n<0){let n,s;if(e==this.contentDOM)n=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.previousSibling}for(;n&&(!(s=n.pmViewDesc)||s.parent!=this);)n=n.previousSibling;return n?this.posBeforeChild(s)+s.size:this.posAtStart}{let n,s;if(e==this.contentDOM)n=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.nextSibling}for(;n&&(!(s=n.pmViewDesc)||s.parent!=this);)n=n.nextSibling;return n?this.posBeforeChild(s):this.posAtEnd}}let s;if(e==this.dom&&this.contentDOM)s=t>Hi(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=2&e.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==t)for(let t=e;;t=t.parentNode){if(t==this.dom){s=!1;break}if(t.previousSibling)break}if(null==s&&t==e.childNodes.length)for(let t=e;;t=t.parentNode){if(t==this.dom){s=!0;break}if(t.nextSibling)break}}return(null==s?n>0:s)?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,s=e;s;s=s.parentNode){let r,i=this.getDesc(s);if(i&&(!t||i.node)){if(!n||!(r=i.nodeDOM)||(1==r.nodeType?r.contains(1==e.nodeType?e:e.parentNode):r==e))return i;n=!1}}}getDesc(e){let t=e.pmViewDesc;for(let n=t;n;n=n.parent)if(n==this)return t}posFromDOM(e,t,n){for(let s=e;s;s=s.parentNode){let r=this.getDesc(s);if(r)return r.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let s=this.children[t],r=n+s.size;if(n==e&&r!=n){for(;!s.border&&s.children.length;)s=s.children[0];return s}if(e<r)return s.descAt(e-n-s.border);n=r}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,s=0;for(let r=0;n<this.children.length;n++){let t=this.children[n],i=r+t.size;if(i>e||t instanceof Go){s=e-r;break}r=i}if(s)return this.children[n].domFromPos(s-this.children[n].border,t);for(let r;n&&!(r=this.children[n-1]).size&&r instanceof Vo&&r.side>=0;n--);if(t<=0){let e,s=!0;for(;e=n?this.children[n-1]:null,e&&e.dom.parentNode!=this.contentDOM;n--,s=!1);return e&&t&&s&&!e.border&&!e.domAtom?e.domFromPos(e.size,t):{node:this.contentDOM,offset:e?Hi(e.dom)+1:0}}{let e,s=!0;for(;e=n<this.children.length?this.children[n]:null,e&&e.dom.parentNode!=this.contentDOM;n++,s=!1);return e&&s&&!e.border&&!e.domAtom?e.domFromPos(0,t):{node:this.contentDOM,offset:e?Hi(e.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(0==this.children.length)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,r=-1;for(let i=n,o=0;;o++){let n=this.children[o],a=i+n.size;if(-1==s&&e<=a){let r=i+n.border;if(e>=r&&t<=a-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(e,t,r);e=i;for(let t=o;t>0;t--){let n=this.children[t-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){s=Hi(n.dom)+1;break}e-=n.size}-1==s&&(s=0)}if(s>-1&&(a>t||o==this.children.length-1)){t=a;for(let e=o+1;e<this.children.length;e++){let n=this.children[e];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){r=Hi(n.dom);break}t+=n.size}-1==r&&(r=this.contentDOM.childNodes.length);break}i=a}return{node:this.contentDOM,from:e,to:t,fromOffset:s,toOffset:r}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return 0==t.size||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(1!=t.nodeType||n==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[n]}setSelection(e,t,n,s=!1){let r=Math.min(e,t),i=Math.max(e,t);for(let p=0,f=0;p<this.children.length;p++){let o=this.children[p],a=f+o.size;if(r>f&&i<a)return o.setSelection(e-f-o.border,t-f-o.border,n,s);f=a}let o=this.domFromPos(e,e?-1:1),a=t==e?o:this.domFromPos(t,t?-1:1),l=n.root.getSelection(),c=n.domSelectionRange(),d=!1;if((ao||uo)&&e==t){let{node:e,offset:t}=o;if(3==e.nodeType){if(d=!(!t||"\n"!=e.nodeValue[t-1]),d&&t==e.nodeValue.length)for(let n,s=e;s;s=s.parentNode){if(n=s.nextSibling){"BR"==n.nodeName&&(o=a={node:n.parentNode,offset:Hi(n)+1});break}let e=s.pmViewDesc;if(e&&e.node&&e.node.isBlock)break}}else{let n=e.childNodes[t-1];d=n&&("BR"==n.nodeName||"false"==n.contentEditable)}}if(ao&&c.focusNode&&c.focusNode!=a.node&&1==c.focusNode.nodeType){let e=c.focusNode.childNodes[c.focusOffset];e&&"false"==e.contentEditable&&(s=!0)}if(!(s||d&&uo)&&Wi(o.node,o.offset,c.anchorNode,c.anchorOffset)&&Wi(a.node,a.offset,c.focusNode,c.focusOffset))return;let h=!1;if((l.extend||e==t)&&!d){l.collapse(o.node,o.offset);try{e!=t&&l.extend(a.node,a.offset),h=!0}catch(u){}}if(!h){if(e>t){let e=o;o=a,a=e}let n=document.createRange();n.setEnd(a.node,a.offset),n.setStart(o.node,o.offset),l.removeAllRanges(),l.addRange(n)}}ignoreMutation(e){return!this.contentDOM&&"selection"!=e.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,s=0;s<this.children.length;s++){let r=this.children[s],i=n+r.size;if(n==i?e<=i&&t>=n:e<i&&t>n){let s=n+r.border,o=i-r.border;if(e>=s&&t<=o)return this.dirty=e==n||t==i?2:1,void(e!=s||t!=o||!r.contentLost&&r.dom.parentNode==this.contentDOM?r.markDirty(e-s,t-s):r.dirty=3);r.dirty=r.dom!=r.contentDOM||r.dom.parentNode!=this.contentDOM||r.children.length?3:2}n=i}this.dirty=2}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=1==e?2:1;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(e){return!1}}class Vo extends Ho{constructor(e,t,n,s){let r,i=t.type.toDOM;if("function"==typeof i&&(i=i(n,(()=>r?r.parent?r.parent.posBeforeChild(r):void 0:s))),!t.type.spec.raw){if(1!=i.nodeType){let e=document.createElement("span");e.appendChild(i),i=e}i.contentEditable="false",i.classList.add("ProseMirror-widget")}super(e,[],i,null),this.widget=t,this.widget=t,r=this}matchesWidget(e){return 0==this.dirty&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return!!t&&t(e)}ignoreMutation(e){return"selection"!=e.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class Uo extends Ho{constructor(e,t,n,s){super(e,[],t,null),this.textDOM=n,this.text=s}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return"characterData"===e.type&&e.target.nodeValue==e.oldValue}}class qo extends Ho{constructor(e,t,n,s,r){super(e,[],n,s),this.mark=t,this.spec=r}static create(e,t,n,s){let r=s.nodeViews[t.type.name],i=r&&r(t,s,n);return i&&i.dom||(i=Cr.renderSpec(document,t.type.spec.toDOM(t,n),null,t.attrs)),new qo(e,t,i.dom,i.contentDOM||i.dom,i)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return 3!=this.dirty&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),0!=this.dirty){let e=this.parent;for(;!e.node;)e=e.parent;e.dirty<this.dirty&&(e.dirty=this.dirty),this.dirty=0}}slice(e,t,n){let s=qo.create(this.parent,this.mark,!0,n),r=this.children,i=this.size;t<i&&(r=la(r,t,i,n)),e>0&&(r=la(r,0,e,n));for(let o=0;o<r.length;o++)r[o].parent=s;return s.children=r,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Wo extends Ho{constructor(e,t,n,s,r,i,o,a,l){super(e,[],r,i),this.node=t,this.outerDeco=n,this.innerDeco=s,this.nodeDOM=o}static create(e,t,n,s,r,i){let o,a=r.nodeViews[t.type.name],l=a&&a(t,r,(()=>o?o.parent?o.parent.posBeforeChild(o):void 0:i),n,s),c=l&&l.dom,d=l&&l.contentDOM;if(t.isText)if(c){if(3!=c.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else c=document.createTextNode(t.text);else if(!c){let e=Cr.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs);({dom:c,contentDOM:d}=e)}d||t.isText||"BR"==c.nodeName||(c.hasAttribute("contenteditable")||(c.contentEditable="false"),t.type.spec.draggable&&(c.draggable=!0));let h=c;return c=sa(c,n,t),l?o=new Xo(e,t,n,s,c,d||null,h,l,r,i+1):t.isText?new Ko(e,t,n,s,c,h,r):new Wo(e,t,n,s,c,d||null,h,r,i+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Ss.empty)}else e.contentElement=this.contentDOM;else e.getContent=()=>this.node.content;return e}matchesNode(e,t,n){return 0==this.dirty&&e.eq(this.node)&&ra(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,s=t,r=e.composing?this.localCompositionInfo(e,t):null,i=r&&r.pos>-1?r:null,o=r&&r.pos<0,a=new oa(this,i&&i.node,e);!function(e,t,n,s){let r=t.locals(e),i=0;if(0==r.length){for(let n=0;n<e.childCount;n++){let o=e.child(n);s(o,r,t.forChild(i,o),n),i+=o.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let d,h,u,p;for(;o<r.length&&r[o].to==i;){let e=r[o++];e.widget&&(d?(h||(h=[d])).push(e):d=e)}if(d)if(h){h.sort(aa);for(let e=0;e<h.length;e++)n(h[e],c,!!l)}else n(d,c,!!l);if(l)p=-1,u=l,l=null;else{if(!(c<e.childCount))break;p=c,u=e.child(c++)}for(let e=0;e<a.length;e++)a[e].to<=i&&a.splice(e--,1);for(;o<r.length&&r[o].from<=i&&r[o].to>i;)a.push(r[o++]);let f=i+u.nodeSize;if(u.isText){let e=f;o<r.length&&r[o].from<e&&(e=r[o].from);for(let t=0;t<a.length;t++)a[t].to<e&&(e=a[t].to);e<f&&(l=u.cut(e-i),u=u.cut(0,e-i),f=e,p=-1)}else for(;o<r.length&&r[o].to<f;)o++;s(u,u.isInline&&!u.isLeaf?a.filter((e=>!e.inline)):a.slice(),t.forChild(i,u),p),i=f}}(this.node,this.innerDeco,((t,r,i)=>{t.spec.marks?a.syncToMarks(t.spec.marks,n,e):t.type.side>=0&&!i&&a.syncToMarks(r==this.node.childCount?Es.none:this.node.child(r).marks,n,e),a.placeWidget(t,e,s)}),((t,i,l,c)=>{let d;a.syncToMarks(t.marks,n,e),a.findNodeMatch(t,i,l,c)||o&&e.state.selection.from>s&&e.state.selection.to<s+t.nodeSize&&(d=a.findIndexWithChild(r.node))>-1&&a.updateNodeAt(t,i,l,d,e)||a.updateNextNode(t,i,l,e,c,s)||a.addNode(t,i,l,e,s),s+=t.nodeSize})),a.syncToMarks([],n,e),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||2==this.dirty)&&(i&&this.protectLocalComposition(e,i),Yo(this.contentDOM,this.children,e),po&&function(e){if("UL"==e.nodeName||"OL"==e.nodeName){let t=e.style.cssText;e.style.cssText=t+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=t}}(this.dom))}localCompositionInfo(e,t){let{from:n,to:s}=e.state.selection;if(!(e.state.selection instanceof Si)||n<t||s>t+this.node.content.size)return null;let r=e.input.compositionNode;if(!r||!this.dom.contains(r.parentNode))return null;if(this.node.inlineContent){let e=r.nodeValue,i=function(e,t,n,s){for(let r=0,i=0;r<e.childCount&&i<=s;){let o=e.child(r++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;r<e.childCount;){let t=e.child(r++);if(i+=t.nodeSize,!t.isText)break;l+=t.text}if(i>=n){if(i>=s&&l.slice(s-t.length-a,s-a)==t)return s-t.length;let e=a<s?l.lastIndexOf(t,s-a-1):-1;if(e>=0&&e+t.length+a>=n)return a+e;if(n==s&&l.length>=s+t.length-a&&l.slice(s-a,s-a+t.length)==t)return s}}return-1}(this.node.content,e,n-t,s-t);return i<0?null:{node:r,pos:i,text:e}}return{node:r,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:n,text:s}){if(this.getDesc(t))return;let r=t;for(;r.parentNode!=this.contentDOM;r=r.parentNode){for(;r.previousSibling;)r.parentNode.removeChild(r.previousSibling);for(;r.nextSibling;)r.parentNode.removeChild(r.nextSibling);r.pmViewDesc&&(r.pmViewDesc=void 0)}let i=new Uo(this,r,t,s);e.input.compositionNodes.push(i),this.children=la(this.children,n,n+s.length,e,i)}update(e,t,n,s){return!(3==this.dirty||!e.sameMarkup(this.node))&&(this.updateInner(e,t,n,s),!0)}updateInner(e,t,n,s){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=0}updateOuterDeco(e){if(ra(e,this.outerDeco))return;let t=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=ta(this.dom,this.nodeDOM,ea(this.outerDeco,this.node,t),ea(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function Jo(e,t,n,s,r){sa(s,t,e);let i=new Wo(void 0,e,t,n,s,s,s,r,0);return i.contentDOM&&i.updateChildren(r,0),i}class Ko extends Wo{constructor(e,t,n,s,r,i,o){super(e,t,n,s,r,null,i,o,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,s){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!e.sameMarkup(this.node))&&(this.updateOuterDeco(t),0==this.dirty&&e.text==this.node.text||e.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=0,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return"characterData"!=e.type&&"selection"!=e.type}slice(e,t,n){let s=this.node.cut(e,t),r=document.createTextNode(s.text);return new Ko(this.parent,s,this.outerDeco,this.innerDeco,r,r,n)}markDirty(e,t){super.markDirty(e,t),this.dom==this.nodeDOM||0!=e&&t!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}isText(e){return this.node.text==e}}class Go extends Ho{parseRule(){return{ignore:!0}}matchesHack(e){return 0==this.dirty&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class Xo extends Wo{constructor(e,t,n,s,r,i,o,a,l,c){super(e,t,n,s,r,i,o,l,c),this.spec=a}update(e,t,n,s){if(3==this.dirty)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let r=this.spec.update(e,t,n);return r&&this.updateInner(e,t,n,s),r}return!(!this.contentDOM&&!e.isLeaf)&&super.update(e,t,n,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,s){this.spec.setSelection?this.spec.setSelection(e,t,n.root):super.setSelection(e,t,n,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return!!this.spec.stopEvent&&this.spec.stopEvent(e)}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function Yo(e,t,n){let s=e.firstChild,r=!1;for(let i=0;i<t.length;i++){let o=t[i],a=o.dom;if(a.parentNode==e){for(;a!=s;)s=ia(s),r=!0;s=s.nextSibling}else r=!0,e.insertBefore(a,s);if(o instanceof qo){let t=s?s.previousSibling:e.lastChild;Yo(o.contentDOM,o.children,n),s=t?t.nextSibling:e.firstChild}}for(;s;)s=ia(s),r=!0;r&&n.trackWrites==e&&(n.trackWrites=null)}const Qo=function(e){e&&(this.nodeName=e)};Qo.prototype=Object.create(null);const Zo=[new Qo];function ea(e,t,n){if(0==e.length)return Zo;let s=n?Zo[0]:new Qo,r=[s];for(let i=0;i<e.length;i++){let o=e[i].type.attrs;if(o){o.nodeName&&r.push(s=new Qo(o.nodeName));for(let e in o){let i=o[e];null!=i&&(n&&1==r.length&&r.push(s=new Qo(t.isInline?"span":"div")),"class"==e?s.class=(s.class?s.class+" ":"")+i:"style"==e?s.style=(s.style?s.style+";":"")+i:"nodeName"!=e&&(s[e]=i))}}}return r}function ta(e,t,n,s){if(n==Zo&&s==Zo)return t;let r=t;for(let i=0;i<s.length;i++){let t=s[i],o=n[i];if(i){let n;o&&o.nodeName==t.nodeName&&r!=e&&(n=r.parentNode)&&n.nodeName.toLowerCase()==t.nodeName||(n=document.createElement(t.nodeName),n.pmIsDeco=!0,n.appendChild(r),o=Zo[0]),r=n}na(r,o||Zo[0],t)}return r}function na(e,t,n){for(let s in t)"class"==s||"style"==s||"nodeName"==s||s in n||e.removeAttribute(s);for(let s in n)"class"!=s&&"style"!=s&&"nodeName"!=s&&n[s]!=t[s]&&e.setAttribute(s,n[s]);if(t.class!=n.class){let s=t.class?t.class.split(" ").filter(Boolean):[],r=n.class?n.class.split(" ").filter(Boolean):[];for(let t=0;t<s.length;t++)-1==r.indexOf(s[t])&&e.classList.remove(s[t]);for(let t=0;t<r.length;t++)-1==s.indexOf(r[t])&&e.classList.add(r[t]);0==e.classList.length&&e.removeAttribute("class")}if(t.style!=n.style){if(t.style){let n,s=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;n=s.exec(t.style);)e.style.removeProperty(n[1])}n.style&&(e.style.cssText+=n.style)}}function sa(e,t,n){return ta(e,e,Zo,ea(t,n,1!=e.nodeType))}function ra(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].type.eq(t[n].type))return!1;return!0}function ia(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}class oa{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=function(e,t){let n=t,s=n.children.length,r=e.childCount,i=new Map,o=[];e:for(;r>0;){let a;for(;;)if(s){let e=n.children[s-1];if(!(e instanceof qo)){a=e,s--;break}n=e,s=e.children.length}else{if(n==t)break e;s=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=e.child(r-1))break;--r,i.set(a,r),o.push(a)}}return{index:r,matched:i,matches:o.reverse()}}(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let s=0,r=this.stack.length>>1,i=Math.min(r,e.length);for(;s<i&&(s==r-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&!1!==e[s].type.spec.spanning;)s++;for(;s<r;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),r--;for(;r<e.length;){this.stack.push(this.top,this.index+1);let s=-1;for(let t=this.index;t<Math.min(this.index+3,this.top.children.length);t++){let n=this.top.children[t];if(n.matchesMark(e[r])&&!this.isLocked(n.dom)){s=t;break}}if(s>-1)s>this.index&&(this.changed=!0,this.destroyBetween(this.index,s)),this.top=this.top.children[this.index];else{let s=qo.create(this.top,e[r],t,n);this.top.children.splice(this.index,0,s),this.top=s,this.changed=!0}this.index=0,r++}}findNodeMatch(e,t,n,s){let r,i=-1;if(s>=this.preMatch.index&&(r=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&r.matchesNode(e,t,n))i=this.top.children.indexOf(r,this.index);else for(let o=this.index,a=Math.min(this.top.children.length,o+5);o<a;o++){let s=this.top.children[o];if(s.matchesNode(e,t,n)&&!this.preMatch.matched.has(s)){i=o;break}}return!(i<0)&&(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,n,s,r){let i=this.top.children[s];return 3==i.dirty&&i.dom==i.contentDOM&&(i.dirty=2),!!i.update(e,t,n,r)&&(this.destroyBetween(this.index,s),this.index++,!0)}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let t=e.pmViewDesc;if(t)for(let e=this.index;e<this.top.children.length;e++)if(this.top.children[e]==t)return e;return-1}e=t}}updateNextNode(e,t,n,s,r,i){for(let o=this.index;o<this.top.children.length;o++){let a=this.top.children[o];if(a instanceof Wo){let l=this.preMatch.matched.get(a);if(null!=l&&l!=r)return!1;let c,d=a.dom,h=this.isLocked(d)&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&3!=a.dirty&&ra(t,a.outerDeco));if(!h&&a.update(e,t,n,s))return this.destroyBetween(this.index,o),a.dom!=d&&(this.changed=!0),this.index++,!0;if(!h&&(c=this.recreateWrapper(a,e,t,n,s,i)))return this.destroyBetween(this.index,o),this.top.children[this.index]=c,c.contentDOM&&(c.dirty=2,c.updateChildren(s,i+1),c.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,n,s,r,i){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!ra(n,e.outerDeco)||!s.eq(e.innerDeco))return null;let o=Wo.create(this.top,t,n,s,r,i);if(o.contentDOM){o.children=e.children,e.children=[];for(let e of o.children)e.parent=o}return e.destroy(),o}addNode(e,t,n,s,r){let i=Wo.create(this.top,e,t,n,s,r);i.contentDOM&&i.updateChildren(s,r+1),this.top.children.splice(this.index++,0,i),this.changed=!0}placeWidget(e,t,n){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(!s||!s.matchesWidget(e)||e!=s.widget&&s.widget.type.toDOM.parentNode){let s=new Vo(this.top,e,t,n);this.top.children.splice(this.index++,0,s),this.changed=!0}else this.index++}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof qo;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Ko)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((uo||co)&&e&&"false"==e.dom.contentEditable&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);"IMG"==e&&(n.className="ProseMirror-separator",n.alt=""),"BR"==e&&(n.className="ProseMirror-trailingBreak");let s=new Go(this.top,[],n,null);t!=this.top?t.children.push(s):t.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||1==e.nodeType&&e.contains(this.lock.parentNode))}}function aa(e,t){return e.type.side-t.type.side}function la(e,t,n,s,r){let i=[];for(let o=0,a=0;o<e.length;o++){let l=e[o],c=a,d=a+=l.size;c>=n||d<=t?i.push(l):(c<t&&i.push(l.slice(0,t-c,s)),r&&(i.push(r),r=void 0),d>n&&i.push(l.slice(n-c,l.size,s)))}return i}function ca(e,t=null){let n=e.domSelectionRange(),s=e.state.doc;if(!n.focusNode)return null;let r=e.docView.nearestDesc(n.focusNode),i=r&&0==r.size,o=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a,l,c=s.resolve(o);if(Yi(n)){for(a=o;r&&!r.node;)r=r.parent;let e=r.node;if(r&&e.isAtom&&Ti.isSelectable(e)&&r.parent&&(!e.isInline||!function(e,t,n){for(let s=0==t,r=t==Gi(e);s||r;){if(e==n)return!0;let t=Hi(e);if(!(e=e.parentNode))return!1;s=s&&0==t,r=r&&t==Gi(e)}}(n.focusNode,n.focusOffset,r.dom))){let e=r.posBefore;l=new Ti(o==e?c:s.resolve(e))}}else{if(n instanceof e.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let t=o,r=o;for(let s=0;s<n.rangeCount;s++){let i=n.getRangeAt(s);t=Math.min(t,e.docView.posFromDOM(i.startContainer,i.startOffset,1)),r=Math.max(r,e.docView.posFromDOM(i.endContainer,i.endOffset,-1))}if(t<0)return null;[a,o]=r==e.state.selection.anchor?[r,t]:[t,r],c=s.resolve(o)}else a=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(a<0)return null}let d=s.resolve(a);if(!l){l=va(e,d,c,"pointer"==t||e.state.selection.head<c.pos&&!i?1:-1)}return l}function da(e){return e.editable?e.hasFocus():wa(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function ha(e,t=!1){let n=e.state.selection;if(ga(e,n),da(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&co){let t=e.domSelectionRange(),n=e.domObserver.currentSelection;if(t.anchorNode&&n.anchorNode&&Wi(t.anchorNode,t.anchorOffset,n.anchorNode,n.anchorOffset))return e.input.mouseDown.delayedSelectionSync=!0,void e.domObserver.setCurSelection()}if(e.domObserver.disconnectSelection(),e.cursorWrapper)!function(e){let t=e.domSelection(),n=document.createRange();if(!t)return;let s=e.cursorWrapper.dom,r="IMG"==s.nodeName;r?n.setStart(s.parentNode,Hi(s)+1):n.setStart(s,0);n.collapse(!0),t.removeAllRanges(),t.addRange(n),!r&&!e.state.selection.visible&&io&&oo<=11&&(s.disabled=!0,s.disabled=!1)}(e);else{let s,r,{anchor:i,head:o}=n;!ua||n instanceof Si||(n.$from.parent.inlineContent||(s=pa(e,n.from)),n.empty||n.$from.parent.inlineContent||(r=pa(e,n.to))),e.docView.setSelection(i,o,e,t),ua&&(s&&ma(s),r&&ma(r)),n.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(e){let t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.input.hideSelectionGuard);let n=e.domSelectionRange(),s=n.anchorNode,r=n.anchorOffset;t.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{n.anchorNode==s&&n.anchorOffset==r||(t.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout((()=>{da(e)&&!e.state.selection.visible||e.dom.classList.remove("ProseMirror-hideselection")}),20))})}(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}const ua=uo||co&&ho<63;function pa(e,t){let{node:n,offset:s}=e.docView.domFromPos(t,0),r=s<n.childNodes.length?n.childNodes[s]:null,i=s?n.childNodes[s-1]:null;if(uo&&r&&"false"==r.contentEditable)return fa(r);if(!(r&&"false"!=r.contentEditable||i&&"false"!=i.contentEditable)){if(r)return fa(r);if(i)return fa(i)}}function fa(e){return e.contentEditable="true",uo&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function ma(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function ga(e,t){if(t instanceof Ti){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(ya(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else ya(e)}function ya(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function va(e,t,n,s){return e.someProp("createSelectionBetween",(s=>s(e,t,n)))||Si.between(t,n,s)}function ba(e){return!(e.editable&&!e.hasFocus())&&wa(e)}function wa(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(3==t.anchorNode.nodeType?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(3==t.focusNode.nodeType?t.focusNode.parentNode:t.focusNode))}catch(n){return!1}}function xa(e,t){let{$anchor:n,$head:s}=e.selection,r=t>0?n.max(s):n.min(s),i=r.parent.inlineContent?r.depth?e.doc.resolve(t>0?r.after():r.before()):null:r;return i&&bi.findFrom(i,t)}function ka(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function Sa(e,t,n){let s=e.state.selection;if(!(s instanceof Si)){if(s instanceof Ti&&s.node.isInline)return ka(e,new Si(t>0?s.$to:s.$from));{let n=xa(e.state,t);return!!n&&ka(e,n)}}if(n.indexOf("s")>-1){let{$head:n}=s,r=n.textOffset?null:t<0?n.nodeBefore:n.nodeAfter;if(!r||r.isText||!r.isLeaf)return!1;let i=e.state.doc.resolve(n.pos+r.nodeSize*(t<0?-1:1));return ka(e,new Si(s.$anchor,i))}if(!s.empty)return!1;if(e.endOfTextblock(t>0?"forward":"backward")){let n=xa(e.state,t);return!!(n&&n instanceof Ti)&&ka(e,n)}if(!(fo&&n.indexOf("m")>-1)){let n,r=s.$head,i=r.textOffset?null:t<0?r.nodeBefore:r.nodeAfter;if(!i||i.isText)return!1;let o=t<0?r.pos-i.nodeSize:r.pos;return!!(i.isAtom||(n=e.docView.descAt(o))&&!n.contentDOM)&&(Ti.isSelectable(i)?ka(e,new Ti(t<0?e.state.doc.resolve(r.pos-i.nodeSize):r)):!!yo&&ka(e,new Si(e.state.doc.resolve(t<0?o:o+i.nodeSize))))}}function Ca(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function Ta(e,t){let n=e.pmViewDesc;return n&&0==n.size&&(t<0||e.nextSibling||"BR"!=e.nodeName)}function Oa(e,t){return t<0?function(e){let t=e.domSelectionRange(),n=t.focusNode,s=t.focusOffset;if(!n)return;let r,i,o=!1;ao&&1==n.nodeType&&s<Ca(n)&&Ta(n.childNodes[s],-1)&&(o=!0);for(;;)if(s>0){if(1!=n.nodeType)break;{let e=n.childNodes[s-1];if(Ta(e,-1))r=n,i=--s;else{if(3!=e.nodeType)break;n=e,s=n.nodeValue.length}}}else{if(Ea(n))break;{let t=n.previousSibling;for(;t&&Ta(t,-1);)r=n.parentNode,i=Hi(t),t=t.previousSibling;if(t)n=t,s=Ca(n);else{if(n=n.parentNode,n==e.dom)break;s=0}}}o?Na(e,n,s):r&&Na(e,r,i)}(e):function(e){let t=e.domSelectionRange(),n=t.focusNode,s=t.focusOffset;if(!n)return;let r,i,o=Ca(n);for(;;)if(s<o){if(1!=n.nodeType)break;if(!Ta(n.childNodes[s],1))break;r=n,i=++s}else{if(Ea(n))break;{let t=n.nextSibling;for(;t&&Ta(t,1);)r=t.parentNode,i=Hi(t)+1,t=t.nextSibling;if(t)n=t,s=0,o=Ca(n);else{if(n=n.parentNode,n==e.dom)break;s=o=0}}}r&&Na(e,r,i)}(e)}function Ea(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function Na(e,t,n){if(3!=t.nodeType){let e,s;(s=function(e,t){for(;e&&t==e.childNodes.length&&!Xi(e);)t=Hi(e)+1,e=e.parentNode;for(;e&&t<e.childNodes.length;){let n=e.childNodes[t];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;e=n,t=0}}(t,n))?(t=s,n=0):(e=function(e,t){for(;e&&!t&&!Xi(e);)t=Hi(e),e=e.parentNode;for(;e&&t;){let n=e.childNodes[t-1];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;t=(e=n).childNodes.length}}(t,n))&&(t=e,n=e.nodeValue.length)}let s=e.domSelection();if(!s)return;if(Yi(s)){let e=document.createRange();e.setEnd(t,n),e.setStart(t,n),s.removeAllRanges(),s.addRange(e)}else s.extend&&s.extend(t,n);e.domObserver.setCurSelection();let{state:r}=e;setTimeout((()=>{e.state==r&&ha(e)}),50)}function Ma(e,t){let n=e.state.doc.resolve(t);if(!co&&!mo&&n.parent.inlineContent){let s=e.coordsAtPos(t);if(t>n.start()){let n=e.coordsAtPos(t-1),r=(n.top+n.bottom)/2;if(r>s.top&&r<s.bottom&&Math.abs(n.left-s.left)>1)return n.left<s.left?"ltr":"rtl"}if(t<n.end()){let n=e.coordsAtPos(t+1),r=(n.top+n.bottom)/2;if(r>s.top&&r<s.bottom&&Math.abs(n.left-s.left)>1)return n.left>s.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(e.dom).direction?"rtl":"ltr"}function ja(e,t,n){let s=e.state.selection;if(s instanceof Si&&!s.empty||n.indexOf("s")>-1)return!1;if(fo&&n.indexOf("m")>-1)return!1;let{$from:r,$to:i}=s;if(!r.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){let n=xa(e.state,t);if(n&&n instanceof Ti)return ka(e,n)}if(!r.parent.inlineContent){let n=t<0?r:i,o=s instanceof Ei?bi.near(n,t):bi.findFrom(n,t);return!!o&&ka(e,o)}return!1}function _a(e,t){if(!(e.state.selection instanceof Si))return!0;let{$head:n,$anchor:s,empty:r}=e.state.selection;if(!n.sameParent(s))return!0;if(!r)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;let i=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let s=e.state.tr;return t<0?s.delete(n.pos-i.nodeSize,n.pos):s.delete(n.pos,n.pos+i.nodeSize),e.dispatch(s),!0}return!1}function Aa(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function Da(e,t){let n=t.keyCode,s=function(e){let t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}(t);if(8==n||fo&&72==n&&"c"==s)return _a(e,-1)||Oa(e,-1);if(46==n&&!t.shiftKey||fo&&68==n&&"c"==s)return _a(e,1)||Oa(e,1);if(13==n||27==n)return!0;if(37==n||fo&&66==n&&"c"==s){let t=37==n?"ltr"==Ma(e,e.state.selection.from)?-1:1:-1;return Sa(e,t,s)||Oa(e,t)}if(39==n||fo&&70==n&&"c"==s){let t=39==n?"ltr"==Ma(e,e.state.selection.from)?1:-1:1;return Sa(e,t,s)||Oa(e,t)}return 38==n||fo&&80==n&&"c"==s?ja(e,-1,s)||Oa(e,-1):40==n||fo&&78==n&&"c"==s?function(e){if(!uo||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&1==t.nodeType&&0==n&&t.firstChild&&"false"==t.firstChild.contentEditable){let n=t.firstChild;Aa(e,n,"true"),setTimeout((()=>Aa(e,n,"false")),20)}return!1}(e)||ja(e,1,s)||Oa(e,1):s==(fo?"m":"c")&&(66==n||73==n||89==n||90==n)}function Ra(e,t){e.someProp("transformCopied",(n=>{t=n(t,e)}));let n=[],{content:s,openStart:r,openEnd:i}=t;for(;r>1&&i>1&&1==s.childCount&&1==s.firstChild.childCount;){r--,i--;let e=s.firstChild;n.push(e.type.name,e.attrs!=e.type.defaultAttrs?e.attrs:null),s=e.content}let o=e.someProp("clipboardSerializer")||Cr.fromSchema(e.state.schema),a=Ua(),l=a.createElement("div");l.appendChild(o.serializeFragment(s,{document:a}));let c,d=l.firstChild,h=0;for(;d&&1==d.nodeType&&(c=Ha[d.nodeName.toLowerCase()]);){for(let e=c.length-1;e>=0;e--){let t=a.createElement(c[e]);for(;l.firstChild;)t.appendChild(l.firstChild);l.appendChild(t),h++}d=l.firstChild}return d&&1==d.nodeType&&d.setAttribute("data-pm-slice",`${r} ${i}${h?` -${h}`:""} ${JSON.stringify(n)}`),{dom:l,text:e.someProp("clipboardTextSerializer",(n=>n(t,e)))||t.content.textBetween(0,t.content.size,"\n\n"),slice:t}}function Pa(e,t,n,s,r){let i,o,a=r.parent.type.spec.code;if(!n&&!t)return null;let l=t&&(s||a||!n);if(l){if(e.someProp("transformPastedText",(n=>{t=n(t,a||s,e)})),a)return t?new Ms(Ss.from(e.state.schema.text(t.replace(/\r\n?/g,"\n"))),0,0):Ms.empty;let n=e.someProp("clipboardTextParser",(n=>n(t,r,s,e)));if(n)o=n;else{let n=r.marks(),{schema:s}=e.state,o=Cr.fromSchema(s);i=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach((e=>{let t=i.appendChild(document.createElement("p"));e&&t.appendChild(o.serializeNode(s.text(e,n)))}))}}else e.someProp("transformPastedHTML",(t=>{n=t(n,e)})),i=function(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n,s=Ua().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(e);(n=r&&Ha[r[1].toLowerCase()])&&(e=n.map((e=>"<"+e+">")).join("")+e+n.map((e=>"</"+e+">")).reverse().join(""));if(s.innerHTML=function(e){let t=window.trustedTypes;if(!t)return e;qa||(qa=t.createPolicy("ProseMirrorClipboard",{createHTML:e=>e}));return qa.createHTML(e)}(e),n)for(let i=0;i<n.length;i++)s=s.querySelector(n[i])||s;return s}(n),yo&&function(e){let t=e.querySelectorAll(co?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<t.length;n++){let s=t[n];1==s.childNodes.length&&""==s.textContent&&s.parentNode&&s.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),s)}}(i);let c=i&&i.querySelector("[data-pm-slice]"),d=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let h=+d[3];h>0;h--){let e=i.firstChild;for(;e&&1!=e.nodeType;)e=e.nextSibling;if(!e)break;i=e}if(!o){let t=e.someProp("clipboardParser")||e.someProp("domParser")||fr.fromSchema(e.state.schema);o=t.parseSlice(i,{preserveWhitespace:!(!l&&!d),context:r,ruleFromNode:e=>"BR"!=e.nodeName||e.nextSibling||!e.parentNode||Ia.test(e.parentNode.nodeName)?null:{ignore:!0}})}if(d)o=function(e,t){if(!e.size)return e;let n,s=e.content.firstChild.type.schema;try{n=JSON.parse(t)}catch(tm){return e}let{content:r,openStart:i,openEnd:o}=e;for(let a=n.length-2;a>=0;a-=2){let e=s.nodes[n[a]];if(!e||e.hasRequiredAttrs())break;r=Ss.from(e.create(n[a+1],r)),i++,o++}return new Ms(r,i,o)}(Fa(o,+d[1],+d[2]),d[4]);else if(o=Ms.maxOpen(function(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let s,r=t.node(n).contentMatchAt(t.index(n)),i=[];if(e.forEach((e=>{if(!i)return;let t,n=r.findWrapping(e.type);if(!n)return i=null;if(t=i.length&&s.length&&La(n,s,e,i[i.length-1],0))i[i.length-1]=t;else{i.length&&(i[i.length-1]=Ba(i[i.length-1],s.length));let t=$a(e,n);i.push(t),r=r.matchType(t.type),s=n}})),i)return Ss.from(i)}return e}(o.content,r),!0),o.openStart||o.openEnd){let e=0,t=0;for(let n=o.content.firstChild;e<o.openStart&&!n.type.spec.isolating;e++,n=n.firstChild);for(let n=o.content.lastChild;t<o.openEnd&&!n.type.spec.isolating;t++,n=n.lastChild);o=Fa(o,e,t)}return e.someProp("transformPasted",(t=>{o=t(o,e)})),o}const Ia=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function $a(e,t,n=0){for(let s=t.length-1;s>=n;s--)e=t[s].create(null,Ss.from(e));return e}function La(e,t,n,s,r){if(r<e.length&&r<t.length&&e[r]==t[r]){let i=La(e,t,n,s.lastChild,r+1);if(i)return s.copy(s.content.replaceChild(s.childCount-1,i));if(s.contentMatchAt(s.childCount).matchType(r==e.length-1?n.type:e[r+1]))return s.copy(s.content.append(Ss.from($a(n,e,r+1))))}}function Ba(e,t){if(0==t)return e;let n=e.content.replaceChild(e.childCount-1,Ba(e.lastChild,t-1)),s=e.contentMatchAt(e.childCount).fillBefore(Ss.empty,!0);return e.copy(n.append(s))}function za(e,t,n,s,r,i){let o=t<0?e.firstChild:e.lastChild,a=o.content;return e.childCount>1&&(i=0),r<s-1&&(a=za(a,t,n,s,r+1,i)),r>=n&&(a=t<0?o.contentMatchAt(0).fillBefore(a,i<=r).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(Ss.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,o.copy(a))}function Fa(e,t,n){return t<e.openStart&&(e=new Ms(za(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new Ms(za(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}const Ha={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Va=null;function Ua(){return Va||(Va=document.implementation.createHTMLDocument("title"))}let qa=null;const Wa={},Ja={},Ka={touchstart:!0,touchmove:!0};class Ga{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function Xa(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function Ya(e){e.someProp("handleDOMEvents",(t=>{for(let n in t)e.input.eventHandlers[n]||e.dom.addEventListener(n,e.input.eventHandlers[n]=t=>Qa(e,t))}))}function Qa(e,t){return e.someProp("handleDOMEvents",(n=>{let s=n[t.type];return!!s&&(s(e,t)||t.defaultPrevented)}))}function Za(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n=t.target;n!=e.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(t))return!1;return!0}function el(e){return{left:e.clientX,top:e.clientY}}function tl(e,t,n,s,r){if(-1==s)return!1;let i=e.state.doc.resolve(s);for(let o=i.depth+1;o>0;o--)if(e.someProp(t,(t=>o>i.depth?t(e,n,i.nodeAfter,i.before(o),r,!0):t(e,n,i.node(o),i.before(o),r,!1))))return!0;return!1}function nl(e,t,n){if(e.focused||e.focus(),e.state.selection.eq(t))return;let s=e.state.tr.setSelection(t);s.setMeta("pointer",!0),e.dispatch(s)}function sl(e,t,n,s,r){return tl(e,"handleClickOn",t,n,s)||e.someProp("handleClick",(n=>n(e,t,s)))||(r?function(e,t){if(-1==t)return!1;let n,s,r=e.state.selection;r instanceof Ti&&(n=r.node);let i=e.state.doc.resolve(t);for(let o=i.depth+1;o>0;o--){let e=o>i.depth?i.nodeAfter:i.node(o);if(Ti.isSelectable(e)){s=n&&r.$from.depth>0&&o>=r.$from.depth&&i.before(r.$from.depth+1)==r.$from.pos?i.before(r.$from.depth):i.before(o);break}}return null!=s&&(nl(e,Ti.create(e.state.doc,s)),!0)}(e,n):function(e,t){if(-1==t)return!1;let n=e.state.doc.resolve(t),s=n.nodeAfter;return!!(s&&s.isAtom&&Ti.isSelectable(s))&&(nl(e,new Ti(n)),!0)}(e,n))}function rl(e,t,n,s){return tl(e,"handleDoubleClickOn",t,n,s)||e.someProp("handleDoubleClick",(n=>n(e,t,s)))}function il(e,t,n,s){return tl(e,"handleTripleClickOn",t,n,s)||e.someProp("handleTripleClick",(n=>n(e,t,s)))||function(e,t,n){if(0!=n.button)return!1;let s=e.state.doc;if(-1==t)return!!s.inlineContent&&(nl(e,Si.create(s,0,s.content.size)),!0);let r=s.resolve(t);for(let i=r.depth+1;i>0;i--){let t=i>r.depth?r.nodeAfter:r.node(i),n=r.before(i);if(t.inlineContent)nl(e,Si.create(s,n+1,n+1+t.content.size));else{if(!Ti.isSelectable(t))continue;nl(e,Ti.create(s,n))}return!0}}(e,n,s)}function ol(e){return fl(e)}Ja.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=16==n.keyCode||n.shiftKey,!cl(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!go||!co||13!=n.keyCode))if(229!=n.keyCode&&e.domObserver.forceFlush(),!po||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)e.someProp("handleKeyDown",(t=>t(e,n)))||Da(e,n)?n.preventDefault():Xa(e,"key");else{let t=Date.now();e.input.lastIOSEnter=t,e.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{e.input.lastIOSEnter==t&&(e.someProp("handleKeyDown",(t=>t(e,Qi(13,"Enter")))),e.input.lastIOSEnter=0)}),200)}},Ja.keyup=(e,t)=>{16==t.keyCode&&(e.input.shiftKey=!1)},Ja.keypress=(e,t)=>{let n=t;if(cl(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||fo&&n.metaKey)return;if(e.someProp("handleKeyPress",(t=>t(e,n))))return void n.preventDefault();let s=e.state.selection;if(!(s instanceof Si&&s.$from.sameParent(s.$to))){let t=String.fromCharCode(n.charCode);/[\r\n]/.test(t)||e.someProp("handleTextInput",(n=>n(e,s.$from.pos,s.$to.pos,t)))||e.dispatch(e.state.tr.insertText(t).scrollIntoView()),n.preventDefault()}};const al=fo?"metaKey":"ctrlKey";Wa.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let s=ol(e),r=Date.now(),i="singleClick";r-e.input.lastClick.time<500&&function(e,t){let n=t.x-e.clientX,s=t.y-e.clientY;return n*n+s*s<100}(n,e.input.lastClick)&&!n[al]&&("singleClick"==e.input.lastClick.type?i="doubleClick":"doubleClick"==e.input.lastClick.type&&(i="tripleClick")),e.input.lastClick={time:r,x:n.clientX,y:n.clientY,type:i};let o=e.posAtCoords(el(n));o&&("singleClick"==i?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new ll(e,o,n,!!s)):("doubleClick"==i?rl:il)(e,o.pos,o.inside,n)?n.preventDefault():Xa(e,"pointer"))};class ll{constructor(e,t,n,s){let r,i;if(this.view=e,this.pos=t,this.event=n,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[al],this.allowDefault=n.shiftKey,t.inside>-1)r=e.state.doc.nodeAt(t.inside),i=t.inside;else{let n=e.state.doc.resolve(t.pos);r=n.parent,i=n.depth?n.before():0}const o=s?null:n.target,a=o?e.docView.nearestDesc(o,!0):null;this.target=a&&1==a.dom.nodeType?a.dom:null;let{selection:l}=e.state;(0==n.button&&r.type.spec.draggable&&!1!==r.type.spec.selectable||l instanceof Ti&&l.from<=i&&l.to>i)&&(this.mightDrag={node:r,pos:i,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!ao||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Xa(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>ha(this.view))),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(el(e))),this.updateAllowDefault(e),this.allowDefault||!t?Xa(this.view,"pointer"):sl(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||uo&&this.mightDrag&&!this.mightDrag.node.isAtom||co&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(nl(this.view,bi.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):Xa(this.view,"pointer")}move(e){this.updateAllowDefault(e),Xa(this.view,"pointer"),0==e.buttons&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}function cl(e,t){return!!e.composing||!!(uo&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500)&&(e.input.compositionEndedAt=-2e8,!0)}Wa.touchstart=e=>{e.input.lastTouch=Date.now(),ol(e),Xa(e,"pointer")},Wa.touchmove=e=>{e.input.lastTouch=Date.now(),Xa(e,"pointer")},Wa.contextmenu=e=>ol(e);const dl=go?5e3:-1;function hl(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout((()=>fl(e)),t))}function ul(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=function(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function pl(e){let t=e.domSelectionRange();if(!t.focusNode)return null;let n=function(e,t){for(;;){if(3==e.nodeType&&t)return e;if(1==e.nodeType&&t>0){if("false"==e.contentEditable)return null;t=Gi(e=e.childNodes[t-1])}else{if(!e.parentNode||Xi(e))return null;t=Hi(e),e=e.parentNode}}}(t.focusNode,t.focusOffset),s=function(e,t){for(;;){if(3==e.nodeType&&t<e.nodeValue.length)return e;if(1==e.nodeType&&t<e.childNodes.length){if("false"==e.contentEditable)return null;e=e.childNodes[t],t=0}else{if(!e.parentNode||Xi(e))return null;t=Hi(e)+1,e=e.parentNode}}}(t.focusNode,t.focusOffset);if(n&&s&&n!=s){let t=s.pmViewDesc,r=e.domObserver.lastChangedTextNode;if(n==r||s==r)return r;if(!t||!t.isText(s.nodeValue))return s;if(e.input.compositionNode==s){let e=n.pmViewDesc;if(e&&e.isText(n.nodeValue))return s}}return n||s}function fl(e,t=!1){if(!(go&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),ul(e),t||e.docView&&e.docView.dirty){let n=ca(e);return n&&!n.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(n)):!e.markCursor&&!t||e.state.selection.empty?e.updateState(e.state):e.dispatch(e.state.tr.deleteSelection()),!0}return!1}}Ja.compositionstart=Ja.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$to;if(t.selection instanceof Si&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((e=>!1===e.type.spec.inclusive))))e.markCursor=e.state.storedMarks||n.marks(),fl(e,!0),e.markCursor=null;else if(fl(e,!t.selection.empty),ao&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let t=e.domSelectionRange();for(let n=t.focusNode,s=t.focusOffset;n&&1==n.nodeType&&0!=s;){let t=s<0?n.lastChild:n.childNodes[s-1];if(!t)break;if(3==t.nodeType){let n=e.domSelection();n&&n.collapse(t,t.nodeValue.length);break}n=t,s=-1}}e.input.composing=!0}hl(e,dl)},Ja.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,e.input.compositionPendingChanges=e.domObserver.pendingRecords().length?e.input.compositionID:0,e.input.compositionNode=null,e.input.compositionPendingChanges&&Promise.resolve().then((()=>e.domObserver.flush())),e.input.compositionID++,hl(e,20))};const ml=io&&oo<15||po&&vo<604;function gl(e,t,n,s,r){let i=Pa(e,t,n,s,e.state.selection.$from);if(e.someProp("handlePaste",(t=>t(e,r,i||Ms.empty))))return!0;if(!i)return!1;let o=function(e){return 0==e.openStart&&0==e.openEnd&&1==e.content.childCount?e.content.firstChild:null}(i),a=o?e.state.tr.replaceSelectionWith(o,s):e.state.tr.replaceSelection(i);return e.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function yl(e){let t=e.getData("text/plain")||e.getData("Text");if(t)return t;let n=e.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Wa.copy=Ja.cut=(e,t)=>{let n=t,s=e.state.selection,r="cut"==n.type;if(s.empty)return;let i=ml?null:n.clipboardData,o=s.content(),{dom:a,text:l}=Ra(e,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):function(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";let s=getSelection(),r=document.createRange();r.selectNodeContents(t),e.dom.blur(),s.removeAllRanges(),s.addRange(r),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()}),50)}(e,a),r&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},Ja.paste=(e,t)=>{let n=t;if(e.composing&&!go)return;let s=ml?null:n.clipboardData,r=e.input.shiftKey&&45!=e.input.lastKeyCode;s&&gl(e,yl(s),s.getData("text/html"),r,n)?n.preventDefault():function(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,s=e.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(s.contentEditable="true"),s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus();let r=e.input.shiftKey&&45!=e.input.lastKeyCode;setTimeout((()=>{e.focus(),s.parentNode&&s.parentNode.removeChild(s),n?gl(e,s.value,null,r,t):gl(e,s.textContent,s.innerHTML,r,t)}),50)}(e,n)};class vl{constructor(e,t,n){this.slice=e,this.move=t,this.node=n}}const bl=fo?"altKey":"ctrlKey";Wa.dragstart=(e,t)=>{let n=t,s=e.input.mouseDown;if(s&&s.done(),!n.dataTransfer)return;let r,i=e.state.selection,o=i.empty?null:e.posAtCoords(el(n));if(o&&o.pos>=i.from&&o.pos<=(i instanceof Ti?i.to-1:i.to));else if(s&&s.mightDrag)r=Ti.create(e.state.doc,s.mightDrag.pos);else if(n.target&&1==n.target.nodeType){let t=e.docView.nearestDesc(n.target,!0);t&&t.node.type.spec.draggable&&t!=e.docView&&(r=Ti.create(e.state.doc,t.posBefore))}let a=(r||e.state.selection).content(),{dom:l,text:c,slice:d}=Ra(e,a);(!n.dataTransfer.files.length||!co||ho>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(ml?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",ml||n.dataTransfer.setData("text/plain",c),e.dragging=new vl(d,!n[bl],r)},Wa.dragend=e=>{let t=e.dragging;window.setTimeout((()=>{e.dragging==t&&(e.dragging=null)}),50)},Ja.dragover=Ja.dragenter=(e,t)=>t.preventDefault(),Ja.drop=(e,t)=>{let n=t,s=e.dragging;if(e.dragging=null,!n.dataTransfer)return;let r=e.posAtCoords(el(n));if(!r)return;let i=e.state.doc.resolve(r.pos),o=s&&s.slice;o?e.someProp("transformPasted",(t=>{o=t(o,e)})):o=Pa(e,yl(n.dataTransfer),ml?null:n.dataTransfer.getData("text/html"),!1,i);let a=!(!s||n[bl]);if(e.someProp("handleDrop",(t=>t(e,n,o||Ms.empty,a))))return void n.preventDefault();if(!o)return;n.preventDefault();let l=o?si(e.state.doc,i.pos,o):i.pos;null==l&&(l=i.pos);let c=e.state.tr;if(a){let{node:e}=s;e?e.replace(c):c.deleteSelection()}let d=c.mapping.map(l),h=0==o.openStart&&0==o.openEnd&&1==o.content.childCount,u=c.doc;if(h?c.replaceRangeWith(d,d,o.content.firstChild):c.replaceRange(d,d,o),c.doc.eq(u))return;let p=c.doc.resolve(d);if(h&&Ti.isSelectable(o.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new Ti(p));else{let t=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach(((e,n,s,r)=>t=r)),c.setSelection(va(e,p,c.doc.resolve(t)))}e.focus(),e.dispatch(c.setMeta("uiEvent","drop"))},Wa.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout((()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&ha(e)}),20))},Wa.blur=(e,t)=>{let n=t;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)},Wa.beforeinput=(e,t)=>{if(co&&go&&"deleteContentBackward"==t.inputType){e.domObserver.flushSoon();let{domChangeCount:t}=e.input;setTimeout((()=>{if(e.input.domChangeCount!=t)return;if(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",(t=>t(e,Qi(8,"Backspace")))))return;let{$cursor:n}=e.state.selection;n&&n.pos>0&&e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())}),50)}};for(let os in Ja)Wa[os]=Ja[os];function wl(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}class xl{constructor(e,t){this.toDOM=e,this.spec=t||Ol,this.side=this.spec.side||0}map(e,t,n,s){let{pos:r,deleted:i}=e.mapResult(t.from+s,this.side<0?-1:1);return i?null:new Cl(r-n,r-n,this)}valid(){return!0}eq(e){return this==e||e instanceof xl&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&wl(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class kl{constructor(e,t){this.attrs=e,this.spec=t||Ol}map(e,t,n,s){let r=e.map(t.from+s,this.spec.inclusiveStart?-1:1)-n,i=e.map(t.to+s,this.spec.inclusiveEnd?1:-1)-n;return r>=i?null:new Cl(r,i,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof kl&&wl(this.attrs,e.attrs)&&wl(this.spec,e.spec)}static is(e){return e.type instanceof kl}destroy(){}}class Sl{constructor(e,t){this.attrs=e,this.spec=t||Ol}map(e,t,n,s){let r=e.mapResult(t.from+s,1);if(r.deleted)return null;let i=e.mapResult(t.to+s,-1);return i.deleted||i.pos<=r.pos?null:new Cl(r.pos-n,i.pos-n,this)}valid(e,t){let n,{index:s,offset:r}=e.content.findIndex(t.from);return r==t.from&&!(n=e.child(s)).isText&&r+n.nodeSize==t.to}eq(e){return this==e||e instanceof Sl&&wl(this.attrs,e.attrs)&&wl(this.spec,e.spec)}destroy(){}}class Cl{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new Cl(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new Cl(e,e,new xl(t,n))}static inline(e,t,n,s){return new Cl(e,t,new kl(n,s))}static node(e,t,n,s){return new Cl(e,t,new Sl(n,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof kl}get widget(){return this.type instanceof xl}}const Tl=[],Ol={};class El{constructor(e,t){this.local=e.length?e:Tl,this.children=t.length?t:Tl}static create(e,t){return t.length?Dl(t,e,0,Ol):Nl}find(e,t,n){let s=[];return this.findInner(null==e?0:e,null==t?1e9:t,s,0,n),s}findInner(e,t,n,s,r){for(let i=0;i<this.local.length;i++){let o=this.local[i];o.from<=t&&o.to>=e&&(!r||r(o.spec))&&n.push(o.copy(o.from+s,o.to+s))}for(let i=0;i<this.children.length;i+=3)if(this.children[i]<t&&this.children[i+1]>e){let o=this.children[i]+1;this.children[i+2].findInner(e-o,t-o,n,s+o,r)}}map(e,t,n){return this==Nl||0==e.maps.length?this:this.mapInner(e,t,0,0,n||Ol)}mapInner(e,t,n,s,r){let i;for(let o=0;o<this.local.length;o++){let a=this.local[o].map(e,n,s);a&&a.type.valid(t,a)?(i||(i=[])).push(a):r.onRemove&&r.onRemove(this.local[o].spec)}return this.children.length?function(e,t,n,s,r,i,o){let a=e.slice();for(let c=0,d=i;c<n.maps.length;c++){let e=0;n.maps[c].forEach(((t,n,s,r)=>{let i=r-s-(n-t);for(let o=0;o<a.length;o+=3){let s=a[o+1];if(s<0||t>s+d-e)continue;let r=a[o]+d-e;n>=r?a[o+1]=t<=r?-2:-1:t>=d&&i&&(a[o]+=i,a[o+1]+=i)}e+=i})),d=n.maps[c].map(d,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(-2==a[c+1]){l=!0,a[c+1]=-1;continue}let t=n.map(e[c]+i),d=t-r;if(d<0||d>=s.content.size){l=!0;continue}let h=n.map(e[c+1]+i,-1)-r,{index:u,offset:p}=s.content.findIndex(d),f=s.maybeChild(u);if(f&&p==d&&p+f.nodeSize==h){let s=a[c+2].mapInner(n,f,t+1,e[c]+i+1,o);s!=Nl?(a[c]=d,a[c+1]=h,a[c+2]=s):(a[c+1]=-2,l=!0)}else l=!0}if(l){let l=function(e,t,n,s,r,i,o){function a(e,t){for(let i=0;i<e.local.length;i++){let a=e.local[i].map(s,r,t);a?n.push(a):o.onRemove&&o.onRemove(e.local[i].spec)}for(let n=0;n<e.children.length;n+=3)a(e.children[n+2],e.children[n]+t+1)}for(let l=0;l<e.length;l+=3)-1==e[l+1]&&a(e[l+2],t[l]+i+1);return n}(a,e,t,n,r,i,o),c=Dl(l,s,0,o);t=c.local;for(let e=0;e<a.length;e+=3)a[e+1]<0&&(a.splice(e,3),e-=3);for(let e=0,t=0;e<c.children.length;e+=3){let n=c.children[e];for(;t<a.length&&a[t]<n;)t+=3;a.splice(t,0,c.children[e],c.children[e+1],c.children[e+2])}}return new El(t.sort(Rl),a)}(this.children,i||[],e,t,n,s,r):i?new El(i.sort(Rl),Tl):Nl}add(e,t){return t.length?this==Nl?El.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let s,r=0;e.forEach(((e,i)=>{let o,a=i+n;if(o=_l(t,e,a)){for(s||(s=this.children.slice());r<s.length&&s[r]<i;)r+=3;s[r]==i?s[r+2]=s[r+2].addInner(e,o,a+1):s.splice(r,0,i,i+e.nodeSize,Dl(o,e,a+1,Ol)),r+=3}}));let i=jl(r?Al(t):t,-n);for(let o=0;o<i.length;o++)i[o].type.valid(e,i[o])||i.splice(o--,1);return new El(i.length?this.local.concat(i).sort(Rl):this.local,s||this.children)}remove(e){return 0==e.length||this==Nl?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,s=this.local;for(let r=0;r<n.length;r+=3){let s,i=n[r]+t,o=n[r+1]+t;for(let t,n=0;n<e.length;n++)(t=e[n])&&t.from>i&&t.to<o&&(e[n]=null,(s||(s=[])).push(t));if(!s)continue;n==this.children&&(n=this.children.slice());let a=n[r+2].removeInner(s,i+1);a!=Nl?n[r+2]=a:(n.splice(r,3),r-=3)}if(s.length)for(let r,i=0;i<e.length;i++)if(r=e[i])for(let e=0;e<s.length;e++)s[e].eq(r,t)&&(s==this.local&&(s=this.local.slice()),s.splice(e--,1));return n==this.children&&s==this.local?this:s.length||n.length?new El(s,n):Nl}forChild(e,t){if(this==Nl)return this;if(t.isLeaf)return El.empty;let n,s;for(let o=0;o<this.children.length;o+=3)if(this.children[o]>=e){this.children[o]==e&&(n=this.children[o+2]);break}let r=e+1,i=r+t.content.size;for(let o=0;o<this.local.length;o++){let e=this.local[o];if(e.from<i&&e.to>r&&e.type instanceof kl){let t=Math.max(r,e.from)-r,n=Math.min(i,e.to)-r;t<n&&(s||(s=[])).push(e.copy(t,n))}}if(s){let e=new El(s.sort(Rl),Tl);return n?new Ml([e,n]):e}return n||Nl}eq(e){if(this==e)return!0;if(!(e instanceof El)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Pl(this.localsInner(e))}localsInner(e){if(this==Nl)return Tl;if(e.inlineContent||!this.local.some(kl.is))return this.local;let t=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof kl||t.push(this.local[n]);return t}forEachSet(e){e(this)}}El.empty=new El([],[]),El.removeOverlap=Pl;const Nl=El.empty;class Ml{constructor(e){this.members=e}map(e,t){const n=this.members.map((n=>n.map(e,t,Ol)));return Ml.from(n)}forChild(e,t){if(t.isLeaf)return El.empty;let n=[];for(let s=0;s<this.members.length;s++){let r=this.members[s].forChild(e,t);r!=Nl&&(r instanceof Ml?n=n.concat(r.members):n.push(r))}return Ml.from(n)}eq(e){if(!(e instanceof Ml)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let s=0;s<this.members.length;s++){let r=this.members[s].localsInner(e);if(r.length)if(t){n&&(t=t.slice(),n=!1);for(let e=0;e<r.length;e++)t.push(r[e])}else t=r}return t?Pl(n?t:t.sort(Rl)):Tl}static from(e){switch(e.length){case 0:return Nl;case 1:return e[0];default:return new Ml(e.every((e=>e instanceof El))?e:e.reduce(((e,t)=>e.concat(t instanceof El?t:t.members)),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function jl(e,t){if(!t||!e.length)return e;let n=[];for(let s=0;s<e.length;s++){let r=e[s];n.push(new Cl(r.from+t,r.to+t,r.type))}return n}function _l(e,t,n){if(t.isLeaf)return null;let s=n+t.nodeSize,r=null;for(let i,o=0;o<e.length;o++)(i=e[o])&&i.from>n&&i.to<s&&((r||(r=[])).push(i),e[o]=null);return r}function Al(e){let t=[];for(let n=0;n<e.length;n++)null!=e[n]&&t.push(e[n]);return t}function Dl(e,t,n,s){let r=[],i=!1;t.forEach(((t,o)=>{let a=_l(e,t,o+n);if(a){i=!0;let e=Dl(a,t,n+o+1,s);e!=Nl&&r.push(o,o+t.nodeSize,e)}}));let o=jl(i?Al(e):e,-n).sort(Rl);for(let a=0;a<o.length;a++)o[a].type.valid(t,o[a])||(s.onRemove&&s.onRemove(o[a].spec),o.splice(a--,1));return o.length||r.length?new El(o,r):Nl}function Rl(e,t){return e.from-t.from||e.to-t.to}function Pl(e){let t=e;for(let n=0;n<t.length-1;n++){let s=t[n];if(s.from!=s.to)for(let r=n+1;r<t.length;r++){let i=t[r];if(i.from!=s.from){i.from<s.to&&(t==e&&(t=e.slice()),t[n]=s.copy(s.from,i.from),Il(t,r,s.copy(i.from,s.to)));break}i.to!=s.to&&(t==e&&(t=e.slice()),t[r]=i.copy(i.from,s.to),Il(t,r+1,i.copy(s.to,i.to)))}}return t}function Il(e,t,n){for(;t<e.length&&Rl(n,e[t])>0;)t++;e.splice(t,0,n)}function $l(e){let t=[];return e.someProp("decorations",(n=>{let s=n(e.state);s&&s!=Nl&&t.push(s)})),e.cursorWrapper&&t.push(El.create(e.state.doc,[e.cursorWrapper.deco])),Ml.from(t)}const Ll={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Bl=io&&oo<=11;class zl{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class Fl{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new zl,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver((e=>{for(let t=0;t<e.length;t++)this.queue.push(e[t]);io&&oo<=11&&e.some((e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length))?this.flushSoon():this.flush()})),Bl&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((()=>{this.flushingSoon=-1,this.flush()}),20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Ll)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout((()=>this.flush()),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout((()=>this.suppressingSelectionUpdates=!1),50)}onSelectionChange(){if(ba(this.view)){if(this.suppressingSelectionUpdates)return ha(this.view);if(io&&oo<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Wi(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t,n=new Set;for(let r=e.focusNode;r;r=Vi(r))n.add(r);for(let r=e.anchorNode;r;r=Vi(r))if(n.has(r)){t=r;break}let s=t&&this.view.docView.nearestDesc(t);return s&&s.ignoreMutation({type:"selection",target:3==t.nodeType?t.parentNode:t})?(this.setCurSelection(),!0):void 0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let n=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&ba(e)&&!this.ignoreSelectionChange(n),r=-1,i=-1,o=!1,a=[];if(e.editable)for(let c=0;c<t.length;c++){let e=this.registerMutation(t[c],a);e&&(r=r<0?e.from:Math.min(e.from,r),i=i<0?e.to:Math.max(e.to,i),e.typeOver&&(o=!0))}if(ao&&a.length){let t=a.filter((e=>"BR"==e.nodeName));if(2==t.length){let[e,n]=t;e.parentNode&&e.parentNode.parentNode==n.parentNode?n.remove():e.remove()}else{let{focusNode:n}=this.currentSelection;for(let s of t){let t=s.parentNode;!t||"LI"!=t.nodeName||n&&ql(e,n)==t||s.remove()}}}let l=null;r<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Yi(n)&&(l=ca(e))&&l.eq(bi.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,ha(e),this.currentSelection.set(n),e.scrollToSelection()):(r>-1||s)&&(r>-1&&(e.docView.markDirty(r,i),function(e){if(Hl.has(e))return;if(Hl.set(e,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(e.dom).whiteSpace)){if(e.requiresGeckoHackNode=ao,Vl)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Vl=!0}}(e)),this.handleDOMChange(r,i,o,a),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||ha(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if("attributes"==e.type&&(n==this.view.docView||"contenteditable"==e.attributeName||"style"==e.attributeName&&!e.oldValue&&!e.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(e))return null;if("childList"==e.type){for(let n=0;n<e.addedNodes.length;n++){let s=e.addedNodes[n];t.push(s),3==s.nodeType&&(this.lastChangedTextNode=s)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let s=e.previousSibling,r=e.nextSibling;if(io&&oo<=11&&e.addedNodes.length)for(let t=0;t<e.addedNodes.length;t++){let{previousSibling:n,nextSibling:i}=e.addedNodes[t];(!n||Array.prototype.indexOf.call(e.addedNodes,n)<0)&&(s=n),(!i||Array.prototype.indexOf.call(e.addedNodes,i)<0)&&(r=i)}let i=s&&s.parentNode==e.target?Hi(s)+1:0,o=n.localPosFromDOM(e.target,i,-1),a=r&&r.parentNode==e.target?Hi(r):e.target.childNodes.length;return{from:o,to:n.localPosFromDOM(e.target,a,1)}}return"attributes"==e.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let Hl=new WeakMap,Vl=!1;function Ul(e,t){let n=t.startContainer,s=t.startOffset,r=t.endContainer,i=t.endOffset,o=e.domAtPos(e.state.selection.anchor);return Wi(o.node,o.offset,r,i)&&([n,s,r,i]=[r,i,n,s]),{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:i}}function ql(e,t){for(let n=t.parentNode;n&&n!=e.dom;n=n.parentNode){let t=e.docView.nearestDesc(n,!0);if(t&&t.node.isBlock)return n}return null}function Wl(e){let t=e.pmViewDesc;if(t)return t.parseRule();if("BR"==e.nodeName&&e.parentNode){if(uo&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}if(e.parentNode.lastChild==e||uo&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if("IMG"==e.nodeName&&e.getAttribute("mark-placeholder"))return{ignore:!0};return null}const Jl=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Kl(e,t,n,s,r){let i=e.input.compositionPendingChanges||(e.composing?e.input.compositionID:0);if(e.input.compositionPendingChanges=0,t<0){let t=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,n=ca(e,t);if(n&&!e.state.selection.eq(n)){if(co&&go&&13===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime&&e.someProp("handleKeyDown",(t=>t(e,Qi(13,"Enter")))))return;let s=e.state.tr.setSelection(n);"pointer"==t?s.setMeta("pointer",!0):"key"==t&&s.scrollIntoView(),i&&s.setMeta("composition",i),e.dispatch(s)}return}let o=e.state.doc.resolve(t),a=o.sharedDepth(n);t=o.before(a+1),n=e.state.doc.resolve(n).after(a+1);let l,c,d=e.state.selection,h=function(e,t,n){let s,{node:r,fromOffset:i,toOffset:o,from:a,to:l}=e.docView.parseRange(t,n),c=e.domSelectionRange(),d=c.anchorNode;if(d&&e.dom.contains(1==d.nodeType?d:d.parentNode)&&(s=[{node:d,offset:c.anchorOffset}],Yi(c)||s.push({node:c.focusNode,offset:c.focusOffset})),co&&8===e.input.lastKeyCode)for(let g=o;g>i;g--){let e=r.childNodes[g-1],t=e.pmViewDesc;if("BR"==e.nodeName&&!t){o=g;break}if(!t||t.size)break}let h=e.state.doc,u=e.someProp("domParser")||fr.fromSchema(e.state.schema),p=h.resolve(a),f=null,m=u.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:i,to:o,preserveWhitespace:"pre"!=p.parent.type.whitespace||"full",findPositions:s,ruleFromNode:Wl,context:p});if(s&&null!=s[0].pos){let e=s[0].pos,t=s[1]&&s[1].pos;null==t&&(t=e),f={anchor:e+a,head:t+a}}return{doc:m,sel:f,from:a,to:l}}(e,t,n),u=e.state.doc,p=u.slice(h.from,h.to);8===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime?(l=e.state.selection.to,c="end"):(l=e.state.selection.from,c="start"),e.input.lastKeyCode=null;let f=function(e,t,n,s,r){let i=e.findDiffStart(t,n);if(null==i)return null;let{a:o,b:a}=e.findDiffEnd(t,n+e.size,n+t.size);if("end"==r){s-=o+Math.max(0,i-Math.min(o,a))-i}if(o<i&&e.size<t.size){let e=s<=i&&s>=o?i-s:0;i-=e,i&&i<t.size&&Yl(t.textBetween(i-1,i+1))&&(i+=e?1:-1),a=i+(a-o),o=i}else if(a<i){let t=s<=i&&s>=a?i-s:0;i-=t,i&&i<e.size&&Yl(e.textBetween(i-1,i+1))&&(i+=t?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}(p.content,h.doc.content,h.from,l,c);if(f&&e.input.domChangeCount++,(po&&e.input.lastIOSEnter>Date.now()-225||go)&&r.some((e=>1==e.nodeType&&!Jl.test(e.nodeName)))&&(!f||f.endA>=f.endB)&&e.someProp("handleKeyDown",(t=>t(e,Qi(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(!f){if(!(s&&d instanceof Si&&!d.empty&&d.$head.sameParent(d.$anchor))||e.composing||h.sel&&h.sel.anchor!=h.sel.head){if(h.sel){let t=Gl(e,e.state.doc,h.sel);if(t&&!t.eq(e.state.selection)){let n=e.state.tr.setSelection(t);i&&n.setMeta("composition",i),e.dispatch(n)}}return}f={start:d.from,endA:d.to,endB:d.to}}e.state.selection.from<e.state.selection.to&&f.start==f.endB&&e.state.selection instanceof Si&&(f.start>e.state.selection.from&&f.start<=e.state.selection.from+2&&e.state.selection.from>=h.from?f.start=e.state.selection.from:f.endA<e.state.selection.to&&f.endA>=e.state.selection.to-2&&e.state.selection.to<=h.to&&(f.endB+=e.state.selection.to-f.endA,f.endA=e.state.selection.to)),io&&oo<=11&&f.endB==f.start+1&&f.endA==f.start&&f.start>h.from&&" "==h.doc.textBetween(f.start-h.from-1,f.start-h.from+1)&&(f.start--,f.endA--,f.endB--);let m,g=h.doc.resolveNoCache(f.start-h.from),y=h.doc.resolveNoCache(f.endB-h.from),v=u.resolve(f.start),b=g.sameParent(y)&&g.parent.inlineContent&&v.end()>=f.endA;if((po&&e.input.lastIOSEnter>Date.now()-225&&(!b||r.some((e=>"DIV"==e.nodeName||"P"==e.nodeName)))||!b&&g.pos<h.doc.content.size&&!g.sameParent(y)&&(m=bi.findFrom(h.doc.resolve(g.pos+1),1,!0))&&m.head==y.pos)&&e.someProp("handleKeyDown",(t=>t(e,Qi(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(e.state.selection.anchor>f.start&&function(e,t,n,s,r){if(n-t<=r.pos-s.pos||Xl(s,!0,!1)<r.pos)return!1;let i=e.resolve(t);if(!s.parent.isTextblock){let e=i.nodeAfter;return null!=e&&n==t+e.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=e.resolve(Xl(i,!0,!0));return!(!o.parent.isTextblock||o.pos>n||Xl(o,!0,!1)<n)&&s.parent.content.cut(s.parentOffset).eq(o.parent.content)}(u,f.start,f.endA,g,y)&&e.someProp("handleKeyDown",(t=>t(e,Qi(8,"Backspace")))))return void(go&&co&&e.domObserver.suppressSelectionUpdates());co&&go&&f.endB==f.start&&(e.input.lastAndroidDelete=Date.now()),go&&!b&&g.start()!=y.start()&&0==y.parentOffset&&g.depth==y.depth&&h.sel&&h.sel.anchor==h.sel.head&&h.sel.head==f.endA&&(f.endB-=2,y=h.doc.resolveNoCache(f.endB-h.from),setTimeout((()=>{e.someProp("handleKeyDown",(function(t){return t(e,Qi(13,"Enter"))}))}),20));let w,x,k,S=f.start,C=f.endA;if(b)if(g.pos==y.pos)io&&oo<=11&&0==g.parentOffset&&(e.domObserver.suppressSelectionUpdates(),setTimeout((()=>ha(e)),20)),w=e.state.tr.delete(S,C),x=u.resolve(f.start).marksAcross(u.resolve(f.endA));else if(f.endA==f.endB&&(k=function(e,t){let n,s,r,i=e.firstChild.marks,o=t.firstChild.marks,a=i,l=o;for(let d=0;d<o.length;d++)a=o[d].removeFromSet(a);for(let d=0;d<i.length;d++)l=i[d].removeFromSet(l);if(1==a.length&&0==l.length)s=a[0],n="add",r=e=>e.mark(s.addToSet(e.marks));else{if(0!=a.length||1!=l.length)return null;s=l[0],n="remove",r=e=>e.mark(s.removeFromSet(e.marks))}let c=[];for(let d=0;d<t.childCount;d++)c.push(r(t.child(d)));if(Ss.from(c).eq(e))return{mark:s,type:n}}(g.parent.content.cut(g.parentOffset,y.parentOffset),v.parent.content.cut(v.parentOffset,f.endA-v.start()))))w=e.state.tr,"add"==k.type?w.addMark(S,C,k.mark):w.removeMark(S,C,k.mark);else if(g.parent.child(g.index()).isText&&g.index()==y.index()-(y.textOffset?0:1)){let t=g.parent.textBetween(g.parentOffset,y.parentOffset);if(e.someProp("handleTextInput",(n=>n(e,S,C,t))))return;w=e.state.tr.insertText(t,S,C)}if(w||(w=e.state.tr.replace(S,C,h.doc.slice(f.start-h.from,f.endB-h.from))),h.sel){let t=Gl(e,w.doc,h.sel);t&&!(co&&go&&e.composing&&t.empty&&(f.start!=f.endB||e.input.lastAndroidDelete<Date.now()-100)&&(t.head==S||t.head==w.mapping.map(C)-1)||io&&t.empty&&t.head==S)&&w.setSelection(t)}x&&w.ensureMarks(x),i&&w.setMeta("composition",i),e.dispatch(w.scrollIntoView())}function Gl(e,t,n){return Math.max(n.anchor,n.head)>t.content.size?null:va(e,t.resolve(n.anchor),t.resolve(n.head))}function Xl(e,t,n){let s=e.depth,r=t?e.end():e.pos;for(;s>0&&(t||e.indexAfter(s)==e.node(s).childCount);)s--,r++,t=!1;if(n){let t=e.node(s).maybeChild(e.indexAfter(s));for(;t&&!t.isLeaf;)t=t.firstChild,r++}return r}function Yl(e){if(2!=e.length)return!1;let t=e.charCodeAt(0),n=e.charCodeAt(1);return t>=56320&&t<=57343&&n>=55296&&n<=56319}class Ql{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Ga,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(sc),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):"function"==typeof e?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=tc(this),ec(this),this.nodeViews=nc(this),this.docView=Jo(this.state.doc,Zl(this),$l(this),this.dom,this),this.domObserver=new Fl(this,((e,t,n,s)=>Kl(this,e,t,n,s))),this.domObserver.start(),function(e){for(let t in Wa){let n=Wa[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=t=>{!Za(e,t)||Qa(e,t)||!e.editable&&t.type in Ja||n(e,t)},Ka[t]?{passive:!0}:void 0)}uo&&e.dom.addEventListener("input",(()=>null)),Ya(e)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Ya(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(sc),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let n in this._props)t[n]=this._props[n];t.state=this.state;for(let n in e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var n;let s=this.state,r=!1,i=!1;e.storedMarks&&this.composing&&(ul(this),i=!0),this.state=e;let o=s.plugins!=e.plugins||this._props.plugins!=t.plugins;if(o||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let e=nc(this);(function(e,t){let n=0,s=0;for(let r in e){if(e[r]!=t[r])return!0;n++}for(let r in t)s++;return n!=s})(e,this.nodeViews)&&(this.nodeViews=e,r=!0)}(o||t.handleDOMEvents!=this._props.handleDOMEvents)&&Ya(this),this.editable=tc(this),ec(this);let a=$l(this),l=Zl(this),c=s.plugins==e.plugins||s.doc.eq(e.doc)?e.scrollToSelection>s.scrollToSelection?"to selection":"preserve":"reset",d=r||!this.docView.matchesNode(e.doc,l,a);!d&&e.selection.eq(s.selection)||(i=!0);let h="preserve"==c&&i&&null==this.dom.style.overflowAnchor&&function(e){let t,n,s=e.dom.getBoundingClientRect(),r=Math.max(0,s.top);for(let i=(s.left+s.right)/2,o=r+1;o<Math.min(innerHeight,s.bottom);o+=5){let s=e.root.elementFromPoint(i,o);if(!s||s==e.dom||!e.dom.contains(s))continue;let a=s.getBoundingClientRect();if(a.top>=r-20){t=s,n=a.top;break}}return{refDOM:t,refTop:n,stack:So(e.dom)}}(this);if(i){this.domObserver.stop();let t=d&&(io||co)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&function(e,t){let n=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(n)!=t.$anchor.start(n)}(s.selection,e.selection);if(d){let n=co?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=pl(this)),!r&&this.docView.update(e.doc,l,a,this)||(this.docView.updateOuterDeco(l),this.docView.destroy(),this.docView=Jo(e.doc,l,a,this.dom,this)),n&&!this.trackWrites&&(t=!0)}t||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(e){let t=e.docView.domFromPos(e.state.selection.anchor,0),n=e.domSelectionRange();return Wi(t.node,t.offset,n.anchorNode,n.anchorOffset)}(this))?ha(this,t):(ga(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),(null===(n=this.dragging)||void 0===n?void 0:n.node)&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),"reset"==c?this.dom.scrollTop=0:"to selection"==c?this.scrollToSelection():h&&function({refDOM:e,refTop:t,stack:n}){let s=e?e.getBoundingClientRect().top:0;Co(n,0==s?0:s-t)}(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(this.someProp("handleScrollToSelection",(e=>e(this))));else if(this.state.selection instanceof Ti){let t=this.docView.domAfterPos(this.state.selection.from);1==t.nodeType&&ko(this,t.getBoundingClientRect(),e)}else ko(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(e&&e.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let t=this.directPlugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let t=this.state.plugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}}}updateDraggedNode(e,t){let n=e.node,s=-1;if(this.state.doc.nodeAt(n.from)==n.node)s=n.from;else{let e=n.from+(this.state.doc.content.size-t.doc.content.size);(e>0&&this.state.doc.nodeAt(e))==n.node&&(s=e)}this.dragging=new vl(e.slice,e.move,s<0?void 0:Ti.create(this.state.doc,s))}someProp(e,t){let n,s=this._props&&this._props[e];if(null!=s&&(n=t?t(s):s))return n;for(let i=0;i<this.directPlugins.length;i++){let s=this.directPlugins[i].props[e];if(null!=s&&(n=t?t(s):s))return n}let r=this.state.plugins;if(r)for(let i=0;i<r.length;i++){let s=r[i].props[e];if(null!=s&&(n=t?t(s):s))return n}}hasFocus(){if(io){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if("false"==e.contentEditable)return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(e){if(e.setActive)return e.setActive();if(To)return e.focus(To);let t=So(e);e.focus(null==To?{get preventScroll(){return To={preventScroll:!0},!0}}:void 0),To||(To=!1,Co(t,0))}(this.dom),ha(this),this.domObserver.start()}get root(){let e=this._root;if(null==e)for(let t=this.dom.parentNode;t;t=t.parentNode)if(9==t.nodeType||11==t.nodeType&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t;return e||document}updateRoot(){this._root=null}posAtCoords(e){return Mo(this,e)}coordsAtPos(e,t=1){return Do(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let s=this.docView.posFromDOM(e,t,n);if(null==s)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,t){return Fo(this,t||this.state,e)}pasteHTML(e,t){return gl(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return gl(this,e,null,!0,t||new ClipboardEvent("paste"))}destroy(){this.docView&&(!function(e){e.domObserver.stop();for(let t in e.input.eventHandlers)e.dom.removeEventListener(t,e.input.eventHandlers[t]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],$l(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Ui=null)}get isDestroyed(){return null==this.docView}dispatchEvent(e){return function(e,t){Qa(e,t)||!Wa[t.type]||!e.editable&&t.type in Ja||Wa[t.type](e,t)}(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){let e=this.domSelection();return e?uo&&11===this.root.nodeType&&function(e){let t=e.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}(this.dom.ownerDocument)==this.dom&&function(e,t){if(t.getComposedRanges){let n=t.getComposedRanges(e.root)[0];if(n)return Ul(e,n)}let n;function s(e){e.preventDefault(),e.stopImmediatePropagation(),n=e.getTargetRanges()[0]}return e.dom.addEventListener("beforeinput",s,!0),document.execCommand("indent"),e.dom.removeEventListener("beforeinput",s,!0),n?Ul(e,n):null}(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function Zl(e){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(e.editable),e.someProp("attributes",(n=>{if("function"==typeof n&&(n=n(e.state)),n)for(let e in n)"class"==e?t.class+=" "+n[e]:"style"==e?t.style=(t.style?t.style+";":"")+n[e]:t[e]||"contenteditable"==e||"nodeName"==e||(t[e]=String(n[e]))})),t.translate||(t.translate="no"),[Cl.node(0,e.state.doc.content.size,t)]}function ec(e){if(e.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),e.cursorWrapper={dom:t,deco:Cl.widget(e.state.selection.from,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function tc(e){return!e.someProp("editable",(t=>!1===t(e.state)))}function nc(e){let t=Object.create(null);function n(e){for(let n in e)Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n])}return e.someProp("nodeViews",n),e.someProp("markViews",n),t}function sc(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}for(var rc={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ic={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},oc="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),ac="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),lc=0;lc<10;lc++)rc[48+lc]=rc[96+lc]=String(lc);for(lc=1;lc<=24;lc++)rc[lc+111]="F"+lc;for(lc=65;lc<=90;lc++)rc[lc]=String.fromCharCode(lc+32),ic[lc]=String.fromCharCode(lc);for(var cc in rc)ic.hasOwnProperty(cc)||(ic[cc]=rc[cc]);const dc="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function hc(e){let t,n,s,r,i=e.split(/-(?!$)/),o=i[i.length-1];"Space"==o&&(o=" ");for(let a=0;a<i.length-1;a++){let e=i[a];if(/^(cmd|meta|m)$/i.test(e))r=!0;else if(/^a(lt)?$/i.test(e))t=!0;else if(/^(c|ctrl|control)$/i.test(e))n=!0;else if(/^s(hift)?$/i.test(e))s=!0;else{if(!/^mod$/i.test(e))throw new Error("Unrecognized modifier name: "+e);dc?r=!0:n=!0}}return t&&(o="Alt-"+o),n&&(o="Ctrl-"+o),r&&(o="Meta-"+o),s&&(o="Shift-"+o),o}function uc(e,t,n=!0){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),n&&t.shiftKey&&(e="Shift-"+e),e}function pc(e){let t=function(e){let t=Object.create(null);for(let n in e)t[hc(n)]=e[n];return t}(e);return function(e,n){let s,r=function(e){var t=!(oc&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||ac&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?ic:rc)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}(n),i=t[uc(r,n)];if(i&&i(e.state,e.dispatch,e))return!0;if(1==r.length&&" "!=r){if(n.shiftKey){let s=t[uc(r,n,!1)];if(s&&s(e.state,e.dispatch,e))return!0}if((n.shiftKey||n.altKey||n.metaKey||r.charCodeAt(0)>127)&&(s=rc[n.keyCode])&&s!=r){let r=t[uc(s,n)];if(r&&r(e.state,e.dispatch,e))return!0}}return!1}}function fc(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("backward",e):n.parentOffset>0)?null:n}function mc(e,t,n){let s=t.nodeBefore,r=t.pos-1;for(;!s.isTextblock;r--){if(s.type.spec.isolating)return!1;let e=s.lastChild;if(!e)return!1;s=e}let i=t.nodeAfter,o=t.pos+1;for(;!i.isTextblock;o++){if(i.type.spec.isolating)return!1;let e=i.firstChild;if(!e)return!1;i=e}let a=ri(e.doc,r,o,Ms.empty);if(!a||a.from!=r||a instanceof Vr&&a.slice.size>=o-r)return!1;if(n){let t=e.tr.step(a);t.setSelection(Si.create(t.doc,r)),n(t.scrollIntoView())}return!0}function gc(e,t,n=!1){for(let s=e;s;s="start"==t?s.firstChild:s.lastChild){if(s.isTextblock)return!0;if(n&&1!=s.childCount)return!1}return!1}function yc(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function vc(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)?null:n}function bc(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}function wc(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function xc(e,t,n,s){let r,i,o=t.nodeBefore,a=t.nodeAfter,l=o.type.spec.isolating||a.type.spec.isolating;if(!l&&function(e,t,n){let s=t.nodeBefore,r=t.nodeAfter,i=t.index();return!(!(s&&r&&s.type.compatibleContent(r.type))||(!s.content.size&&t.parent.canReplace(i-1,i)?(n&&n(e.tr.delete(t.pos-s.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(i,i+1)||!r.isTextblock&&!ei(e.doc,t.pos)||(n&&n(e.tr.join(t.pos).scrollIntoView()),0)))}(e,t,n))return!0;let c=!l&&t.parent.canReplace(t.index(),t.index()+1);if(c&&(r=(i=o.contentMatchAt(o.childCount)).findWrapping(a.type))&&i.matchType(r[0]||a.type).validEnd){if(n){let s=t.pos+a.nodeSize,i=Ss.empty;for(let e=r.length-1;e>=0;e--)i=Ss.from(r[e].create(null,i));i=Ss.from(o.copy(i));let l=e.tr.step(new Ur(t.pos-1,s,t.pos,s,new Ms(i,1,0),r.length,!0)),c=l.doc.resolve(s+2*r.length);c.nodeAfter&&c.nodeAfter.type==o.type&&ei(l.doc,c.pos)&&l.join(c.pos),n(l.scrollIntoView())}return!0}let d=a.type.spec.isolating||s>0&&l?null:bi.findFrom(t,1),h=d&&d.$from.blockRange(d.$to),u=h&&Kr(h);if(null!=u&&u>=t.depth)return n&&n(e.tr.lift(h,u).scrollIntoView()),!0;if(c&&gc(a,"start",!0)&&gc(o,"end")){let s=o,r=[];for(;r.push(s),!s.isTextblock;)s=s.lastChild;let i=a,l=1;for(;!i.isTextblock;i=i.firstChild)l++;if(s.canReplace(s.childCount,s.childCount,i.content)){if(n){let s=Ss.empty;for(let e=r.length-1;e>=0;e--)s=Ss.from(r[e].copy(s));n(e.tr.step(new Ur(t.pos-r.length,t.pos+a.nodeSize,t.pos+l,t.pos+a.nodeSize-l,new Ms(s,r.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function kc(e){return function(t,n){let s=t.selection,r=e<0?s.$from:s.$to,i=r.depth;for(;r.node(i).isInline;){if(!i)return!1;i--}return!!r.node(i).isTextblock&&(n&&n(t.tr.setSelection(Si.create(t.doc,e<0?r.start(i):r.end(i)))),!0)}}const Sc=kc(-1),Cc=kc(1);function Tc(e,t=null){return function(n,s){let r=!1;for(let i=0;i<n.selection.ranges.length&&!r;i++){let{$from:{pos:s},$to:{pos:o}}=n.selection.ranges[i];n.doc.nodesBetween(s,o,((s,i)=>{if(r)return!1;if(s.isTextblock&&!s.hasMarkup(e,t))if(s.type==e)r=!0;else{let t=n.doc.resolve(i),s=t.index();r=t.parent.canReplaceWith(s,s+1,e)}}))}if(!r)return!1;if(s){let r=n.tr;for(let s=0;s<n.selection.ranges.length;s++){let{$from:{pos:i},$to:{pos:o}}=n.selection.ranges[s];r.setBlockType(i,o,e,t)}s(r.scrollIntoView())}return!0}}function Oc(e,t=null){return function(n,s){let{$from:r,$to:i}=n.selection,o=r.blockRange(i),a=!1,l=o;if(!o)return!1;if(o.depth>=2&&r.node(o.depth-1).type.compatibleContent(e)&&0==o.startIndex){if(0==r.index(o.depth-1))return!1;let e=n.doc.resolve(o.start-2);l=new qs(e,e,o.depth),o.endIndex<o.parent.childCount&&(o=new qs(r,n.doc.resolve(i.end(o.depth)),o.depth)),a=!0}let c=Gr(l,e,t,o);return!!c&&(s&&s(function(e,t,n,s,r){let i=Ss.empty;for(let d=n.length-1;d>=0;d--)i=Ss.from(n[d].type.create(n[d].attrs,i));e.step(new Ur(t.start-(s?2:0),t.end,t.start,t.end,new Ms(i,0,0),n.length,!0));let o=0;for(let d=0;d<n.length;d++)n[d].type==r&&(o=d+1);let a=n.length-o,l=t.start+n.length-(s?2:0),c=t.parent;for(let d=t.startIndex,h=t.endIndex,u=!0;d<h;d++,u=!1)!u&&Zr(e.doc,l,a)&&(e.split(l,a),l+=2*a),l+=c.child(d).nodeSize;return e}(n.tr,o,c,a,e).scrollIntoView()),!0)}}function Ec(e){return function(t,n){let{$from:s,$to:r}=t.selection,i=s.blockRange(r,(t=>t.childCount>0&&t.firstChild.type==e));return!!i&&(!n||(s.node(i.depth-1).type==e?function(e,t,n,s){let r=e.tr,i=s.end,o=s.$to.end(s.depth);i<o&&(r.step(new Ur(i-1,o,i,o,new Ms(Ss.from(n.create(null,s.parent.copy())),1,0),1,!0)),s=new qs(r.doc.resolve(s.$from.pos),r.doc.resolve(o),s.depth));const a=Kr(s);if(null==a)return!1;r.lift(s,a);let l=r.mapping.map(i,-1)-1;ei(r.doc,l)&&r.join(l);return t(r.scrollIntoView()),!0}(t,n,e,i):function(e,t,n){let s=e.tr,r=n.parent;for(let p=n.end,f=n.endIndex-1,m=n.startIndex;f>m;f--)p-=r.child(f).nodeSize,s.delete(p-1,p+1);let i=s.doc.resolve(n.start),o=i.nodeAfter;if(s.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=0==n.startIndex,l=n.endIndex==r.childCount,c=i.node(-1),d=i.index(-1);if(!c.canReplace(d+(a?0:1),d+1,o.content.append(l?Ss.empty:Ss.from(r))))return!1;let h=i.pos,u=h+o.nodeSize;return s.step(new Ur(h-(a?1:0),u+(l?1:0),h+1,u-1,new Ms((a?Ss.empty:Ss.from(r.copy(Ss.empty))).append(l?Ss.empty:Ss.from(r.copy(Ss.empty))),a?0:1,l?0:1),a?0:1)),t(s.scrollIntoView()),!0}(t,n,i)))}}function Nc(e){const{state:t,transaction:n}=e;let{selection:s}=n,{doc:r}=n,{storedMarks:i}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return i},get selection(){return s},get doc(){return r},get tr(){return s=n.selection,r=n.doc,i=n.storedMarks,n}}}"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform();class Mc{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:s}=t,{tr:r}=n,i=this.buildProps(r);return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,(...e)=>{const n=t(...e)(i);return r.getMeta("preventDispatch")||this.hasCustomState||s.dispatch(r),n}])))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:s,state:r}=this,{view:i}=s,o=[],a=!!e,l=e||r.tr,c={...Object.fromEntries(Object.entries(n).map((([e,n])=>[e,(...e)=>{const s=this.buildProps(l,t),r=n(...e)(s);return o.push(r),c}]))),run:()=>(a||!t||l.getMeta("preventDispatch")||this.hasCustomState||i.dispatch(l),o.every((e=>!0===e)))};return c}createCan(e){const{rawCommands:t,state:n}=this,s=!1,r=e||n.tr,i=this.buildProps(r,s);return{...Object.fromEntries(Object.entries(t).map((([e,t])=>[e,(...e)=>t(...e)({...i,dispatch:void 0})]))),chain:()=>this.createChain(r,s)}}buildProps(e,t=!0){const{rawCommands:n,editor:s,state:r}=this,{view:i}=s,o={tr:e,editor:s,view:i,state:Nc({state:r,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map((([e,t])=>[e,(...e)=>t(...e)(o)])))}};return o}}class jc{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const n=this.callbacks[e];return n&&n.forEach((e=>e.apply(this,t))),this}off(e,t){const n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter((e=>e!==t)):delete this.callbacks[e]),this}once(e,t){const n=(...s)=>{this.off(e,n),t.apply(this,s)};return this.on(e,n)}removeAllListeners(){this.callbacks={}}}function _c(e,t,n){if(void 0===e.config[t]&&e.parent)return _c(e.parent,t,n);if("function"==typeof e.config[t]){return e.config[t].bind({...n,parent:e.parent?_c(e.parent,t,n):null})}return e.config[t]}function Ac(e){return{baseExtensions:e.filter((e=>"extension"===e.type)),nodeExtensions:e.filter((e=>"node"===e.type)),markExtensions:e.filter((e=>"mark"===e.type))}}function Dc(e){const t=[],{nodeExtensions:n,markExtensions:s}=Ac(e),r=[...n,...s],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return e.forEach((e=>{const n=_c(e,"addGlobalAttributes",{name:e.name,options:e.options,storage:e.storage,extensions:r});if(!n)return;n().forEach((e=>{e.types.forEach((n=>{Object.entries(e.attributes).forEach((([e,s])=>{t.push({type:n,name:e,attribute:{...i,...s}})}))}))}))})),r.forEach((e=>{const n={name:e.name,options:e.options,storage:e.storage},s=_c(e,"addAttributes",n);if(!s)return;const r=s();Object.entries(r).forEach((([n,s])=>{const r={...i,...s};"function"==typeof(null==r?void 0:r.default)&&(r.default=r.default()),(null==r?void 0:r.isRequired)&&void 0===(null==r?void 0:r.default)&&delete r.default,t.push({type:e.name,name:n,attribute:r})}))})),t}function Rc(e,t){if("string"==typeof e){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}function Pc(...e){return e.filter((e=>!!e)).reduce(((e,t)=>{const n={...e};return Object.entries(t).forEach((([e,t])=>{if(n[e])if("class"===e){const s=t?t.split(" "):[],r=n[e]?n[e].split(" "):[],i=s.filter((e=>!r.includes(e)));n[e]=[...r,...i].join(" ")}else if("style"===e){const s=t?t.split(";").map((e=>e.trim())).filter(Boolean):[],r=n[e]?n[e].split(";").map((e=>e.trim())).filter(Boolean):[],i=new Map;r.forEach((e=>{const[t,n]=e.split(":").map((e=>e.trim()));i.set(t,n)})),s.forEach((e=>{const[t,n]=e.split(":").map((e=>e.trim()));i.set(t,n)})),n[e]=Array.from(i.entries()).map((([e,t])=>`${e}: ${t}`)).join("; ")}else n[e]=t;else n[e]=t})),n}),{})}function Ic(e,t){return t.filter((t=>t.type===e.type.name)).filter((e=>e.attribute.rendered)).map((t=>t.attribute.renderHTML?t.attribute.renderHTML(e.attrs)||{}:{[t.name]:e.attrs[t.name]})).reduce(((e,t)=>Pc(e,t)),{})}function $c(e){return"function"==typeof e}function Lc(e,t=void 0,...n){return $c(e)?t?e.bind(t)(...n):e(...n):e}function Bc(e,t){return"style"in e?e:{...e,getAttrs:n=>{const s=e.getAttrs?e.getAttrs(n):e.attrs;if(!1===s)return!1;const r=t.reduce(((e,t)=>{const s=t.attribute.parseHTML?t.attribute.parseHTML(n):function(e){return"string"!=typeof e?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):"true"===e||"false"!==e&&e}(n.getAttribute(t.name));return null==s?e:{...e,[t.name]:s}}),{});return{...s,...r}}}}function zc(e){return Object.fromEntries(Object.entries(e).filter((([e,t])=>("attrs"!==e||!function(e={}){return 0===Object.keys(e).length&&e.constructor===Object}(t))&&null!=t)))}function Fc(e,t){return t.nodes[e]||t.marks[e]||null}function Hc(e,t){return Array.isArray(t)?t.some((t=>("string"==typeof t?t:t.name)===e.name)):t}function Vc(e,t){const n=Cr.fromSchema(t).serializeFragment(e),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}function Uc(e){return"[object RegExp]"===Object.prototype.toString.call(e)}class qc{constructor(e){this.find=e.find,this.handler=e.handler}}function Wc(e){var t;const{editor:n,from:s,to:r,text:i,rules:o,plugin:a}=e,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(s);if(c.parent.type.spec.code||(null===(t=c.nodeBefore||c.nodeAfter)||void 0===t?void 0:t.marks.find((e=>e.type.spec.code))))return!1;let d=!1;const h=((e,t=500)=>{let n="";const s=e.parentOffset;return e.parent.nodesBetween(Math.max(0,s-t),s,((e,t,r,i)=>{var o,a;const l=(null===(a=(o=e.type.spec).toText)||void 0===a?void 0:a.call(o,{node:e,pos:t,parent:r,index:i}))||e.textContent||"%leaf%";n+=e.isAtom&&!e.isText?l:l.slice(0,Math.max(0,s-t))})),n})(c)+i;return o.forEach((e=>{if(d)return;const t=((e,t)=>{if(Uc(t))return t.exec(e);const n=t(e);if(!n)return null;const s=[n.text];return s.index=n.index,s.input=e,s.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),s.push(n.replaceWith)),s})(h,e.find);if(!t)return;const o=l.state.tr,c=Nc({state:l.state,transaction:o}),u={from:s-(t[0].length-i.length),to:r},{commands:p,chain:f,can:m}=new Mc({editor:n,state:c});null!==e.handler({state:c,range:u,match:t,commands:p,chain:f,can:m})&&o.steps.length&&(o.setMeta(a,{transform:o,from:s,to:r,text:i}),l.dispatch(o),d=!0)})),d}function Jc(e){const{editor:t,rules:n}=e,s=new Li({state:{init:()=>null,apply(e,r,i){const o=e.getMeta(s);if(o)return o;const a=e.getMeta("applyInputRules");return!!a&&setTimeout((()=>{let{text:e}=a;"string"==typeof e||(e=Vc(Ss.from(e),i.schema));const{from:r}=a,o=r+e.length;Wc({editor:t,from:r,to:o,text:e,rules:n,plugin:s})})),e.selectionSet||e.docChanged?null:r}},props:{handleTextInput:(e,r,i,o)=>Wc({editor:t,from:r,to:i,text:o,rules:n,plugin:s}),handleDOMEvents:{compositionend:e=>(setTimeout((()=>{const{$cursor:r}=e.state.selection;r&&Wc({editor:t,from:r.pos,to:r.pos,text:"",rules:n,plugin:s})})),!1)},handleKeyDown(e,r){if("Enter"!==r.key)return!1;const{$cursor:i}=e.state.selection;return!!i&&Wc({editor:t,from:i.pos,to:i.pos,text:"\n",rules:n,plugin:s})}},isInputRules:!0});return s}function Kc(e){return"Object"===function(e){return Object.prototype.toString.call(e).slice(8,-1)}(e)&&(e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype)}function Gc(e,t){const n={...e};return Kc(e)&&Kc(t)&&Object.keys(t).forEach((s=>{Kc(t[s])&&Kc(e[s])?n[s]=Gc(e[s],t[s]):n[s]=t[s]})),n}class Xc{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Lc(_c(this,"addOptions",{name:this.name}))),this.storage=Lc(_c(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Xc(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Gc(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new Xc(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=Lc(_c(t,"addOptions",{name:t.name})),t.storage=Lc(_c(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const r=s.marks();if(!!!r.find((e=>(null==e?void 0:e.type.name)===t.name)))return!1;const i=r.find((e=>(null==e?void 0:e.type.name)===t.name));return i&&n.removeStoredMark(i),n.insertText(" ",s.pos),e.view.dispatch(n),!0}return!1}}class Yc{constructor(e){this.find=e.find,this.handler=e.handler}}function Qc(e){const{editor:t,state:n,from:s,to:r,rule:i,pasteEvent:o,dropEvent:a}=e,{commands:l,chain:c,can:d}=new Mc({editor:t,state:n}),h=[];n.doc.nodesBetween(s,r,((e,t)=>{if(!e.isTextblock||e.type.spec.code)return;const u=Math.max(s,t),p=Math.min(r,t+e.content.size);((e,t,n)=>{if(Uc(t))return[...e.matchAll(t)];const s=t(e,n);return s?s.map((t=>{const n=[t.text];return n.index=t.index,n.input=e,n.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),n.push(t.replaceWith)),n})):[]})(e.textBetween(u-t,p-t,void 0,""),i.find,o).forEach((e=>{if(void 0===e.index)return;const t=u+e.index+1,s=t+e[0].length,r={from:n.tr.mapping.map(t),to:n.tr.mapping.map(s)},p=i.handler({state:n,range:r,match:e,commands:l,chain:c,can:d,pasteEvent:o,dropEvent:a});h.push(p)}))}));return h.every((e=>null!==e))}function Zc(e){const{editor:t,rules:n}=e;let s,r=null,i=!1,o=!1,a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null;try{s="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch(tm){s=null}const l=({state:e,from:n,to:r,rule:i,pasteEvt:o})=>{const l=e.tr,c=Nc({state:e,transaction:l});if(Qc({editor:t,state:c,from:Math.max(n-1,0),to:r.b-1,rule:i,pasteEvent:o,dropEvent:s})&&l.steps.length){try{s="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch(tm){s=null}return a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,l}};return n.map((e=>new Li({view(e){const t=t=>{var n;r=(null===(n=e.dom.parentElement)||void 0===n?void 0:n.contains(t.target))?e.dom.parentElement:null};return window.addEventListener("dragstart",t),{destroy(){window.removeEventListener("dragstart",t)}}},props:{handleDOMEvents:{drop:(e,t)=>(o=r===e.dom.parentElement,s=t,!1),paste:(e,t)=>{var n;const s=null===(n=t.clipboardData)||void 0===n?void 0:n.getData("text/html");return a=t,i=!!(null==s?void 0:s.includes("data-pm-slice")),!1}}},appendTransaction:(t,n,s)=>{const r=t[0],c="paste"===r.getMeta("uiEvent")&&!i,d="drop"===r.getMeta("uiEvent")&&!o,h=r.getMeta("applyPasteRules"),u=!!h;if(!c&&!d&&!u)return;if(u){let{text:t}=h;"string"==typeof t||(t=Vc(Ss.from(t),s.schema));const{from:n}=h,r=n+t.length,i=(e=>{var t;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return null===(t=n.clipboardData)||void 0===t||t.setData("text/html",e),n})(t);return l({rule:e,state:s,from:n,to:{b:r},pasteEvt:i})}const p=n.doc.content.findDiffStart(s.doc.content),f=n.doc.content.findDiffEnd(s.doc.content);return"number"==typeof p&&f&&p!==f.b?l({rule:e,state:s,from:p,to:f,pasteEvt:a}):void 0}})))}class ed{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=ed.resolve(e),this.schema=function(e,t){var n;const s=Dc(e),{nodeExtensions:r,markExtensions:i}=Ac(e),o=null===(n=r.find((e=>_c(e,"topNode"))))||void 0===n?void 0:n.name,a=Object.fromEntries(r.map((n=>{const r=s.filter((e=>e.type===n.name)),i={name:n.name,options:n.options,storage:n.storage,editor:t},o=zc({...e.reduce(((e,t)=>{const s=_c(t,"extendNodeSchema",i);return{...e,...s?s(n):{}}}),{}),content:Lc(_c(n,"content",i)),marks:Lc(_c(n,"marks",i)),group:Lc(_c(n,"group",i)),inline:Lc(_c(n,"inline",i)),atom:Lc(_c(n,"atom",i)),selectable:Lc(_c(n,"selectable",i)),draggable:Lc(_c(n,"draggable",i)),code:Lc(_c(n,"code",i)),whitespace:Lc(_c(n,"whitespace",i)),linebreakReplacement:Lc(_c(n,"linebreakReplacement",i)),defining:Lc(_c(n,"defining",i)),isolating:Lc(_c(n,"isolating",i)),attrs:Object.fromEntries(r.map((e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),a=Lc(_c(n,"parseHTML",i));a&&(o.parseDOM=a.map((e=>Bc(e,r))));const l=_c(n,"renderHTML",i);l&&(o.toDOM=e=>l({node:e,HTMLAttributes:Ic(e,r)}));const c=_c(n,"renderText",i);return c&&(o.toText=c),[n.name,o]}))),l=Object.fromEntries(i.map((n=>{const r=s.filter((e=>e.type===n.name)),i={name:n.name,options:n.options,storage:n.storage,editor:t},o=zc({...e.reduce(((e,t)=>{const s=_c(t,"extendMarkSchema",i);return{...e,...s?s(n):{}}}),{}),inclusive:Lc(_c(n,"inclusive",i)),excludes:Lc(_c(n,"excludes",i)),group:Lc(_c(n,"group",i)),spanning:Lc(_c(n,"spanning",i)),code:Lc(_c(n,"code",i)),attrs:Object.fromEntries(r.map((e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),a=Lc(_c(n,"parseHTML",i));a&&(o.parseDOM=a.map((e=>Bc(e,r))));const l=_c(n,"renderHTML",i);return l&&(o.toDOM=e=>l({mark:e,HTMLAttributes:Ic(e,r)})),[n.name,o]})));return new ur({topNode:o,nodes:a,marks:l})}(this.extensions,t),this.setupExtensions()}static resolve(e){const t=ed.sort(ed.flatten(e)),n=function(e){const t=e.filter(((t,n)=>e.indexOf(t)!==n));return Array.from(new Set(t))}(t.map((e=>e.name)));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map((e=>`'${e}'`)).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map((e=>{const t=_c(e,"addExtensions",{name:e.name,options:e.options,storage:e.storage});return t?[e,...this.flatten(t())]:e})).flat(10)}static sort(e){return e.sort(((e,t)=>{const n=_c(e,"priority")||100,s=_c(t,"priority")||100;return n>s?-1:n<s?1:0}))}get commands(){return this.extensions.reduce(((e,t)=>{const n=_c(t,"addCommands",{name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:Fc(t.name,this.schema)});return n?{...e,...n()}:e}),{})}get plugins(){const{editor:e}=this,t=ed.sort([...this.extensions].reverse()),n=[],s=[],r=t.map((t=>{const r={name:t.name,options:t.options,storage:t.storage,editor:e,type:Fc(t.name,this.schema)},i=[],o=_c(t,"addKeyboardShortcuts",r);let a={};if("mark"===t.type&&_c(t,"exitable",r)&&(a.ArrowRight=()=>Xc.handleExit({editor:e,mark:t})),o){const t=Object.fromEntries(Object.entries(o()).map((([t,n])=>[t,()=>n({editor:e})])));a={...a,...t}}const l=new Li({props:{handleKeyDown:pc(a)}});i.push(l);const c=_c(t,"addInputRules",r);Hc(t,e.options.enableInputRules)&&c&&n.push(...c());const d=_c(t,"addPasteRules",r);Hc(t,e.options.enablePasteRules)&&d&&s.push(...d());const h=_c(t,"addProseMirrorPlugins",r);if(h){const e=h();i.push(...e)}return i})).flat();return[Jc({editor:e,rules:n}),...Zc({editor:e,rules:s}),...r]}get attributes(){return Dc(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=Ac(this.extensions);return Object.fromEntries(t.filter((e=>!!_c(e,"addNodeView"))).map((t=>{const n=this.attributes.filter((e=>e.type===t.name)),s={name:t.name,options:t.options,storage:t.storage,editor:e,type:Rc(t.name,this.schema)},r=_c(t,"addNodeView",s);if(!r)return[];return[t.name,(s,i,o,a,l)=>{const c=Ic(s,n);return r()({node:s,view:i,getPos:o,decorations:a,innerDecorations:l,editor:e,extension:t,HTMLAttributes:c})}]})))}setupExtensions(){this.extensions.forEach((e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const n={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:Fc(e.name,this.schema)};if("mark"===e.type){(null===(t=Lc(_c(e,"keepOnSplit",n)))||void 0===t||t)&&this.splittableMarks.push(e.name)}const s=_c(e,"onBeforeCreate",n),r=_c(e,"onCreate",n),i=_c(e,"onUpdate",n),o=_c(e,"onSelectionUpdate",n),a=_c(e,"onTransaction",n),l=_c(e,"onFocus",n),c=_c(e,"onBlur",n),d=_c(e,"onDestroy",n);s&&this.editor.on("beforeCreate",s),r&&this.editor.on("create",r),i&&this.editor.on("update",i),o&&this.editor.on("selectionUpdate",o),a&&this.editor.on("transaction",a),l&&this.editor.on("focus",l),c&&this.editor.on("blur",c),d&&this.editor.on("destroy",d)}))}}class td{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Lc(_c(this,"addOptions",{name:this.name}))),this.storage=Lc(_c(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new td(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Gc(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new td({...this.config,...e});return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=Lc(_c(t,"addOptions",{name:t.name})),t.storage=Lc(_c(t,"addStorage",{name:t.name,options:t.options})),t}}function nd(e,t,n){const{from:s,to:r}=t,{blockSeparator:i="\n\n",textSerializers:o={}}=n||{};let a="";return e.nodesBetween(s,r,((e,n,l,c)=>{var d;e.isBlock&&n>s&&(a+=i);const h=null==o?void 0:o[e.type.name];if(h)return l&&(a+=h({node:e,pos:n,parent:l,index:c,range:t})),!1;e.isText&&(a+=null===(d=null==e?void 0:e.text)||void 0===d?void 0:d.slice(Math.max(s,n)-n,r-n))})),a}function sd(e){return Object.fromEntries(Object.entries(e.nodes).filter((([,e])=>e.spec.toText)).map((([e,t])=>[e,t.spec.toText])))}const rd=td.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new Li({key:new Fi("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:s,selection:r}=t,{ranges:i}=r,o=Math.min(...i.map((e=>e.$from.pos))),a=Math.max(...i.map((e=>e.$to.pos))),l=sd(n);return nd(s,{from:o,to:a},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}});function id(e,t,n={strict:!0}){const s=Object.keys(t);return!s.length||s.every((s=>n.strict?t[s]===e[s]:Uc(t[s])?t[s].test(e[s]):t[s]===e[s]))}function od(e,t,n={}){return e.find((e=>e.type===t&&id(Object.fromEntries(Object.keys(n).map((t=>[t,e.attrs[t]]))),n)))}function ad(e,t,n={}){return!!od(e,t,n)}function ld(e,t,n){var s;if(!e||!t)return;let r=e.parent.childAfter(e.parentOffset);if(r.node&&r.node.marks.some((e=>e.type===t))||(r=e.parent.childBefore(e.parentOffset)),!r.node||!r.node.marks.some((e=>e.type===t)))return;n=n||(null===(s=r.node.marks[0])||void 0===s?void 0:s.attrs);if(!od([...r.node.marks],t,n))return;let i=r.index,o=e.start()+r.offset,a=i+1,l=o+r.node.nodeSize;for(;i>0&&ad([...e.parent.child(i-1).marks],t,n);)i-=1,o-=e.parent.child(i).nodeSize;for(;a<e.parent.childCount&&ad([...e.parent.child(a).marks],t,n);)l+=e.parent.child(a).nodeSize,a+=1;return{from:o,to:l}}function cd(e,t){if("string"==typeof e){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}function dd(e){return e instanceof Si}function hd(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function ud(e,t=null){if(!t)return null;const n=bi.atStart(e),s=bi.atEnd(e);if("start"===t||!0===t)return n;if("end"===t)return s;const r=n.from,i=s.to;return"all"===t?Si.create(e,hd(0,r,i),hd(e.content.size,r,i)):Si.create(e,hd(t,r,i),hd(t,r,i))}function pd(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const fd=e=>{const t=e.childNodes;for(let n=t.length-1;n>=0;n-=1){const s=t[n];3===s.nodeType&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?e.removeChild(s):1===s.nodeType&&fd(s)}return e};function md(e){const t=`<body>${e}</body>`,n=(new window.DOMParser).parseFromString(t,"text/html").body;return fd(n)}function gd(e,t,n){if(e instanceof Js||e instanceof Ss)return e;n={slice:!0,parseOptions:{},...n};const s="string"==typeof e;if("object"==typeof e&&null!==e)try{if(Array.isArray(e)&&e.length>0)return Ss.fromArray(e.map((e=>t.nodeFromJSON(e))));const s=t.nodeFromJSON(e);return n.errorOnInvalidContent&&s.check(),s}catch(r){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:r});return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",r),gd("",t,n)}if(s){if(n.errorOnInvalidContent){let s=!1,r="";const i=new ur({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:e=>(s=!0,r="string"==typeof e?e:e.outerHTML,null)}]}})});if(n.slice?fr.fromSchema(i).parseSlice(md(e),n.parseOptions):fr.fromSchema(i).parse(md(e),n.parseOptions),n.errorOnInvalidContent&&s)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${r}`)})}const s=fr.fromSchema(t);return n.slice?s.parseSlice(md(e),n.parseOptions).content:s.parse(md(e),n.parseOptions)}return gd("",t,n)}function yd(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}function vd(e,t,n={}){const{from:s,to:r,empty:i}=e.selection,o=t?Rc(t,e.schema):null,a=[];e.doc.nodesBetween(s,r,((e,t)=>{if(e.isText)return;const n=Math.max(s,t),i=Math.min(r,t+e.nodeSize);a.push({node:e,from:n,to:i})}));const l=r-s,c=a.filter((e=>!o||o.name===e.node.type.name)).filter((e=>id(e.node.attrs,n,{strict:!1})));if(i)return!!c.length;return c.reduce(((e,t)=>e+t.to-t.from),0)>=l}function bd(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function wd(e,t){const n="string"==typeof t?[t]:t;return Object.keys(e).reduce(((t,s)=>(n.includes(s)||(t[s]=e[s]),t)),{})}function xd(e,t,n={},s={}){return gd(e,t,{slice:!1,parseOptions:n,errorOnInvalidContent:s.errorOnInvalidContent})}function kd(e,t){const n=cd(t,e.schema),{from:s,to:r,empty:i}=e.selection,o=[];i?(e.storedMarks&&o.push(...e.storedMarks),o.push(...e.selection.$head.marks())):e.doc.nodesBetween(s,r,(e=>{o.push(...e.marks)}));const a=o.find((e=>e.type.name===n.name));return a?{...a.attrs}:{}}function Sd(e){return t=>function(e,t){for(let n=e.depth;n>0;n-=1){const s=e.node(n);if(t(s))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:s}}}(t.$from,e)}function Cd(e,t){const n=bd("string"==typeof t?t:t.name,e.schema);return"node"===n?function(e,t){const n=Rc(t,e.schema),{from:s,to:r}=e.selection,i=[];e.doc.nodesBetween(s,r,(e=>{i.push(e)}));const o=i.reverse().find((e=>e.type.name===n.name));return o?{...o.attrs}:{}}(e,t):"mark"===n?kd(e,t):{}}function Td(e){const t=function(e,t=JSON.stringify){const n={};return e.filter((e=>{const s=t(e);return!Object.prototype.hasOwnProperty.call(n,s)&&(n[s]=!0)}))}(e);return 1===t.length?t:t.filter(((e,n)=>!t.filter(((e,t)=>t!==n)).some((t=>e.oldRange.from>=t.oldRange.from&&e.oldRange.to<=t.oldRange.to&&e.newRange.from>=t.newRange.from&&e.newRange.to<=t.newRange.to))))}function Od(e,t,n){const s=[];return e===t?n.resolve(e).marks().forEach((t=>{const r=ld(n.resolve(e),t.type);r&&s.push({mark:t,...r})})):n.nodesBetween(e,t,((e,t)=>{e&&void 0!==(null==e?void 0:e.nodeSize)&&s.push(...e.marks.map((n=>({from:t,to:t+e.nodeSize,mark:n}))))})),s}function Ed(e,t,n){return Object.fromEntries(Object.entries(n).filter((([n])=>{const s=e.find((e=>e.type===t&&e.name===n));return!!s&&s.attribute.keepOnSplit})))}function Nd(e,t,n={}){const{empty:s,ranges:r}=e.selection,i=t?cd(t,e.schema):null;if(s)return!!(e.storedMarks||e.selection.$from.marks()).filter((e=>!i||i.name===e.type.name)).find((e=>id(e.attrs,n,{strict:!1})));let o=0;const a=[];if(r.forEach((({$from:t,$to:n})=>{const s=t.pos,r=n.pos;e.doc.nodesBetween(s,r,((e,t)=>{if(!e.isText&&!e.marks.length)return;const n=Math.max(s,t),i=Math.min(r,t+e.nodeSize);o+=i-n,a.push(...e.marks.map((e=>({mark:e,from:n,to:i}))))}))})),0===o)return!1;const l=a.filter((e=>!i||i.name===e.mark.type.name)).filter((e=>id(e.mark.attrs,n,{strict:!1}))).reduce(((e,t)=>e+t.to-t.from),0),c=a.filter((e=>!i||e.mark.type!==i&&e.mark.type.excludes(i))).reduce(((e,t)=>e+t.to-t.from),0);return(l>0?l+c:l)>=o}function Md(e,t){const{nodeExtensions:n}=Ac(t),s=n.find((t=>t.name===e));if(!s)return!1;const r=Lc(_c(s,"group",{name:s.name,options:s.options,storage:s.storage}));return"string"==typeof r&&r.split(" ").includes("list")}function jd(e,{checkChildren:t=!0,ignoreWhitespace:n=!1}={}){var s;if(n){if("hardBreak"===e.type.name)return!0;if(e.isText)return/^\s*$/m.test(null!==(s=e.text)&&void 0!==s?s:"")}if(e.isText)return!e.text;if(e.isAtom||e.isLeaf)return!1;if(0===e.content.childCount)return!0;if(t){let s=!0;return e.content.forEach((e=>{!1!==s&&(jd(e,{ignoreWhitespace:n,checkChildren:t})||(s=!1))})),s}return!1}function _d(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const s=n.filter((e=>null==t?void 0:t.includes(e.type.name)));e.tr.ensureMarks(s)}}const Ad=(e,t)=>{const n=Sd((e=>e.type===t))(e.selection);if(!n)return!0;const s=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===s)return!0;const r=e.doc.nodeAt(s);return n.node.type!==(null==r?void 0:r.type)||!ei(e.doc,n.pos)||(e.join(n.pos),!0)},Dd=(e,t)=>{const n=Sd((e=>e.type===t))(e.selection);if(!n)return!0;const s=e.doc.resolve(n.start).after(n.depth);if(void 0===s)return!0;const r=e.doc.nodeAt(s);return n.node.type!==(null==r?void 0:r.type)||!ei(e.doc,s)||(e.join(s),!0)};var Rd=Object.freeze({__proto__:null,blur:()=>({editor:e,view:t})=>(requestAnimationFrame((()=>{var n;e.isDestroyed||(t.dom.blur(),null===(n=null===window||void 0===window?void 0:window.getSelection())||void 0===n||n.removeAllRanges())})),!0),clearContent:(e=!1)=>({commands:t})=>t.setContent("",e),clearNodes:()=>({state:e,tr:t,dispatch:n})=>{const{selection:s}=t,{ranges:r}=s;return!n||(r.forEach((({$from:n,$to:s})=>{e.doc.nodesBetween(n.pos,s.pos,((e,n)=>{if(e.type.isText)return;const{doc:s,mapping:r}=t,i=s.resolve(r.map(n)),o=s.resolve(r.map(n+e.nodeSize)),a=i.blockRange(o);if(!a)return;const l=Kr(a);if(e.type.isTextblock){const{defaultType:e}=i.parent.contentMatchAt(i.index());t.setNodeMarkup(a.start,e)}(l||0===l)&&t.lift(a,l)}))})),!0)},command:e=>t=>e(t),createParagraphNear:()=>({state:e,dispatch:t})=>((e,t)=>{let n=e.selection,{$from:s,$to:r}=n;if(n instanceof Ei||s.parent.inlineContent||r.parent.inlineContent)return!1;let i=wc(r.parent.contentMatchAt(r.indexAfter()));if(!i||!i.isTextblock)return!1;if(t){let n=(!s.parentOffset&&r.index()<r.parent.childCount?s:r).pos,o=e.tr.insert(n,i.createAndFill());o.setSelection(Si.create(o.doc,n+1)),t(o.scrollIntoView())}return!0})(e,t),cut:(e,t)=>({editor:n,tr:s})=>{const{state:r}=n,i=r.doc.slice(e.from,e.to);s.deleteRange(e.from,e.to);const o=s.mapping.map(t);return s.insert(o,i.content),s.setSelection(new Si(s.doc.resolve(o-1))),!0},deleteCurrentNode:()=>({tr:e,dispatch:t})=>{const{selection:n}=e,s=n.$anchor.node();if(s.content.size>0)return!1;const r=e.selection.$anchor;for(let i=r.depth;i>0;i-=1){if(r.node(i).type===s.type){if(t){const t=r.before(i),n=r.after(i);e.delete(t,n).scrollIntoView()}return!0}}return!1},deleteNode:e=>({tr:t,state:n,dispatch:s})=>{const r=Rc(e,n.schema),i=t.selection.$anchor;for(let e=i.depth;e>0;e-=1){if(i.node(e).type===r){if(s){const n=i.before(e),s=i.after(e);t.delete(n,s).scrollIntoView()}return!0}}return!1},deleteRange:e=>({tr:t,dispatch:n})=>{const{from:s,to:r}=e;return n&&t.delete(s,r),!0},deleteSelection:()=>({state:e,dispatch:t})=>((e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0))(e,t),enter:()=>({commands:e})=>e.keyboardShortcut("Enter"),exitCode:()=>({state:e,dispatch:t})=>((e,t)=>{let{$head:n,$anchor:s}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(s))return!1;let r=n.node(-1),i=n.indexAfter(-1),o=wc(r.contentMatchAt(i));if(!o||!r.canReplaceWith(i,i,o))return!1;if(t){let s=n.after(),r=e.tr.replaceWith(s,s,o.createAndFill());r.setSelection(bi.near(r.doc.resolve(s),1)),t(r.scrollIntoView())}return!0})(e,t),extendMarkRange:(e,t={})=>({tr:n,state:s,dispatch:r})=>{const i=cd(e,s.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:d}=a;if(r){const e=ld(l,i,t);if(e&&e.from<=c&&e.to>=d){const t=Si.create(o,e.from,e.to);n.setSelection(t)}}return!0},first:e=>t=>{const n="function"==typeof e?e(t):e;for(let e=0;e<n.length;e+=1)if(n[e](t))return!0;return!1},focus:(e=null,t={})=>({editor:n,view:s,tr:r,dispatch:i})=>{t={scrollIntoView:!0,...t};const o=()=>{pd()&&s.dom.focus(),requestAnimationFrame((()=>{n.isDestroyed||(s.focus(),(null==t?void 0:t.scrollIntoView)&&n.commands.scrollIntoView())}))};if(s.hasFocus()&&null===e||!1===e)return!0;if(i&&null===e&&!dd(n.state.selection))return o(),!0;const a=ud(r.doc,e)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||r.setSelection(a),l&&r.storedMarks&&r.setStoredMarks(r.storedMarks),o()),!0},forEach:(e,t)=>n=>e.every(((e,s)=>t(e,{...n,index:s}))),insertContent:(e,t)=>({tr:n,commands:s})=>s.insertContentAt({from:n.selection.from,to:n.selection.to},e,t),insertContentAt:(e,t,n)=>({tr:s,dispatch:r,editor:i})=>{var o;if(r){let r;n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};try{r=gd(t,i.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions},errorOnInvalidContent:null!==(o=n.errorOnInvalidContent)&&void 0!==o?o:i.options.enableContentCheck})}catch(tm){return i.emit("contentError",{editor:i,error:tm,disableCollaboration:()=>{i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}}),!1}let{from:a,to:l}="number"==typeof e?{from:e,to:e}:{from:e.from,to:e.to},c=!0,d=!0;if(("type"in r?[r]:r).forEach((e=>{e.check(),c=!!c&&(e.isText&&0===e.marks.length),d=!!d&&e.isBlock})),a===l&&d){const{parent:e}=s.doc.resolve(a);e.isTextblock&&!e.type.spec.code&&!e.childCount&&(a-=1,l+=1)}let h;if(c){if(Array.isArray(t))h=t.map((e=>e.text||"")).join("");else if(t instanceof Ss){let e="";t.forEach((t=>{t.text&&(e+=t.text)})),h=e}else h="object"==typeof t&&t&&t.text?t.text:t;s.insertText(h,a,l)}else h=r,s.replaceWith(a,l,h);n.updateSelection&&function(e,t,n){const s=e.steps.length-1;if(s<t)return;const r=e.steps[s];if(!(r instanceof Vr||r instanceof Ur))return;const i=e.mapping.maps[s];let o=0;i.forEach(((e,t,n,s)=>{0===o&&(o=s)})),e.setSelection(bi.near(e.doc.resolve(o),n))}(s,s.steps.length-1,-1),n.applyInputRules&&s.setMeta("applyInputRules",{from:a,text:h}),n.applyPasteRules&&s.setMeta("applyPasteRules",{from:a,text:h})}return!0},joinBackward:()=>({state:e,dispatch:t})=>((e,t,n)=>{let s=fc(e,n);if(!s)return!1;let r=yc(s);if(!r){let n=s.blockRange(),r=n&&Kr(n);return null!=r&&(t&&t(e.tr.lift(n,r).scrollIntoView()),!0)}let i=r.nodeBefore;if(xc(e,r,t,-1))return!0;if(0==s.parent.content.size&&(gc(i,"end")||Ti.isSelectable(i)))for(let o=s.depth;;o--){let n=ri(e.doc,s.before(o),s.after(o),Ms.empty);if(n&&n.slice.size<n.to-n.from){if(t){let s=e.tr.step(n);s.setSelection(gc(i,"end")?bi.findFrom(s.doc.resolve(s.mapping.map(r.pos,-1)),-1):Ti.create(s.doc,r.pos-i.nodeSize)),t(s.scrollIntoView())}return!0}if(1==o||s.node(o-1).childCount>1)break}return!(!i.isAtom||r.depth!=s.depth-1||(t&&t(e.tr.delete(r.pos-i.nodeSize,r.pos).scrollIntoView()),0))})(e,t),joinDown:()=>({state:e,dispatch:t})=>((e,t)=>{let n,s=e.selection;if(s instanceof Ti){if(s.node.isTextblock||!ei(e.doc,s.to))return!1;n=s.to}else if(n=ni(e.doc,s.to,1),null==n)return!1;return t&&t(e.tr.join(n).scrollIntoView()),!0})(e,t),joinForward:()=>({state:e,dispatch:t})=>((e,t,n)=>{let s=vc(e,n);if(!s)return!1;let r=bc(s);if(!r)return!1;let i=r.nodeAfter;if(xc(e,r,t,1))return!0;if(0==s.parent.content.size&&(gc(i,"start")||Ti.isSelectable(i))){let n=ri(e.doc,s.before(),s.after(),Ms.empty);if(n&&n.slice.size<n.to-n.from){if(t){let s=e.tr.step(n);s.setSelection(gc(i,"start")?bi.findFrom(s.doc.resolve(s.mapping.map(r.pos)),1):Ti.create(s.doc,s.mapping.map(r.pos))),t(s.scrollIntoView())}return!0}}return!(!i.isAtom||r.depth!=s.depth-1||(t&&t(e.tr.delete(r.pos,r.pos+i.nodeSize).scrollIntoView()),0))})(e,t),joinItemBackward:()=>({state:e,dispatch:t,tr:n})=>{try{const s=ni(e.doc,e.selection.$from.pos,-1);return null!=s&&(n.join(s,2),t&&t(n),!0)}catch(tm){return!1}},joinItemForward:()=>({state:e,dispatch:t,tr:n})=>{try{const s=ni(e.doc,e.selection.$from.pos,1);return null!=s&&(n.join(s,2),t&&t(n),!0)}catch(tm){return!1}},joinTextblockBackward:()=>({state:e,dispatch:t})=>((e,t,n)=>{let s=fc(e,n);if(!s)return!1;let r=yc(s);return!!r&&mc(e,r,t)})(e,t),joinTextblockForward:()=>({state:e,dispatch:t})=>((e,t,n)=>{let s=vc(e,n);if(!s)return!1;let r=bc(s);return!!r&&mc(e,r,t)})(e,t),joinUp:()=>({state:e,dispatch:t})=>((e,t)=>{let n,s=e.selection,r=s instanceof Ti;if(r){if(s.node.isTextblock||!ei(e.doc,s.from))return!1;n=s.from}else if(n=ni(e.doc,s.from,-1),null==n)return!1;if(t){let s=e.tr.join(n);r&&s.setSelection(Ti.create(s.doc,n-e.doc.resolve(n).nodeBefore.nodeSize)),t(s.scrollIntoView())}return!0})(e,t),keyboardShortcut:e=>({editor:t,view:n,tr:s,dispatch:r})=>{const i=function(e){const t=e.split(/-(?!$)/);let n,s,r,i,o=t[t.length-1];"Space"===o&&(o=" ");for(let a=0;a<t.length-1;a+=1){const e=t[a];if(/^(cmd|meta|m)$/i.test(e))i=!0;else if(/^a(lt)?$/i.test(e))n=!0;else if(/^(c|ctrl|control)$/i.test(e))s=!0;else if(/^s(hift)?$/i.test(e))r=!0;else{if(!/^mod$/i.test(e))throw new Error(`Unrecognized modifier name: ${e}`);pd()||yd()?i=!0:s=!0}}return n&&(o=`Alt-${o}`),s&&(o=`Ctrl-${o}`),i&&(o=`Meta-${o}`),r&&(o=`Shift-${o}`),o}(e).split(/-(?!$)/),o=i.find((e=>!["Alt","Ctrl","Meta","Shift"].includes(e))),a=new KeyboardEvent("keydown",{key:"Space"===o?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction((()=>{n.someProp("handleKeyDown",(e=>e(n,a)))}));return null==l||l.steps.forEach((e=>{const t=e.map(s.mapping);t&&r&&s.maybeStep(t)})),!0},lift:(e,t={})=>({state:n,dispatch:s})=>!!vd(n,Rc(e,n.schema),t)&&((e,t)=>{let{$from:n,$to:s}=e.selection,r=n.blockRange(s),i=r&&Kr(r);return null!=i&&(t&&t(e.tr.lift(r,i).scrollIntoView()),!0)})(n,s),liftEmptyBlock:()=>({state:e,dispatch:t})=>((e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let s=n.before();if(Zr(e.doc,s))return t&&t(e.tr.split(s).scrollIntoView()),!0}let s=n.blockRange(),r=s&&Kr(s);return null!=r&&(t&&t(e.tr.lift(s,r).scrollIntoView()),!0)})(e,t),liftListItem:e=>({state:t,dispatch:n})=>Ec(Rc(e,t.schema))(t,n),newlineInCode:()=>({state:e,dispatch:t})=>((e,t)=>{let{$head:n,$anchor:s}=e.selection;return!(!n.parent.type.spec.code||!n.sameParent(s)||(t&&t(e.tr.insertText("\n").scrollIntoView()),0))})(e,t),resetAttributes:(e,t)=>({tr:n,state:s,dispatch:r})=>{let i=null,o=null;const a=bd("string"==typeof e?e:e.name,s.schema);return!!a&&("node"===a&&(i=Rc(e,s.schema)),"mark"===a&&(o=cd(e,s.schema)),r&&n.selection.ranges.forEach((e=>{s.doc.nodesBetween(e.$from.pos,e.$to.pos,((e,s)=>{i&&i===e.type&&n.setNodeMarkup(s,void 0,wd(e.attrs,t)),o&&e.marks.length&&e.marks.forEach((r=>{o===r.type&&n.addMark(s,s+e.nodeSize,o.create(wd(r.attrs,t)))}))}))})),!0)},scrollIntoView:()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),selectAll:()=>({tr:e,commands:t})=>t.setTextSelection({from:0,to:e.doc.content.size}),selectNodeBackward:()=>({state:e,dispatch:t})=>((e,t,n)=>{let{$head:s,empty:r}=e.selection,i=s;if(!r)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):s.parentOffset>0)return!1;i=yc(s)}let o=i&&i.nodeBefore;return!(!o||!Ti.isSelectable(o)||(t&&t(e.tr.setSelection(Ti.create(e.doc,i.pos-o.nodeSize)).scrollIntoView()),0))})(e,t),selectNodeForward:()=>({state:e,dispatch:t})=>((e,t,n)=>{let{$head:s,empty:r}=e.selection,i=s;if(!r)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):s.parentOffset<s.parent.content.size)return!1;i=bc(s)}let o=i&&i.nodeAfter;return!(!o||!Ti.isSelectable(o)||(t&&t(e.tr.setSelection(Ti.create(e.doc,i.pos)).scrollIntoView()),0))})(e,t),selectParentNode:()=>({state:e,dispatch:t})=>((e,t)=>{let n,{$from:s,to:r}=e.selection,i=s.sharedDepth(r);return 0!=i&&(n=s.before(i),t&&t(e.tr.setSelection(Ti.create(e.doc,n))),!0)})(e,t),selectTextblockEnd:()=>({state:e,dispatch:t})=>Cc(e,t),selectTextblockStart:()=>({state:e,dispatch:t})=>Sc(e,t),setContent:(e,t=!1,n={},s={})=>({editor:r,tr:i,dispatch:o,commands:a})=>{var l,c;const{doc:d}=i;if("full"!==n.preserveWhitespace){const a=xd(e,r.schema,n,{errorOnInvalidContent:null!==(l=s.errorOnInvalidContent)&&void 0!==l?l:r.options.enableContentCheck});return o&&i.replaceWith(0,d.content.size,a).setMeta("preventUpdate",!t),!0}return o&&i.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:d.content.size},e,{parseOptions:n,errorOnInvalidContent:null!==(c=s.errorOnInvalidContent)&&void 0!==c?c:r.options.enableContentCheck})},setMark:(e,t={})=>({tr:n,state:s,dispatch:r})=>{const{selection:i}=n,{empty:o,ranges:a}=i,l=cd(e,s.schema);if(r)if(o){const e=kd(s,l);n.addStoredMark(l.create({...e,...t}))}else a.forEach((e=>{const r=e.$from.pos,i=e.$to.pos;s.doc.nodesBetween(r,i,((e,s)=>{const o=Math.max(s,r),a=Math.min(s+e.nodeSize,i);e.marks.find((e=>e.type===l))?e.marks.forEach((e=>{l===e.type&&n.addMark(o,a,l.create({...e.attrs,...t}))})):n.addMark(o,a,l.create(t))}))}));return function(e,t,n){var s;const{selection:r}=t;let i=null;if(dd(r)&&(i=r.$cursor),i){const t=null!==(s=e.storedMarks)&&void 0!==s?s:i.marks();return!!n.isInSet(t)||!t.some((e=>e.type.excludes(n)))}const{ranges:o}=r;return o.some((({$from:t,$to:s})=>{let r=0===t.depth&&e.doc.inlineContent&&e.doc.type.allowsMarkType(n);return e.doc.nodesBetween(t.pos,s.pos,((e,t,s)=>{if(r)return!1;if(e.isInline){const t=!s||s.type.allowsMarkType(n),i=!!n.isInSet(e.marks)||!e.marks.some((e=>e.type.excludes(n)));r=t&&i}return!r})),r}))}(s,n,l)},setMeta:(e,t)=>({tr:n})=>(n.setMeta(e,t),!0),setNode:(e,t={})=>({state:n,dispatch:s,chain:r})=>{const i=Rc(e,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),i.isTextblock?r().command((({commands:e})=>!!Tc(i,{...o,...t})(n)||e.clearNodes())).command((({state:e})=>Tc(i,{...o,...t})(e,s))).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},setNodeSelection:e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,s=hd(e,0,n.content.size),r=Ti.create(n,s);t.setSelection(r)}return!0},setTextSelection:e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,{from:s,to:r}="number"==typeof e?{from:e,to:e}:e,i=Si.atStart(n).from,o=Si.atEnd(n).to,a=hd(s,i,o),l=hd(r,i,o),c=Si.create(n,a,l);t.setSelection(c)}return!0},sinkListItem:e=>({state:t,dispatch:n})=>{const s=Rc(e,t.schema);return(r=s,function(e,t){let{$from:n,$to:s}=e.selection,i=n.blockRange(s,(e=>e.childCount>0&&e.firstChild.type==r));if(!i)return!1;let o=i.startIndex;if(0==o)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=r)return!1;if(t){let n=l.lastChild&&l.lastChild.type==a.type,s=Ss.from(n?r.create():null),o=new Ms(Ss.from(r.create(null,Ss.from(a.type.create(null,s)))),n?3:1,0),c=i.start,d=i.end;t(e.tr.step(new Ur(c-(n?3:1),d,c,d,o,1,!0)).scrollIntoView())}return!0})(t,n);var r},splitBlock:({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:s,editor:r})=>{const{selection:i,doc:o}=t,{$from:a,$to:l}=i,c=Ed(r.extensionManager.attributes,a.node().type.name,a.node().attrs);if(i instanceof Ti&&i.node.isBlock)return!(!a.parentOffset||!Zr(o,a.pos))&&(s&&(e&&_d(n,r.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=0===a.depth?void 0:function(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(a.node(-1).contentMatchAt(a.indexAfter(-1)));let u=d&&h?[{type:h,attrs:c}]:void 0,p=Zr(t.doc,t.mapping.map(a.pos),1,u);if(u||p||!Zr(t.doc,t.mapping.map(a.pos),1,h?[{type:h}]:void 0)||(p=!0,u=h?[{type:h,attrs:c}]:void 0),s){if(p&&(i instanceof Si&&t.deleteSelection(),t.split(t.mapping.map(a.pos),1,u),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const e=t.mapping.map(a.before()),n=t.doc.resolve(e);a.node(-1).canReplaceWith(n.index(),n.index()+1,h)&&t.setNodeMarkup(t.mapping.map(a.before()),h)}e&&_d(n,r.extensionManager.splittableMarks),t.scrollIntoView()}return p},splitListItem:(e,t={})=>({tr:n,state:s,dispatch:r,editor:i})=>{var o;const a=Rc(e,s.schema),{$from:l,$to:c}=s.selection,d=s.selection.node;if(d&&d.isBlock||l.depth<2||!l.sameParent(c))return!1;const h=l.node(-1);if(h.type!==a)return!1;const u=i.extensionManager.attributes;if(0===l.parent.content.size&&l.node(-1).childCount===l.indexAfter(-1)){if(2===l.depth||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(r){let e=Ss.empty;const s=l.index(-1)?1:l.index(-2)?2:3;for(let t=l.depth-s;t>=l.depth-3;t-=1)e=Ss.from(l.node(t).copy(e));const r=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,i={...Ed(u,l.node().type.name,l.node().attrs),...t},c=(null===(o=a.contentMatch.defaultType)||void 0===o?void 0:o.createAndFill(i))||void 0;e=e.append(Ss.from(a.createAndFill(null,c)||void 0));const d=l.before(l.depth-(s-1));n.replace(d,l.after(-r),new Ms(e,4-s,0));let h=-1;n.doc.nodesBetween(d,n.doc.content.size,((e,t)=>{if(h>-1)return!1;e.isTextblock&&0===e.content.size&&(h=t+1)})),h>-1&&n.setSelection(Si.near(n.doc.resolve(h))),n.scrollIntoView()}return!0}const p=c.pos===l.end()?h.contentMatchAt(0).defaultType:null,f={...Ed(u,h.type.name,h.attrs),...t},m={...Ed(u,l.node().type.name,l.node().attrs),...t};n.delete(l.pos,c.pos);const g=p?[{type:a,attrs:f},{type:p,attrs:m}]:[{type:a,attrs:f}];if(!Zr(n.doc,l.pos,2))return!1;if(r){const{selection:e,storedMarks:t}=s,{splittableMarks:o}=i.extensionManager,a=t||e.$to.parentOffset&&e.$from.marks();if(n.split(l.pos,2,g).scrollIntoView(),!a||!r)return!0;const c=a.filter((e=>o.includes(e.type.name)));n.ensureMarks(c)}return!0},toggleList:(e,t,n,s={})=>({editor:r,tr:i,state:o,dispatch:a,chain:l,commands:c,can:d})=>{const{extensions:h,splittableMarks:u}=r.extensionManager,p=Rc(e,o.schema),f=Rc(t,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:v}=m,b=y.blockRange(v),w=g||m.$to.parentOffset&&m.$from.marks();if(!b)return!1;const x=Sd((e=>Md(e.type.name,h)))(m);if(b.depth>=1&&x&&b.depth-x.depth<=1){if(x.node.type===p)return c.liftListItem(f);if(Md(x.node.type.name,h)&&p.validContent(x.node.content)&&a)return l().command((()=>(i.setNodeMarkup(x.pos,p),!0))).command((()=>Ad(i,p))).command((()=>Dd(i,p))).run()}return n&&w&&a?l().command((()=>{const e=d().wrapInList(p,s),t=w.filter((e=>u.includes(e.type.name)));return i.ensureMarks(t),!!e||c.clearNodes()})).wrapInList(p,s).command((()=>Ad(i,p))).command((()=>Dd(i,p))).run():l().command((()=>!!d().wrapInList(p,s)||c.clearNodes())).wrapInList(p,s).command((()=>Ad(i,p))).command((()=>Dd(i,p))).run()},toggleMark:(e,t={},n={})=>({state:s,commands:r})=>{const{extendEmptyMarkRange:i=!1}=n,o=cd(e,s.schema);return Nd(s,o,t)?r.unsetMark(o,{extendEmptyMarkRange:i}):r.setMark(o,t)},toggleNode:(e,t,n={})=>({state:s,commands:r})=>{const i=Rc(e,s.schema),o=Rc(t,s.schema),a=vd(s,i,n);let l;return s.selection.$anchor.sameParent(s.selection.$head)&&(l=s.selection.$anchor.parent.attrs),a?r.setNode(o,l):r.setNode(i,{...l,...n})},toggleWrap:(e,t={})=>({state:n,commands:s})=>{const r=Rc(e,n.schema);return vd(n,r,t)?s.lift(r):s.wrapIn(r,t)},undoInputRule:()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let s=0;s<n.length;s+=1){const r=n[s];let i;if(r.spec.isInputRules&&(i=r.getState(e))){if(t){const t=e.tr,n=i.transform;for(let e=n.steps.length-1;e>=0;e-=1)t.step(n.steps[e].invert(n.docs[e]));if(i.text){const n=t.doc.resolve(i.from).marks();t.replaceWith(i.from,i.to,e.schema.text(i.text,n))}else t.delete(i.from,i.to)}return!0}}return!1},unsetAllMarks:()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:s,ranges:r}=n;return s||t&&r.forEach((t=>{e.removeMark(t.$from.pos,t.$to.pos)})),!0},unsetMark:(e,t={})=>({tr:n,state:s,dispatch:r})=>{var i;const{extendEmptyMarkRange:o=!1}=t,{selection:a}=n,l=cd(e,s.schema),{$from:c,empty:d,ranges:h}=a;if(!r)return!0;if(d&&o){let{from:e,to:t}=a;const s=null===(i=c.marks().find((e=>e.type===l)))||void 0===i?void 0:i.attrs,r=ld(c,l,s);r&&(e=r.from,t=r.to),n.removeMark(e,t,l)}else h.forEach((e=>{n.removeMark(e.$from.pos,e.$to.pos,l)}));return n.removeStoredMark(l),!0},updateAttributes:(e,t={})=>({tr:n,state:s,dispatch:r})=>{let i=null,o=null;const a=bd("string"==typeof e?e:e.name,s.schema);return!!a&&("node"===a&&(i=Rc(e,s.schema)),"mark"===a&&(o=cd(e,s.schema)),r&&n.selection.ranges.forEach((e=>{const r=e.$from.pos,a=e.$to.pos;let l,c,d,h;n.selection.empty?s.doc.nodesBetween(r,a,((e,t)=>{i&&i===e.type&&(d=Math.max(t,r),h=Math.min(t+e.nodeSize,a),l=t,c=e)})):s.doc.nodesBetween(r,a,((e,s)=>{s<r&&i&&i===e.type&&(d=Math.max(s,r),h=Math.min(s+e.nodeSize,a),l=s,c=e),s>=r&&s<=a&&(i&&i===e.type&&n.setNodeMarkup(s,void 0,{...e.attrs,...t}),o&&e.marks.length&&e.marks.forEach((i=>{if(o===i.type){const l=Math.max(s,r),c=Math.min(s+e.nodeSize,a);n.addMark(l,c,o.create({...i.attrs,...t}))}})))})),c&&(void 0!==l&&n.setNodeMarkup(l,void 0,{...c.attrs,...t}),o&&c.marks.length&&c.marks.forEach((e=>{o===e.type&&n.addMark(d,h,o.create({...e.attrs,...t}))})))})),!0)},wrapIn:(e,t={})=>({state:n,dispatch:s})=>function(e,t=null){return function(n,s){let{$from:r,$to:i}=n.selection,o=r.blockRange(i),a=o&&Gr(o,e,t);return!!a&&(s&&s(n.tr.wrap(o,a).scrollIntoView()),!0)}}(Rc(e,n.schema),t)(n,s),wrapInList:(e,t={})=>({state:n,dispatch:s})=>Oc(Rc(e,n.schema),t)(n,s)});const Pd=td.create({name:"commands",addCommands:()=>({...Rd})}),Id=td.create({name:"drop",addProseMirrorPlugins(){return[new Li({key:new Fi("tiptapDrop"),props:{handleDrop:(e,t,n,s)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:n,moved:s})}}})]}}),$d=td.create({name:"editable",addProseMirrorPlugins(){return[new Li({key:new Fi("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Ld=td.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new Li({key:new Fi("focusEvents"),props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const s=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(s),!1},blur:(t,n)=>{e.isFocused=!1;const s=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(s),!1}}}})]}}),Bd=td.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first((({commands:e})=>[()=>e.undoInputRule(),()=>e.command((({tr:t})=>{const{selection:n,doc:s}=t,{empty:r,$anchor:i}=n,{pos:o,parent:a}=i,l=i.parent.isTextblock&&o>0?t.doc.resolve(o-1):i,c=l.parent.type.spec.isolating,d=i.pos-i.parentOffset,h=c&&1===l.parent.childCount?d===i.pos:bi.atStart(s).from===o;return!(!r||!a.type.isTextblock||a.textContent.length||!h||h&&"paragraph"===i.parent.type.name)&&e.clearNodes()})),()=>e.deleteSelection(),()=>e.joinBackward(),()=>e.selectNodeBackward()])),t=()=>this.editor.commands.first((({commands:e})=>[()=>e.deleteSelection(),()=>e.deleteCurrentNode(),()=>e.joinForward(),()=>e.selectNodeForward()])),n={Enter:()=>this.editor.commands.first((({commands:e})=>[()=>e.newlineInCode(),()=>e.createParagraphNear(),()=>e.liftEmptyBlock(),()=>e.splitBlock()])),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},s={...n},r={...n,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return pd()||yd()?r:s},addProseMirrorPlugins(){return[new Li({key:new Fi("clearDocument"),appendTransaction:(e,t,n)=>{const s=e.some((e=>e.docChanged))&&!t.doc.eq(n.doc),r=e.some((e=>e.getMeta("preventClearDocument")));if(!s||r)return;const{empty:i,from:o,to:a}=t.selection,l=bi.atStart(t.doc).from,c=bi.atEnd(t.doc).to;if(i||!(o===l&&a===c))return;if(!jd(n.doc))return;const d=n.tr,h=Nc({state:n,transaction:d}),{commands:u}=new Mc({editor:this.editor,state:h});return u.clearNodes(),d.steps.length?d:void 0}})]}}),zd=td.create({name:"paste",addProseMirrorPlugins(){return[new Li({key:new Fi("tiptapPaste"),props:{handlePaste:(e,t,n)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:n})}}})]}}),Fd=td.create({name:"tabindex",addProseMirrorPlugins(){return[new Li({key:new Fi("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class Hd{get name(){return this.node.type.name}constructor(e,t,n=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=t,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return null!==(e=this.actualDepth)&&void 0!==e?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,n=this.to;if(this.isBlock){if(0===this.content.size)return void console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);t=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:t,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(0===this.depth)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),t=this.resolvedPos.doc.resolve(e);return new Hd(t,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Hd(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Hd(e,this.editor)}get children(){const e=[];return this.node.content.forEach(((t,n)=>{const s=t.isBlock&&!t.isTextblock,r=t.isAtom&&!t.isText,i=this.pos+n+(r?0:1),o=this.resolvedPos.doc.resolve(i);if(!s&&o.depth<=this.depth)return;const a=new Hd(o,this.editor,s,s?t:null);s&&(a.actualDepth=this.depth+1),e.push(new Hd(o,this.editor,s,s?t:null))})),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let n=null,s=this.parent;for(;s&&!n;){if(s.node.type.name===e)if(Object.keys(t).length>0){const e=s.node.attrs,n=Object.keys(t);for(let s=0;s<n.length;s+=1){const r=n[s];if(e[r]!==t[r])break}}else n=s;s=s.parent}return n}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},n=!1){let s=[];if(!this.children||0===this.children.length)return s;const r=Object.keys(t);return this.children.forEach((i=>{if(!(n&&s.length>0)){if(i.node.type.name===e){r.every((e=>t[e]===i.node.attrs[e]))&&s.push(i)}n&&s.length>0||(s=s.concat(i.querySelectorAll(e,t,n)))}})),s}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}}class Vd extends jc{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:e})=>{throw e},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",(({event:e,slice:t,moved:n})=>this.options.onDrop(e,t,n))),this.on("paste",(({event:e,slice:t})=>this.options.onPaste(e,t))),window.setTimeout((()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)}),0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=function(e,t){const n=document.querySelector("style[data-tiptap-style]");if(null!==n)return n;const s=document.createElement("style");return t&&s.setAttribute("nonce",t),s.setAttribute("data-tiptap-style",""),s.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(s),s}('.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 0 !important;\n  height: 0 !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}\n\n.tippy-box[data-animation=fade][data-state=hidden] {\n  opacity: 0\n}',this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const n=$c(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:n});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const t=this.state.plugins;let n=t;if([].concat(e).forEach((e=>{const s="string"==typeof e?`${e}$`:e.key;n=t.filter((e=>!e.key.startsWith(s)))})),t.length===n.length)return;const s=this.state.reconfigure({plugins:n});return this.view.updateState(s),s}createExtensionManager(){var e,t;const n=[...this.options.enableCoreExtensions?[$d,rd.configure({blockSeparator:null===(t=null===(e=this.options.coreExtensionOptions)||void 0===e?void 0:e.clipboardTextSerializer)||void 0===t?void 0:t.blockSeparator}),Pd,Ld,Bd,Fd,Id,zd].filter((e=>"object"!=typeof this.options.enableCoreExtensions||!1!==this.options.enableCoreExtensions[e.name])):[],...this.options.extensions].filter((e=>["extension","node","mark"].includes(null==e?void 0:e.type)));this.extensionManager=new ed(n,this)}createCommandManager(){this.commandManager=new Mc({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let t;try{t=xd(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(tm){if(!(tm instanceof Error&&["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(tm.message)))throw tm;this.emit("contentError",{editor:this,error:tm,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter((e=>"collaboration"!==e.name)),this.createExtensionManager()}}),t=xd(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const n=ud(t,this.options.autofocus);this.view=new Ql(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...null===(e=this.options.editorProps)||void 0===e?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:Ii.create({doc:t,selection:n||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();this.view.dom.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction)return this.capturedTransaction?void e.steps.forEach((e=>{var t;return null===(t=this.capturedTransaction)||void 0===t?void 0:t.step(e)})):void(this.capturedTransaction=e);const t=this.state.apply(e),n=!this.state.selection.eq(t.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:t}),this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),n&&this.emit("selectionUpdate",{editor:this,transaction:e});const s=e.getMeta("focus"),r=e.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:e}),r&&this.emit("blur",{editor:this,event:r.event,transaction:e}),e.docChanged&&!e.getMeta("preventUpdate")&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return Cd(this.state,e)}isActive(e,t){const n="string"==typeof e?e:null,s="string"==typeof e?t:e;return function(e,t,n={}){if(!t)return vd(e,null,n)||Nd(e,null,n);const s=bd(t,e.schema);return"node"===s?vd(e,t,n):"mark"===s&&Nd(e,t,n)}(this.state,n,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Vc(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t="\n\n",textSerializers:n={}}=e||{};return function(e,t){return nd(e,{from:0,to:e.content.size},t)}(this.state.doc,{blockSeparator:t,textSerializers:{...sd(this.schema),...n}})}get isEmpty(){return jd(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(null===(e=this.view)||void 0===e?void 0:e.docView)}$node(e,t){var n;return(null===(n=this.$doc)||void 0===n?void 0:n.querySelector(e,t))||null}$nodes(e,t){var n;return(null===(n=this.$doc)||void 0===n?void 0:n.querySelectorAll(e,t))||null}$pos(e){const t=this.state.doc.resolve(e);return new Hd(t,this)}get $doc(){return this.$pos(0)}}function Ud(e){return new qc({find:e.find,handler:({state:t,range:n,match:s})=>{const r=Lc(e.getAttributes,void 0,s);if(!1===r||null===r)return null;const{tr:i}=t,o=s[s.length-1],a=s[0];if(o){const s=a.search(/\S/),l=n.from+a.indexOf(o),c=l+o.length;if(Od(n.from,n.to,t.doc).filter((t=>t.mark.type.excluded.find((n=>n===e.type&&n!==t.mark.type)))).filter((e=>e.to>l)).length)return null;c<n.to&&i.delete(c,n.to),l>n.from&&i.delete(n.from+s,l);const d=n.from+s+o.length;i.addMark(n.from+s,d,e.type.create(r||{})),i.removeStoredMark(e.type)}}})}function qd(e){return new qc({find:e.find,handler:({state:t,range:n,match:s})=>{const r=t.doc.resolve(n.from),i=Lc(e.getAttributes,void 0,s)||{};if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),e.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,e.type,i)}})}function Wd(e){return new qc({find:e.find,handler:({state:t,range:n,match:s,chain:r})=>{const i=Lc(e.getAttributes,void 0,s)||{},o=t.tr.delete(n.from,n.to),a=o.doc.resolve(n.from).blockRange(),l=a&&Gr(a,e.type,i);if(!l)return null;if(o.wrap(a,l),e.keepMarks&&e.editor){const{selection:n,storedMarks:s}=t,{splittableMarks:r}=e.editor.extensionManager,i=s||n.$to.parentOffset&&n.$from.marks();if(i){const e=i.filter((e=>r.includes(e.type.name)));o.ensureMarks(e)}}if(e.keepAttributes){const t="bulletList"===e.type.name||"orderedList"===e.type.name?"listItem":"taskList";r().updateAttributes(t,i).run()}const c=o.doc.resolve(n.from-1).nodeBefore;c&&c.type===e.type&&ei(o.doc,n.from-1)&&(!e.joinPredicate||e.joinPredicate(s,c))&&o.join(n.from-1)}})}class Jd{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Lc(_c(this,"addOptions",{name:this.name}))),this.storage=Lc(_c(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Jd(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Gc(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new Jd(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=Lc(_c(t,"addOptions",{name:t.name})),t.storage=Lc(_c(t,"addStorage",{name:t.name,options:t.options})),t}}function Kd(e){return new Yc({find:e.find,handler:({state:t,range:n,match:s,pasteEvent:r})=>{const i=Lc(e.getAttributes,void 0,s,r);if(!1===i||null===i)return null;const{tr:o}=t,a=s[s.length-1],l=s[0];let c=n.to;if(a){const s=l.search(/\S/),r=n.from+l.indexOf(a),d=r+a.length;if(Od(n.from,n.to,t.doc).filter((t=>t.mark.type.excluded.find((n=>n===e.type&&n!==t.mark.type)))).filter((e=>e.to>r)).length)return null;d<n.to&&o.delete(d,n.to),r>n.from&&o.delete(n.from+s,r),c=n.from+s+a.length,o.addMark(n.from+s,c,e.type.create(i||{})),o.removeStoredMark(e.type)}}})}function Gd(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Xd,Yd={exports:{}},Qd={};Yd.exports=function(){if(Xd)return Qd;Xd=1;var e=r,t="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=e.useState,s=e.useEffect,i=e.useLayoutEffect,o=e.useDebugValue;function a(e){var n=e.getSnapshot;e=e.value;try{var s=n();return!t(e,s)}catch(r){return!0}}var l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),l=n({inst:{value:r,getSnapshot:t}}),c=l[0].inst,d=l[1];return i((function(){c.value=r,c.getSnapshot=t,a(c)&&d({inst:c})}),[e,r,t]),s((function(){return a(c)&&d({inst:c}),e((function(){a(c)&&d({inst:c})}))}),[e]),o(r),r};return Qd.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:l,Qd}();var Zd=Yd.exports;const eh=(...e)=>t=>{e.forEach((e=>{"function"==typeof e?e(t):e&&(e.current=t)}))},th=({contentComponent:e})=>{const t=Zd.useSyncExternalStore(e.subscribe,e.getSnapshot,e.getServerSnapshot);return r.createElement(r.Fragment,null,Object.values(t))};class nh extends r.Component{constructor(e){var t;super(e),this.editorContentRef=r.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:Boolean(null===(t=e.editor)||void 0===t?void 0:t.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const e=this.props.editor;if(e&&!e.isDestroyed&&e.options.element){if(e.contentComponent)return;const t=this.editorContentRef.current;t.append(...e.options.element.childNodes),e.setOptions({element:t}),e.contentComponent=function(){const e=new Set;let t={};return{subscribe:t=>(e.add(t),()=>{e.delete(t)}),getSnapshot:()=>t,getServerSnapshot:()=>t,setRenderer(n,s){t={...t,[n]:i.createPortal(s.reactElement,s.element,n)},e.forEach((e=>e()))},removeRenderer(n){const s={...t};delete s[n],t=s,e.forEach((e=>e()))}}}(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe((()=>{this.setState((e=>e.hasContentComponentInitialized?e:{hasContentComponentInitialized:!0})),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()}))),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){const e=this.props.editor;if(!e)return;if(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null,!e.options.element.firstChild)return;const t=document.createElement("div");t.append(...e.options.element.childNodes),e.setOptions({element:t})}render(){const{editor:e,innerRef:t,...n}=this.props;return r.createElement(r.Fragment,null,r.createElement("div",{ref:eh(t,this.editorContentRef),...n}),(null==e?void 0:e.contentComponent)&&r.createElement(th,{contentComponent:e.contentComponent}))}}const sh=e.forwardRef(((e,t)=>{const n=r.useMemo((()=>Math.floor(4294967295*Math.random()).toString()),[e.editor]);return r.createElement(nh,{key:n,innerRef:t,...e})})),rh=r.memo(sh);var ih,oh=Gd((function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var s,r,i;if(Array.isArray(t)){if((s=t.length)!=n.length)return!1;for(r=s;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(t instanceof Map&&n instanceof Map){if(t.size!==n.size)return!1;for(r of t.entries())if(!n.has(r[0]))return!1;for(r of t.entries())if(!e(r[1],n.get(r[0])))return!1;return!0}if(t instanceof Set&&n instanceof Set){if(t.size!==n.size)return!1;for(r of t.entries())if(!n.has(r[0]))return!1;return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(n)){if((s=t.length)!=n.length)return!1;for(r=s;0!=r--;)if(t[r]!==n[r])return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((s=(i=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(r=s;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,i[r]))return!1;for(r=s;0!=r--;){var o=i[r];if(("_owner"!==o||!t.$$typeof)&&!e(t[o],n[o]))return!1}return!0}return t!=t&&n!=n})),ah={exports:{}},lh={};ah.exports=function(){if(ih)return lh;ih=1;var e=r,t=Zd,n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=t.useSyncExternalStore,i=e.useRef,o=e.useEffect,a=e.useMemo,l=e.useDebugValue;return lh.useSyncExternalStoreWithSelector=function(e,t,r,c,d){var h=i(null);if(null===h.current){var u={hasValue:!1,value:null};h.current=u}else u=h.current;h=a((function(){function e(e){if(!o){if(o=!0,s=e,e=c(e),void 0!==d&&u.hasValue){var t=u.value;if(d(t,e))return i=t}return i=e}if(t=i,n(s,e))return t;var r=c(e);return void 0!==d&&d(t,r)?t:(s=e,i=r)}var s,i,o=!1,a=void 0===r?null:r;return[function(){return e(t())},null===a?void 0:function(){return e(a())}]}),[t,r,c,d]);var p=s(e,h[0],h[1]);return o((function(){u.hasValue=!0,u.value=p}),[p]),l(p),p},lh}();var ch=ah.exports;class dh{constructor(e){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=e,this.lastSnapshot={editor:e,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber||(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber}),this.lastSnapshot}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}watch(e){if(this.editor=e,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach((e=>e()))},t=this.editor;return t.on("transaction",e),()=>{t.off("transaction",e)}}}}const hh="undefined"==typeof window,uh=hh||Boolean("undefined"!=typeof window&&window.next);class ph{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach((e=>e()))}getInitialEditor(){return void 0===this.options.current.immediatelyRender?hh||uh?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...e)=>{var t,n;return null===(n=(t=this.options.current).onBeforeCreate)||void 0===n?void 0:n.call(t,...e)},onBlur:(...e)=>{var t,n;return null===(n=(t=this.options.current).onBlur)||void 0===n?void 0:n.call(t,...e)},onCreate:(...e)=>{var t,n;return null===(n=(t=this.options.current).onCreate)||void 0===n?void 0:n.call(t,...e)},onDestroy:(...e)=>{var t,n;return null===(n=(t=this.options.current).onDestroy)||void 0===n?void 0:n.call(t,...e)},onFocus:(...e)=>{var t,n;return null===(n=(t=this.options.current).onFocus)||void 0===n?void 0:n.call(t,...e)},onSelectionUpdate:(...e)=>{var t,n;return null===(n=(t=this.options.current).onSelectionUpdate)||void 0===n?void 0:n.call(t,...e)},onTransaction:(...e)=>{var t,n;return null===(n=(t=this.options.current).onTransaction)||void 0===n?void 0:n.call(t,...e)},onUpdate:(...e)=>{var t,n;return null===(n=(t=this.options.current).onUpdate)||void 0===n?void 0:n.call(t,...e)},onContentError:(...e)=>{var t,n;return null===(n=(t=this.options.current).onContentError)||void 0===n?void 0:n.call(t,...e)},onDrop:(...e)=>{var t,n;return null===(n=(t=this.options.current).onDrop)||void 0===n?void 0:n.call(t,...e)},onPaste:(...e)=>{var t,n;return null===(n=(t=this.options.current).onPaste)||void 0===n?void 0:n.call(t,...e)}};return new Vd(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&0===e.length?this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(null===this.previousDeps)return void(this.previousDeps=e);if(this.previousDeps.length===e.length&&this.previousDeps.every(((t,n)=>t===e[n])))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,t=this.editor;this.scheduledDestructionTimeout=setTimeout((()=>{this.isComponentMounted&&this.instanceId===e?t&&t.setOptions(this.options.current):t&&!t.isDestroyed&&(t.destroy(),this.instanceId===e&&this.setEditor(null))}),1)}}function fh(t={},n=[]){const s=e.useRef(t);s.current=t;const[r]=e.useState((()=>new ph(s))),i=Zd.useSyncExternalStore(r.subscribe,r.getEditor,r.getServerSnapshot);return e.useDebugValue(i),e.useEffect(r.onRender(n)),function(t){var n;const[s]=e.useState((()=>new dh(t.editor))),r=ch.useSyncExternalStoreWithSelector(s.subscribe,s.getSnapshot,s.getServerSnapshot,t.selector,null!==(n=t.equalityFn)&&void 0!==n?n:oh);e.useLayoutEffect((()=>s.watch(t.editor)),[t.editor,s]),e.useDebugValue(r)}({editor:i,selector:({transactionNumber:e})=>!1===t.shouldRerenderOnTransaction?null:t.immediatelyRender&&0===e?0:e+1}),i}e.createContext({editor:null}).Consumer;const mh=e.createContext({onDragStart:void 0});r.forwardRef(((t,n)=>{const{onDragStart:s}=e.useContext(mh),i=t.as||"div";return r.createElement(i,{...t,ref:n,"data-node-view-wrapper":"",onDragStart:s,style:{whiteSpace:"normal",...t.style}})}));const gh=/^\s*>\s$/,yh=Jd.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes:e}){return["blockquote",Pc(this.options.HTMLAttributes,e),0]},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Wd({find:gh,type:this.type})]}}),vh=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,bh=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,wh=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,xh=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,kh=Xc.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!==e.style.fontWeight&&null},{style:"font-weight=400",clearMark:e=>e.type.name===this.name},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}]},renderHTML({HTMLAttributes:e}){return["strong",Pc(this.options.HTMLAttributes,e),0]},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Ud({find:vh,type:this.type}),Ud({find:wh,type:this.type})]},addPasteRules(){return[Kd({find:bh,type:this.type}),Kd({find:xh,type:this.type})]}}),Sh="textStyle",Ch=/^\s*([-+*])\s$/,Th=Jd.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes:e}){return["ul",Pc(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleBulletList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(Sh)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let e=Wd({find:Ch,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=Wd({find:Ch,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Sh),editor:this.editor})),[e]}}),Oh=/(?:^|\s)(`(?!\s+`)((?:[^`]+))`(?!\s+`))$/,Eh=/(?:^|\s)(`(?!\s+`)((?:[^`]+))`(?!\s+`))/g,Nh=Xc.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:e}){return["code",Pc(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Ud({find:Oh,type:this.type})]},addPasteRules(){return[Kd({find:Eh,type:this.type})]}}),Mh=/^```([a-z]+)?[\s\n]$/,jh=/^~~~([a-z]+)?[\s\n]$/,_h=Jd.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:e=>{var t;const{languageClassPrefix:n}=this.options,s=[...(null===(t=e.firstElementChild)||void 0===t?void 0:t.classList)||[]].filter((e=>e.startsWith(n))).map((e=>e.replace(n,"")))[0];return s||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node:e,HTMLAttributes:t}){return["pre",Pc(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,n=1===t.pos;return!(!e||t.parent.type.name!==this.name)&&(!(!n&&t.parent.textContent.length)&&this.editor.commands.clearNodes())},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:n}=t,{$from:s,empty:r}=n;if(!r||s.parent.type!==this.type)return!1;const i=s.parentOffset===s.parent.nodeSize-2,o=s.parent.textContent.endsWith("\n\n");return!(!i||!o)&&e.chain().command((({tr:e})=>(e.delete(s.pos-2,s.pos),!0))).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:n,doc:s}=t,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;if(!(r.parentOffset===r.parent.nodeSize-2))return!1;const o=r.after();if(void 0===o)return!1;return s.nodeAt(o)?e.commands.command((({tr:e})=>(e.setSelection(bi.near(s.resolve(o))),!0))):e.commands.exitCode()}}},addInputRules(){return[qd({find:Mh,type:this.type,getAttributes:e=>({language:e[1]})}),qd({find:jh,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new Li({key:new Fi("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData)return!1;if(this.editor.isActive(this.type.name))return!1;const n=t.clipboardData.getData("text/plain"),s=t.clipboardData.getData("vscode-editor-data"),r=s?JSON.parse(s):void 0,i=null==r?void 0:r.mode;if(!n||!i)return!1;const{tr:o,schema:a}=e.state,l=a.text(n.replace(/\r\n?/g,"\n"));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(Si.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),e.dispatch(o),!0}}})]}}),Ah=Jd.create({name:"doc",topNode:!0,content:"block+"});function Dh(e={}){return new Li({view:t=>new Rh(t,e)})}class Rh{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(n=t.width)&&void 0!==n?n:1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map((t=>{let n=e=>{this[t](e)};return e.dom.addEventListener(t,n),{name:t,handler:n}}))}destroy(){this.handlers.forEach((({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t)))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos),n=!t.parent.inlineContent;if(n){let n=t.nodeBefore,s=t.nodeAfter;if(n||s){let t=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0));if(t){let r=t.getBoundingClientRect(),i=n?r.bottom:r.top;n&&s&&(i=(i+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),e={left:r.left,right:r.right,top:i-this.width/2,bottom:i+this.width/2}}}}if(!e){let t=this.editorView.coordsAtPos(this.cursorPos);e={left:t.left-this.width/2,right:t.left+this.width/2,top:t.top,bottom:t.bottom}}let s,r,i=this.editorView.dom.offsetParent;if(this.element||(this.element=i.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!i||i==document.body&&"static"==getComputedStyle(i).position)s=-pageXOffset,r=-pageYOffset;else{let e=i.getBoundingClientRect();s=e.left-i.scrollLeft,r=e.top-i.scrollTop}this.element.style.left=e.left-s+"px",this.element.style.top=e.top-r+"px",this.element.style.width=e.right-e.left+"px",this.element.style.height=e.bottom-e.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),s=n&&n.type.spec.disableDropCursor,r="function"==typeof s?s(this.editorView,t,e):s;if(t&&!r){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let t=si(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=t&&(e=t)}this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const Ph=td.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[Dh(this.options)]}});class Ih extends bi{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return Ih.valid(n)?new Ih(n):bi.near(n)}content(){return Ms.empty}eq(e){return e instanceof Ih&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new Ih(e.resolve(t.pos))}getBookmark(){return new $h(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),s=e.node(t);if(0!=n)for(let e=s.child(n-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(s.type.spec.isolating)return!0}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),s=e.node(t);if(n!=s.childCount)for(let e=s.child(n);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(s.type.spec.isolating)return!0}return!0}(e))return!1;let n=t.type.spec.allowGapCursor;if(null!=n)return n;let s=t.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,t,n=!1){e:for(;;){if(!n&&Ih.valid(e))return e;let s=e.pos,r=null;for(let n=e.depth;;n--){let i=e.node(n);if(t>0?e.indexAfter(n)<i.childCount:e.index(n)>0){r=i.child(t>0?e.indexAfter(n):e.index(n)-1);break}if(0==n)return null;s+=t;let o=e.doc.resolve(s);if(Ih.valid(o))return o}for(;;){let i=t>0?r.firstChild:r.lastChild;if(!i){if(r.isAtom&&!r.isText&&!Ti.isSelectable(r)){e=e.doc.resolve(s+r.nodeSize*t),n=!1;continue e}break}r=i,s+=t;let o=e.doc.resolve(s);if(Ih.valid(o))return o}return null}}}Ih.prototype.visible=!1,Ih.findFrom=Ih.findGapCursorFrom,bi.jsonID("gapcursor",Ih);class $h{constructor(e){this.pos=e}map(e){return new $h(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return Ih.valid(t)?new Ih(t):bi.near(t)}}const Lh=pc({ArrowLeft:Bh("horiz",-1),ArrowRight:Bh("horiz",1),ArrowUp:Bh("vert",-1),ArrowDown:Bh("vert",1)});function Bh(e,t){const n="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,s,r){let i=e.selection,o=t>0?i.$to:i.$from,a=i.empty;if(i instanceof Si){if(!r.endOfTextblock(n)||0==o.depth)return!1;a=!1,o=e.doc.resolve(t>0?o.after():o.before())}let l=Ih.findGapCursorFrom(o,t,a);return!!l&&(s&&s(e.tr.setSelection(new Ih(l))),!0)}}function zh(e,t,n){if(!e||!e.editable)return!1;let s=e.state.doc.resolve(t);if(!Ih.valid(s))return!1;let r=e.posAtCoords({left:n.clientX,top:n.clientY});return!(r&&r.inside>-1&&Ti.isSelectable(e.state.doc.nodeAt(r.inside)))&&(e.dispatch(e.state.tr.setSelection(new Ih(s))),!0)}function Fh(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof Ih))return!1;let{$from:n}=e.state.selection,s=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!s)return!1;let r=Ss.empty;for(let o=s.length-1;o>=0;o--)r=Ss.from(s[o].createAndFill(null,r));let i=e.state.tr.replace(n.pos,n.pos,new Ms(r,0,0));return i.setSelection(Si.near(i.doc.resolve(n.pos+1))),e.dispatch(i),!1}function Hh(e){if(!(e.selection instanceof Ih))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",El.create(e.doc,[Cl.widget(e.selection.head,t,{key:"gapcursor"})])}const Vh=td.create({name:"gapCursor",addProseMirrorPlugins:()=>[new Li({props:{decorations:Hh,createSelectionBetween:(e,t,n)=>t.pos==n.pos&&Ih.valid(n)?new Ih(n):null,handleClick:zh,handleKeyDown:Lh,handleDOMEvents:{beforeinput:Fh}}})],extendNodeSchema(e){var t;return{allowGapCursor:null!==(t=Lc(_c(e,"allowGapCursor",{name:e.name,options:e.options,storage:e.storage})))&&void 0!==t?t:null}}}),Uh=Jd.create({name:"hardBreak",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:e}){return["br",Pc(this.options.HTMLAttributes,e)]},renderText:()=>"\n",addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:s})=>e.first([()=>e.exitCode(),()=>e.command((()=>{const{selection:e,storedMarks:r}=n;if(e.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:o}=s.extensionManager,a=r||e.$to.parentOffset&&e.$from.marks();return t().insertContent({type:this.name}).command((({tr:e,dispatch:t})=>{if(t&&a&&i){const t=a.filter((e=>o.includes(e.type.name)));e.ensureMarks(t)}return!0})).run()}))])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),qh=Jd.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map((e=>({tag:`h${e}`,attrs:{level:e}})))},renderHTML({node:e,HTMLAttributes:t}){return[`h${this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]}`,Pc(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.setNode(this.name,e),toggleHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return this.options.levels.reduce(((e,t)=>({...e,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})})),{})},addInputRules(){return this.options.levels.map((e=>qd({find:new RegExp(`^(#{1,${e}})\\s$`),type:this.type,getAttributes:{level:e}})))}});var Wh=200,Jh=function(){};Jh.prototype.append=function(e){return e.length?(e=Jh.from(e),!this.length&&e||e.length<Wh&&this.leafAppend(e)||this.length<Wh&&e.leafPrepend(this)||this.appendInner(e)):this},Jh.prototype.prepend=function(e){return e.length?Jh.from(e).append(this):this},Jh.prototype.appendInner=function(e){return new Gh(this,e)},Jh.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),e>=t?Jh.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},Jh.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},Jh.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},Jh.prototype.map=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length);var s=[];return this.forEach((function(t,n){return s.push(e(t,n))}),t,n),s},Jh.from=function(e){return e instanceof Jh?e:e&&e.length?new Kh(e):Jh.empty};var Kh=function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,n){return 0==e&&n==this.length?this:new t(this.values.slice(e,n))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,n,s){for(var r=t;r<n;r++)if(!1===e(this.values[r],s+r))return!1},t.prototype.forEachInvertedInner=function(e,t,n,s){for(var r=t-1;r>=n;r--)if(!1===e(this.values[r],s+r))return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=Wh)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=Wh)return new t(e.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(Jh);Jh.empty=new Kh([]);var Gh=function(e){function t(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,n,s){var r=this.left.length;return!(t<r&&!1===this.left.forEachInner(e,t,Math.min(n,r),s))&&(!(n>r&&!1===this.right.forEachInner(e,Math.max(t-r,0),Math.min(this.length,n)-r,s+r))&&void 0)},t.prototype.forEachInvertedInner=function(e,t,n,s){var r=this.left.length;return!(t>r&&!1===this.right.forEachInvertedInner(e,t-r,Math.max(n,r)-r,s+r))&&(!(n<r&&!1===this.left.forEachInvertedInner(e,Math.min(t,r),n,s))&&void 0)},t.prototype.sliceInner=function(e,t){if(0==e&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},t.prototype.leafAppend=function(e){var n=this.right.leafAppend(e);if(n)return new t(this.left,n)},t.prototype.leafPrepend=function(e){var n=this.left.leafPrepend(e);if(n)return new t(n,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}(Jh);class Xh{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(0==this.eventCount)return null;let n,s,r=this.items.length;for(;;r--){if(this.items.get(r-1).selection){--r;break}}t&&(n=this.remapping(r,this.items.length),s=n.maps.length);let i,o,a=e.tr,l=[],c=[];return this.items.forEach(((e,t)=>{if(!e.step)return n||(n=this.remapping(r,t+1),s=n.maps.length),s--,void c.push(e);if(n){c.push(new Yh(e.map));let t,r=e.step.map(n.slice(s));r&&a.maybeStep(r).doc&&(t=a.mapping.maps[a.mapping.maps.length-1],l.push(new Yh(t,void 0,void 0,l.length+c.length))),s--,t&&n.appendMap(t,s)}else a.maybeStep(e.step);return e.selection?(i=n?e.selection.map(n.slice(s)):e.selection,o=new Xh(this.items.slice(0,r).append(c.reverse().concat(l)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining:o,transform:a,selection:i}}addTransform(e,t,n,s){let r=[],i=this.eventCount,o=this.items,a=!s&&o.length?o.get(o.length-1):null;for(let c=0;c<e.steps.length;c++){let n,l=e.steps[c].invert(e.docs[c]),d=new Yh(e.mapping.maps[c],l,t);(n=a&&a.merge(d))&&(d=n,c?r.pop():o=o.slice(0,o.length-1)),r.push(d),t&&(i++,t=void 0),s||(a=d)}let l=i-n.depth;return l>Zh&&(o=function(e,t){let n;return e.forEach(((e,s)=>{if(e.selection&&0==t--)return n=s,!1})),e.slice(n)}(o,l),i-=l),new Xh(o.append(r),i)}remapping(e,t){let n=new Rr;return this.items.forEach(((t,s)=>{let r=null!=t.mirrorOffset&&s-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,r)}),e,t),n}addMaps(e){return 0==this.eventCount?this:new Xh(this.items.append(e.map((e=>new Yh(e)))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],s=Math.max(0,this.items.length-t),r=e.mapping,i=e.steps.length,o=this.eventCount;this.items.forEach((e=>{e.selection&&o--}),s);let a=t;this.items.forEach((t=>{let s=r.getMirror(--a);if(null==s)return;i=Math.min(i,s);let l=r.maps[s];if(t.step){let i=e.steps[s].invert(e.docs[s]),c=t.selection&&t.selection.map(r.slice(a+1,s));c&&o++,n.push(new Yh(l,i,c))}else n.push(new Yh(l))}),s);let l=[];for(let h=t;h<i;h++)l.push(new Yh(r.maps[h]));let c=this.items.slice(0,s).append(l).append(n),d=new Xh(c,o);return d.emptyItemCount()>500&&(d=d.compress(this.items.length-n.length)),d}emptyItemCount(){let e=0;return this.items.forEach((t=>{t.step||e++})),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,s=[],r=0;return this.items.forEach(((i,o)=>{if(o>=e)s.push(i),i.selection&&r++;else if(i.step){let e=i.step.map(t.slice(n)),o=e&&e.getMap();if(n--,o&&t.appendMap(o,n),e){let a=i.selection&&i.selection.map(t.slice(n));a&&r++;let l,c=new Yh(o.invert(),e,a),d=s.length-1;(l=s.length&&s[d].merge(c))?s[d]=l:s.push(c)}}else i.map&&n--}),this.items.length,0),new Xh(Jh.from(s.reverse()),r)}}Xh.empty=new Xh(Jh.empty,0);class Yh{constructor(e,t,n,s){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new Yh(t.getMap().invert(),t,this.selection)}}}class Qh{constructor(e,t,n,s,r){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=s,this.prevComposition=r}}const Zh=20;function eu(e){let t=[];for(let n=e.length-1;n>=0&&0==t.length;n--)e[n].forEach(((e,n,s,r)=>t.push(s,r)));return t}function tu(e,t){if(!e)return null;let n=[];for(let s=0;s<e.length;s+=2){let r=t.map(e[s],1),i=t.map(e[s+1],-1);r<=i&&n.push(r,i)}return n}let nu=!1,su=null;function ru(e){let t=e.plugins;if(su!=t){nu=!1,su=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){nu=!0;break}}return nu}const iu=new Fi("history"),ou=new Fi("closeHistory");function au(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new Li({key:iu,state:{init:()=>new Qh(Xh.empty,Xh.empty,null,0,-1),apply:(t,n,s)=>function(e,t,n,s){let r,i=n.getMeta(iu);if(i)return i.historyState;n.getMeta(ou)&&(e=new Qh(e.done,e.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(o&&o.getMeta(iu))return o.getMeta(iu).redo?new Qh(e.done.addTransform(n,void 0,s,ru(t)),e.undone,eu(n.mapping.maps),e.prevTime,e.prevComposition):new Qh(e.done,e.undone.addTransform(n,void 0,s,ru(t)),null,e.prevTime,e.prevComposition);if(!1===n.getMeta("addToHistory")||o&&!1===o.getMeta("addToHistory"))return(r=n.getMeta("rebased"))?new Qh(e.done.rebased(n,r),e.undone.rebased(n,r),tu(e.prevRanges,n.mapping),e.prevTime,e.prevComposition):new Qh(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),tu(e.prevRanges,n.mapping),e.prevTime,e.prevComposition);{let r=n.getMeta("composition"),i=0==e.prevTime||!o&&e.prevComposition!=r&&(e.prevTime<(n.time||0)-s.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach(((e,s)=>{for(let r=0;r<t.length;r+=2)e<=t[r+1]&&s>=t[r]&&(n=!0)})),n}(n,e.prevRanges)),a=o?tu(e.prevRanges,n.mapping):eu(n.mapping.maps);return new Qh(e.done.addTransform(n,i?t.selection.getBookmark():void 0,s,ru(t)),Xh.empty,a,n.time,null==r?e.prevComposition:r)}}(n,s,t,e)},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,s="historyUndo"==n?cu:"historyRedo"==n?du:null;return!!s&&(t.preventDefault(),s(e.state,e.dispatch))}}}})}function lu(e,t){return(n,s)=>{let r=iu.getState(n);if(!r||0==(e?r.undone:r.done).eventCount)return!1;if(s){let i=function(e,t,n){let s=ru(t),r=iu.get(t).spec.config,i=(n?e.undone:e.done).popEvent(t,s);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?e.done:e.undone).addTransform(i.transform,t.selection.getBookmark(),r,s),l=new Qh(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(iu,{redo:n,historyState:l})}(r,n,e);i&&s(t?i.scrollIntoView():i)}return!0}}const cu=lu(!1,!0),du=lu(!0,!0),hu=td.create({name:"history",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:e,dispatch:t})=>cu(e,t),redo:()=>({state:e,dispatch:t})=>du(e,t)}),addProseMirrorPlugins(){return[au(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),uu=Jd.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{}}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes:e}){return["hr",Pc(this.options.HTMLAttributes,e)]},addCommands(){return{setHorizontalRule:()=>({chain:e,state:t})=>{const{selection:n}=t,{$from:s,$to:r}=n,i=e();return 0===s.parentOffset?i.insertContentAt({from:Math.max(s.pos-1,0),to:r.pos},{type:this.name}):n instanceof Ti?i.insertContentAt(r.pos,{type:this.name}):i.insertContent({type:this.name}),i.command((({tr:e,dispatch:t})=>{var n;if(t){const{$to:t}=e.selection,s=t.end();if(t.nodeAfter)t.nodeAfter.isTextblock?e.setSelection(Si.create(e.doc,t.pos+1)):t.nodeAfter.isBlock?e.setSelection(Ti.create(e.doc,t.pos)):e.setSelection(Si.create(e.doc,t.pos));else{const r=null===(n=t.parent.type.contentMatch.defaultType)||void 0===n?void 0:n.create();r&&(e.insert(s,r),e.setSelection(Si.create(e.doc,s+1)))}e.scrollIntoView()}return!0})).run()}}},addInputRules(){return[(e={find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type},new qc({find:e.find,handler:({state:t,range:n,match:s})=>{const r=Lc(e.getAttributes,void 0,s)||{},{tr:i}=t,o=n.from;let a=n.to;const l=e.type.create(r);if(s[1]){let e=o+s[0].lastIndexOf(s[1]);e>a?e=a:a=e+s[1].length;const t=s[0][s[0].length-1];i.insertText(t,o+s[0].length-1),i.replaceWith(e,a,l)}else if(s[0]){const t=e.type.isInline?o:o-1;i.insert(t,e.type.create(r)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()}}))];var e}}),pu=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,fu=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,mu=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,gu=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,yu=Xc.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:e=>"normal"!==e.style.fontStyle&&null},{style:"font-style=normal",clearMark:e=>e.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:e}){return["em",Pc(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Ud({find:pu,type:this.type}),Ud({find:mu,type:this.type})]},addPasteRules(){return[Kd({find:fu,type:this.type}),Kd({find:gu,type:this.type})]}}),vu=Jd.create({name:"listItem",addOptions:()=>({HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:e}){return["li",Pc(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),bu="textStyle",wu=/^(\d+)\.\s$/,xu=Jd.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1},type:{default:void 0,parseHTML:e=>e.getAttribute("type")}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes:e}){const{start:t,...n}=e;return 1===t?["ol",Pc(this.options.HTMLAttributes,n),0]:["ol",Pc(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleOrderedList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(bu)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let e=Wd({find:wu,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(e=Wd({find:wu,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(bu)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[e]}}),ku=Jd.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:e}){return["p",Pc(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Su=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Cu=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Tu=Xc.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>!!e.includes("line-through")&&{}}],renderHTML({HTMLAttributes:e}){return["s",Pc(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Ud({find:Su,type:this.type})]},addPasteRules(){return[Kd({find:Cu,type:this.type})]}}),Ou=Jd.create({name:"text",group:"inline"}),Eu=td.create({name:"starterKit",addExtensions(){var e,t,n,s,r,i,o,a,l,c,d,h,u,p,f,m,g,y;const v=[];return!1!==this.options.bold&&v.push(kh.configure(null===(e=this.options)||void 0===e?void 0:e.bold)),!1!==this.options.blockquote&&v.push(yh.configure(null===(t=this.options)||void 0===t?void 0:t.blockquote)),!1!==this.options.bulletList&&v.push(Th.configure(null===(n=this.options)||void 0===n?void 0:n.bulletList)),!1!==this.options.code&&v.push(Nh.configure(null===(s=this.options)||void 0===s?void 0:s.code)),!1!==this.options.codeBlock&&v.push(_h.configure(null===(r=this.options)||void 0===r?void 0:r.codeBlock)),!1!==this.options.document&&v.push(Ah.configure(null===(i=this.options)||void 0===i?void 0:i.document)),!1!==this.options.dropcursor&&v.push(Ph.configure(null===(o=this.options)||void 0===o?void 0:o.dropcursor)),!1!==this.options.gapcursor&&v.push(Vh.configure(null===(a=this.options)||void 0===a?void 0:a.gapcursor)),!1!==this.options.hardBreak&&v.push(Uh.configure(null===(l=this.options)||void 0===l?void 0:l.hardBreak)),!1!==this.options.heading&&v.push(qh.configure(null===(c=this.options)||void 0===c?void 0:c.heading)),!1!==this.options.history&&v.push(hu.configure(null===(d=this.options)||void 0===d?void 0:d.history)),!1!==this.options.horizontalRule&&v.push(uu.configure(null===(h=this.options)||void 0===h?void 0:h.horizontalRule)),!1!==this.options.italic&&v.push(yu.configure(null===(u=this.options)||void 0===u?void 0:u.italic)),!1!==this.options.listItem&&v.push(vu.configure(null===(p=this.options)||void 0===p?void 0:p.listItem)),!1!==this.options.orderedList&&v.push(xu.configure(null===(f=this.options)||void 0===f?void 0:f.orderedList)),!1!==this.options.paragraph&&v.push(ku.configure(null===(m=this.options)||void 0===m?void 0:m.paragraph)),!1!==this.options.strike&&v.push(Tu.configure(null===(g=this.options)||void 0===g?void 0:g.strike)),!1!==this.options.text&&v.push(Ou.configure(null===(y=this.options)||void 0===y?void 0:y.text)),v}}),Nu=(e,t)=>{for(const n in t)e[n]=t[n];return e},Mu="numeric",ju="ascii",_u="alpha",Au="asciinumeric",Du="alphanumeric",Ru="domain",Pu="emoji",Iu="scheme",$u="slashscheme",Lu="whitespace";function Bu(e,t){return e in t||(t[e]=[]),t[e]}function zu(e,t,n){t[Mu]&&(t[Au]=!0,t[Du]=!0),t[ju]&&(t[Au]=!0,t[_u]=!0),t[Au]&&(t[Du]=!0),t[_u]&&(t[Du]=!0),t[Du]&&(t[Ru]=!0),t[Pu]&&(t[Ru]=!0);for(const s in t){const t=Bu(s,n);t.indexOf(e)<0&&t.push(e)}}function Fu(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}Fu.groups={},Fu.prototype={accepts(){return!!this.t},go(e){const t=this,n=t.j[e];if(n)return n;for(let s=0;s<t.jr.length;s++){const n=t.jr[s][0],r=t.jr[s][1];if(r&&n.test(e))return r}return t.jd},has(e,t=!1){return t?e in this.j:!!this.go(e)},ta(e,t,n,s){for(let r=0;r<e.length;r++)this.tt(e[r],t,n,s)},tr(e,t,n,s){let r;return s=s||Fu.groups,t&&t.j?r=t:(r=new Fu(t),n&&s&&zu(t,n,s)),this.jr.push([e,r]),r},ts(e,t,n,s){let r=this;const i=e.length;if(!i)return r;for(let o=0;o<i-1;o++)r=r.tt(e[o]);return r.tt(e[i-1],t,n,s)},tt(e,t,n,s){s=s||Fu.groups;const r=this;if(t&&t.j)return r.j[e]=t,t;const i=t;let o,a=r.go(e);if(a?(o=new Fu,Nu(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Fu,i){if(s)if(o.t&&"string"==typeof o.t){const e=Nu(function(e,t){const n={};for(const s in t)t[s].indexOf(e)>=0&&(n[s]=!0);return n}(o.t,s),n);zu(i,e,s)}else n&&zu(i,n,s);o.t=i}return r.j[e]=o,o}};const Hu=(e,t,n,s,r)=>e.ta(t,n,s,r),Vu=(e,t,n,s,r)=>e.tr(t,n,s,r),Uu=(e,t,n,s,r)=>e.ts(t,n,s,r),qu=(e,t,n,s,r)=>e.tt(t,n,s,r),Wu="WORD",Ju="UWORD",Ku="ASCIINUMERICAL",Gu="ALPHANUMERICAL",Xu="LOCALHOST",Yu="TLD",Qu="UTLD",Zu="SCHEME",ep="SLASH_SCHEME",tp="NUM",np="WS",sp="NL",rp="OPENBRACE",ip="CLOSEBRACE",op="OPENBRACKET",ap="CLOSEBRACKET",lp="OPENPAREN",cp="CLOSEPAREN",dp="OPENANGLEBRACKET",hp="CLOSEANGLEBRACKET",up="FULLWIDTHLEFTPAREN",pp="FULLWIDTHRIGHTPAREN",fp="LEFTCORNERBRACKET",mp="RIGHTCORNERBRACKET",gp="LEFTWHITECORNERBRACKET",yp="RIGHTWHITECORNERBRACKET",vp="FULLWIDTHLESSTHAN",bp="FULLWIDTHGREATERTHAN",wp="AMPERSAND",xp="APOSTROPHE",kp="ASTERISK",Sp="AT",Cp="BACKSLASH",Tp="BACKTICK",Op="CARET",Ep="COLON",Np="COMMA",Mp="DOLLAR",jp="DOT",_p="EQUALS",Ap="EXCLAMATION",Dp="HYPHEN",Rp="PERCENT",Pp="PIPE",Ip="PLUS",$p="POUND",Lp="QUERY",Bp="QUOTE",zp="FULLWIDTHMIDDLEDOT",Fp="SEMI",Hp="SLASH",Vp="TILDE",Up="UNDERSCORE",qp="EMOJI",Wp="SYM";var Jp=Object.freeze({__proto__:null,WORD:Wu,UWORD:Ju,ASCIINUMERICAL:Ku,ALPHANUMERICAL:Gu,LOCALHOST:Xu,TLD:Yu,UTLD:Qu,SCHEME:Zu,SLASH_SCHEME:ep,NUM:tp,WS:np,NL:sp,OPENBRACE:rp,CLOSEBRACE:ip,OPENBRACKET:op,CLOSEBRACKET:ap,OPENPAREN:lp,CLOSEPAREN:cp,OPENANGLEBRACKET:dp,CLOSEANGLEBRACKET:hp,FULLWIDTHLEFTPAREN:up,FULLWIDTHRIGHTPAREN:pp,LEFTCORNERBRACKET:fp,RIGHTCORNERBRACKET:mp,LEFTWHITECORNERBRACKET:gp,RIGHTWHITECORNERBRACKET:yp,FULLWIDTHLESSTHAN:vp,FULLWIDTHGREATERTHAN:bp,AMPERSAND:wp,APOSTROPHE:xp,ASTERISK:kp,AT:Sp,BACKSLASH:Cp,BACKTICK:Tp,CARET:Op,COLON:Ep,COMMA:Np,DOLLAR:Mp,DOT:jp,EQUALS:_p,EXCLAMATION:Ap,HYPHEN:Dp,PERCENT:Rp,PIPE:Pp,PLUS:Ip,POUND:$p,QUERY:Lp,QUOTE:Bp,FULLWIDTHMIDDLEDOT:zp,SEMI:Fp,SLASH:Hp,TILDE:Vp,UNDERSCORE:Up,EMOJI:qp,SYM:Wp});const Kp=/[a-z]/,Gp=new RegExp("\\p{L}","u"),Xp=new RegExp("\\p{Emoji}","u"),Yp=/\d/,Qp=/\s/;let Zp=null,ef=null;function tf(e,t){const n=function(e){const t=[],n=e.length;let s=0;for(;s<n;){let r,i=e.charCodeAt(s),o=i<55296||i>56319||s+1===n||(r=e.charCodeAt(s+1))<56320||r>57343?e[s]:e.slice(s,s+2);t.push(o),s+=o.length}return t}(t.replace(/[A-Z]/g,(e=>e.toLowerCase()))),s=n.length,r=[];let i=0,o=0;for(;o<s;){let a=e,l=null,c=0,d=null,h=-1,u=-1;for(;o<s&&(l=a.go(n[o]));)a=l,a.accepts()?(h=0,u=0,d=a):h>=0&&(h+=n[o].length,u++),c+=n[o].length,i+=n[o].length,o++;i-=h,o-=u,c-=h,r.push({t:d.t,v:t.slice(i-c,i),s:i-c,e:i})}return r}function nf(e,t,n,s,r){let i;const o=t.length;for(let a=0;a<o-1;a++){const n=t[a];e.j[n]?i=e.j[n]:(i=new Fu(s),i.jr=r.slice(),e.j[n]=i),e=i}return i=new Fu(n),i.jr=r.slice(),e.j[t[o-1]]=i,i}function sf(e){const t=[],n=[];let s=0;for(;s<e.length;){let r=0;for(;"0123456789".indexOf(e[s+r])>=0;)r++;if(r>0){t.push(n.join(""));for(let t=parseInt(e.substring(s,s+r),10);t>0;t--)n.pop();s+=r}else n.push(e[s]),s++}return t}const rf={defaultProtocol:"http",events:null,format:af,formatHref:af,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function of(e,t=null){let n=Nu({},rf);e&&(n=Nu(n,e instanceof of?e.o:e));const s=n.ignoreTags,r=[];for(let i=0;i<s.length;i++)r.push(s[i].toUpperCase());this.o=n,t&&(this.defaultRender=t),this.ignoreTags=r}function af(e){return e}function lf(e,t){this.t="token",this.v=e,this.tk=t}function cf(e,t){class n extends lf{constructor(t,n){super(t,n),this.t=e}}for(const s in t)n.prototype[s]=t[s];return n.t=e,n}of.prototype={o:rf,ignoreTags:[],defaultRender:e=>e,check(e){return this.get("validate",e.toString(),e)},get(e,t,n){const s=null!=t;let r=this.o[e];return r?("object"==typeof r?(r=n.t in r?r[n.t]:rf[e],"function"==typeof r&&s&&(r=r(t,n))):"function"==typeof r&&s&&(r=r(t,n.t,n)),r):r},getObj(e,t,n){let s=this.o[e];return"function"==typeof s&&null!=t&&(s=s(t,n.t,n)),s},render(e){const t=e.render(this);return(this.get("render",null,e)||this.defaultRender)(t,e.t,e)}},lf.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const t=this.toString(),n=e.get("truncate",t,this),s=e.get("format",t,this);return n&&s.length>n?s.substring(0,n)+"":s},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=rf.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const t=this,n=this.toHref(e.get("defaultProtocol")),s=e.get("formatHref",n,this),r=e.get("tagName",n,t),i=this.toFormattedString(e),o={},a=e.get("className",n,t),l=e.get("target",n,t),c=e.get("rel",n,t),d=e.getObj("attributes",n,t),h=e.getObj("events",n,t);return o.href=s,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),d&&Nu(o,d),{tagName:r,attributes:o,content:i,eventListeners:h}}};const df=cf("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),hf=cf("text"),uf=cf("nl"),pf=cf("url",{isLink:!0,toHref(e=rf.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==Xu&&e[1].t===Ep}}),ff=e=>new Fu(e);function mf(e,t,n){const s=n[0].s,r=n[n.length-1].e;return new e(t.slice(s,r),n)}const gf="undefined"!=typeof console&&console&&console.warn||(()=>{}),yf={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function vf(e,t=!1){if(yf.initialized&&gf(`linkifyjs: already initialized - will not register custom scheme "${e}" until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(e))throw new Error('linkifyjs: incorrect scheme format.\n1. Must only contain digits, lowercase ASCII letters or "-"\n2. Cannot start or end with "-"\n3. "-" cannot repeat');yf.customSchemes.push([e,t])}function bf(){yf.scanner=function(e=[]){const t={};Fu.groups=t;const n=new Fu;null==Zp&&(Zp=sf("aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2ntley5rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6logistics9properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3ncaster6d0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2psy3ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2")),null==ef&&(ef=sf("121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222")),qu(n,"'",xp),qu(n,"{",rp),qu(n,"}",ip),qu(n,"[",op),qu(n,"]",ap),qu(n,"(",lp),qu(n,")",cp),qu(n,"<",dp),qu(n,">",hp),qu(n,"",up),qu(n,"",pp),qu(n,"",fp),qu(n,"",mp),qu(n,"",gp),qu(n,"",yp),qu(n,"",vp),qu(n,"",bp),qu(n,"&",wp),qu(n,"*",kp),qu(n,"@",Sp),qu(n,"`",Tp),qu(n,"^",Op),qu(n,":",Ep),qu(n,",",Np),qu(n,"$",Mp),qu(n,".",jp),qu(n,"=",_p),qu(n,"!",Ap),qu(n,"-",Dp),qu(n,"%",Rp),qu(n,"|",Pp),qu(n,"+",Ip),qu(n,"#",$p),qu(n,"?",Lp),qu(n,'"',Bp),qu(n,"/",Hp),qu(n,";",Fp),qu(n,"~",Vp),qu(n,"_",Up),qu(n,"\\",Cp),qu(n,"",zp);const s=Vu(n,Yp,tp,{[Mu]:!0});Vu(s,Yp,s);const r=Vu(s,Kp,Ku,{[Au]:!0}),i=Vu(s,Gp,Gu,{[Du]:!0}),o=Vu(n,Kp,Wu,{[ju]:!0});Vu(o,Yp,r),Vu(o,Kp,o),Vu(r,Yp,r),Vu(r,Kp,r);const a=Vu(n,Gp,Ju,{[_u]:!0});Vu(a,Kp),Vu(a,Yp,i),Vu(a,Gp,a),Vu(i,Yp,i),Vu(i,Kp),Vu(i,Gp,i);const l=qu(n,"\n",sp,{[Lu]:!0}),c=qu(n,"\r",np,{[Lu]:!0}),d=Vu(n,Qp,np,{[Lu]:!0});qu(n,"",d),qu(c,"\n",l),qu(c,"",d),Vu(c,Qp,d),qu(d,"\r"),qu(d,"\n"),Vu(d,Qp,d),qu(d,"",d);const h=Vu(n,Xp,qp,{[Pu]:!0});qu(h,"#"),Vu(h,Xp,h),qu(h,"",h);const u=qu(h,"");qu(u,"#"),Vu(u,Xp,h);const p=[[Kp,o],[Yp,r]],f=[[Kp,null],[Gp,a],[Yp,i]];for(let m=0;m<Zp.length;m++)nf(n,Zp[m],Yu,Wu,p);for(let m=0;m<ef.length;m++)nf(n,ef[m],Qu,Ju,f);zu(Yu,{tld:!0,ascii:!0},t),zu(Qu,{utld:!0,alpha:!0},t),nf(n,"file",Zu,Wu,p),nf(n,"mailto",Zu,Wu,p),nf(n,"http",ep,Wu,p),nf(n,"https",ep,Wu,p),nf(n,"ftp",ep,Wu,p),nf(n,"ftps",ep,Wu,p),zu(Zu,{scheme:!0,ascii:!0},t),zu(ep,{slashscheme:!0,ascii:!0},t),e=e.sort(((e,t)=>e[0]>t[0]?1:-1));for(let m=0;m<e.length;m++){const t=e[m][0],s=e[m][1]?{[Iu]:!0}:{[$u]:!0};t.indexOf("-")>=0?s[Ru]=!0:Kp.test(t)?Yp.test(t)?s[Au]=!0:s[ju]=!0:s[Mu]=!0,Uu(n,t,t,s)}return Uu(n,"localhost",Xu,{ascii:!0}),n.jd=new Fu(Wp),{start:n,tokens:Nu({groups:t},Jp)}}(yf.customSchemes);for(let e=0;e<yf.tokenQueue.length;e++)yf.tokenQueue[e][1]({scanner:yf.scanner});yf.parser=function({groups:e}){const t=e.domain.concat([wp,kp,Sp,Cp,Tp,Op,Mp,_p,Dp,tp,Rp,Pp,Ip,$p,Hp,Wp,Vp,Up]),n=[Ep,Np,jp,Ap,Rp,Lp,Bp,Fp,dp,hp,rp,ip,ap,op,lp,cp,up,pp,fp,mp,gp,yp,vp,bp],s=[wp,xp,kp,Cp,Tp,Op,Mp,_p,Dp,rp,ip,Rp,Pp,Ip,$p,Lp,Hp,Wp,Vp,Up],r=ff(),i=qu(r,Vp);Hu(i,s,i),Hu(i,e.domain,i);const o=ff(),a=ff(),l=ff();Hu(r,e.domain,o),Hu(r,e.scheme,a),Hu(r,e.slashscheme,l),Hu(o,s,i),Hu(o,e.domain,o);const c=qu(o,Sp);qu(i,Sp,c),qu(a,Sp,c),qu(l,Sp,c);const d=qu(i,jp);Hu(d,s,i),Hu(d,e.domain,i);const h=ff();Hu(c,e.domain,h),Hu(h,e.domain,h);const u=qu(h,jp);Hu(u,e.domain,h);const p=ff(df);Hu(u,e.tld,p),Hu(u,e.utld,p),qu(c,Xu,p);const f=qu(h,Dp);qu(f,Dp,f),Hu(f,e.domain,h),Hu(p,e.domain,h),qu(p,jp,u),qu(p,Dp,f);const m=qu(p,Ep);Hu(m,e.numeric,df);const g=qu(o,Dp),y=qu(o,jp);qu(g,Dp,g),Hu(g,e.domain,o),Hu(y,s,i),Hu(y,e.domain,o);const v=ff(pf);Hu(y,e.tld,v),Hu(y,e.utld,v),Hu(v,e.domain,o),Hu(v,s,i),qu(v,jp,y),qu(v,Dp,g),qu(v,Sp,c);const b=qu(v,Ep),w=ff(pf);Hu(b,e.numeric,w);const x=ff(pf),k=ff();Hu(x,t,x),Hu(x,n,k),Hu(k,t,x),Hu(k,n,k),qu(v,Hp,x),qu(w,Hp,x);const S=qu(a,Ep),C=qu(l,Ep),T=qu(C,Hp),O=qu(T,Hp);Hu(a,e.domain,o),qu(a,jp,y),qu(a,Dp,g),Hu(l,e.domain,o),qu(l,jp,y),qu(l,Dp,g),Hu(S,e.domain,x),qu(S,Hp,x),qu(S,Lp,x),Hu(O,e.domain,x),Hu(O,t,x),qu(O,Hp,x);const E=[[rp,ip],[op,ap],[lp,cp],[dp,hp],[up,pp],[fp,mp],[gp,yp],[vp,bp]];for(let N=0;N<E.length;N++){const[e,s]=E[N],r=qu(x,e);qu(k,e,r),qu(r,s,x);const i=ff(pf);Hu(r,t,i);const o=ff();Hu(r,n),Hu(i,t,i),Hu(i,n,o),Hu(o,t,i),Hu(o,n,o),qu(i,s,x),qu(o,s,x)}return qu(r,Xu,v),qu(r,sp,uf),{start:r,tokens:Jp}}(yf.scanner.tokens);for(let e=0;e<yf.pluginQueue.length;e++)yf.pluginQueue[e][1]({scanner:yf.scanner,parser:yf.parser});return yf.initialized=!0,yf}function wf(e){return yf.initialized||bf(),function(e,t,n){let s=n.length,r=0,i=[],o=[];for(;r<s;){let a=e,l=null,c=null,d=0,h=null,u=-1;for(;r<s&&!(l=a.go(n[r].t));)o.push(n[r++]);for(;r<s&&(c=l||a.go(n[r].t));)l=null,a=c,a.accepts()?(u=0,h=a):u>=0&&u++,r++,d++;if(u<0)r-=d,r<s&&(o.push(n[r]),r++);else{o.length>0&&(i.push(mf(hf,t,o)),o=[]),r-=u,d-=u;const e=h.t,s=n.slice(r-d,r);i.push(mf(e,t,s))}}return o.length>0&&i.push(mf(hf,t,o)),i}(yf.parser.start,e,tf(yf.scanner.start,e))}function xf(e,t=null,n=null){if(t&&"object"==typeof t){if(n)throw Error(`linkifyjs: Invalid link type ${t}; must be a string`);n=t,t=null}const s=new of(n),r=wf(e),i=[];for(let o=0;o<r.length;o++){const e=r[o];!e.isLink||t&&e.t!==t||!s.check(e)||i.push(e.toFormattedObject(s))}return i}function kf(e){return new Li({key:new Fi("autolink"),appendTransaction:(t,n,s)=>{const r=t.some((e=>e.docChanged))&&!n.doc.eq(s.doc),i=t.some((e=>e.getMeta("preventAutolink")));if(!r||i)return;const{tr:o}=s,a=function(e,t){const n=new yi(e);return t.forEach((e=>{e.steps.forEach((e=>{n.step(e)}))})),n}(n.doc,[...t]),l=function(e){const{mapping:t,steps:n}=e,s=[];return t.maps.forEach(((e,r)=>{const i=[];if(e.ranges.length)e.forEach(((e,t)=>{i.push({from:e,to:t})}));else{const{from:e,to:t}=n[r];if(void 0===e||void 0===t)return;i.push({from:e,to:t})}i.forEach((({from:e,to:n})=>{const i=t.slice(r).map(e,-1),o=t.slice(r).map(n),a=t.invert().map(i,-1),l=t.invert().map(o);s.push({oldRange:{from:a,to:l},newRange:{from:i,to:o}})}))})),Td(s)}(a);return l.forEach((({newRange:t})=>{const n=function(e,t,n){const s=[];return e.nodesBetween(t.from,t.to,((e,t)=>{n(e)&&s.push({node:e,pos:t})})),s}(s.doc,t,(e=>e.isTextblock));let r,i;if(n.length>1?(r=n[0],i=s.doc.textBetween(r.pos,r.pos+r.node.nodeSize,void 0," ")):n.length&&s.doc.textBetween(t.from,t.to," "," ").endsWith(" ")&&(r=n[0],i=s.doc.textBetween(r.pos,t.to,void 0," ")),r&&i){const t=i.split(" ").filter((e=>""!==e));if(t.length<=0)return!1;const n=t[t.length-1],l=r.pos+i.lastIndexOf(n);if(!n)return!1;const c=wf(n).map((t=>t.toObject(e.defaultProtocol)));if(!(1===(a=c).length?a[0].isLink:3===a.length&&a[1].isLink&&["()","[]"].includes(a[0].value+a[2].value)))return!1;c.filter((e=>e.isLink)).map((e=>({...e,from:l+e.start+1,to:l+e.end+1}))).filter((e=>!s.schema.marks.code||!s.doc.rangeHasMark(e.from,e.to,s.schema.marks.code))).filter((t=>e.validate(t.value))).filter((t=>e.shouldAutoLink(t.value))).forEach((t=>{Od(t.from,t.to,s.doc).some((t=>t.mark.type===e.type))||o.addMark(t.from,t.to,e.type.create({href:t.href}))}))}var a})),o.steps.length?o:void 0}})}wf.scan=tf;const Sf=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g;function Cf(e,t){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return t&&t.forEach((e=>{const t="string"==typeof e?e:e.scheme;t&&n.push(t)})),!e||e.replace(Sf,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z+.-]+(?:[^a-z+.-:]|$))`,"i"))}const Tf=Xc.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach((e=>{"string"!=typeof e?vf(e.scheme,e.optionalSlashes):vf(e)}))},onDestroy(){Fu.groups={},yf.scanner=null,yf.parser=null,yf.tokenQueue=[],yf.pluginQueue=[],yf.customSchemes=[],yf.initialized=!1},inclusive(){return this.options.autolink},addOptions:()=>({openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(e,t)=>!!Cf(e,t.protocols),validate:e=>!!e,shouldAutoLink:e=>!!e}),addAttributes(){return{href:{default:null,parseHTML:e=>e.getAttribute("href")},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:e=>{const t=e.getAttribute("href");return!(!t||!this.options.isAllowedUri(t,{defaultValidate:e=>!!Cf(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol}))&&null}}]},renderHTML({HTMLAttributes:e}){return this.options.isAllowedUri(e.href,{defaultValidate:e=>!!Cf(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Pc(this.options.HTMLAttributes,e),0]:["a",Pc(this.options.HTMLAttributes,{...e,href:""}),0]},addCommands(){return{setLink:e=>({chain:t})=>{const{href:n}=e;return!!this.options.isAllowedUri(n,{defaultValidate:e=>!!Cf(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&t().setMark(this.name,e).setMeta("preventAutolink",!0).run()},toggleLink:e=>({chain:t})=>{const{href:n}=e;return!!this.options.isAllowedUri(n,{defaultValidate:e=>!!Cf(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&t().toggleMark(this.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:e})=>e().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Kd({find:e=>{const t=[];if(e){const{protocols:n,defaultProtocol:s}=this.options,r=xf(e).filter((e=>e.isLink&&this.options.isAllowedUri(e.value,{defaultValidate:e=>!!Cf(e,n),protocols:n,defaultProtocol:s})));r.length&&r.forEach((e=>t.push({text:e.value,data:{href:e.href},index:e.start})))}return t},type:this.type,getAttributes:e=>{var t;return{href:null===(t=e.data)||void 0===t?void 0:t.href}}})]},addProseMirrorPlugins(){const e=[],{protocols:t,defaultProtocol:n}=this.options;return this.options.autolink&&e.push(kf({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:e=>this.options.isAllowedUri(e,{defaultValidate:e=>!!Cf(e,t),protocols:t,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),!0===this.options.openOnClick&&e.push(function(e){return new Li({key:new Fi("handleClickLink"),props:{handleClick:(t,n,s)=>{var r,i;if(0!==s.button)return!1;if(!t.editable)return!1;let o=s.target;const a=[];for(;"DIV"!==o.nodeName;)a.push(o),o=o.parentNode;if(!a.find((e=>"A"===e.nodeName)))return!1;const l=Cd(t.state,e.type.name),c=s.target,d=null!==(r=null==c?void 0:c.href)&&void 0!==r?r:l.href,h=null!==(i=null==c?void 0:c.target)&&void 0!==i?i:l.target;return!(!c||!d||(window.open(d,h),0))}}})}({type:this.type})),this.options.linkOnPaste&&e.push(function(e){return new Li({key:new Fi("handlePasteLink"),props:{handlePaste:(t,n,s)=>{const{state:r}=t,{selection:i}=r,{empty:o}=i;if(o)return!1;let a="";s.content.forEach((e=>{a+=e.textContent}));const l=xf(a,{defaultProtocol:e.defaultProtocol}).find((e=>e.isLink&&e.value===a));return!(!a||!l)&&e.editor.commands.setMark(e.type,{href:l.href})}}})}({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),e}});function Of({content:e,onChange:t,placeholder:n}){const s=fh({extensions:[Eu.configure({paragraph:{HTMLAttributes:{class:"mb-4"}},codeBlock:{HTMLAttributes:{class:"bg-gray-50 p-4 rounded-lg font-mono text-sm mb-4"}}}),Tf.configure({openOnClick:!0,linkOnPaste:!0,HTMLAttributes:{class:"text-blue-500 hover:underline",rel:"noopener noreferrer",target:"_blank"},validate:e=>/^https?:\/\//.test(e)})],content:e,onUpdate:({editor:e})=>{t(e.getHTML())},editorProps:{attributes:{class:"prose max-w-none focus:outline-none min-h-[150px]"}}});return s?A.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[A.jsxs("div",{className:"bg-gray-50 border-b p-2 flex flex-wrap gap-1",children:[A.jsx("button",{onClick:()=>s.chain().focus().toggleBold().run(),className:"p-2 rounded hover:bg-gray-100 "+(s.isActive("bold")?"bg-gray-200":""),title:"Bold",children:A.jsx(f,{size:18})}),A.jsx("button",{onClick:()=>s.chain().focus().toggleItalic().run(),className:"p-2 rounded hover:bg-gray-100 "+(s.isActive("italic")?"bg-gray-200":""),title:"Italic",children:A.jsx(m,{size:18})}),A.jsx("button",{onClick:()=>s.chain().focus().toggleBulletList().run(),className:"p-2 rounded hover:bg-gray-100 "+(s.isActive("bulletList")?"bg-gray-200":""),title:"Bullet List",children:A.jsx(h,{size:18})}),A.jsx("button",{onClick:()=>s.chain().focus().toggleOrderedList().run(),className:"p-2 rounded hover:bg-gray-100 "+(s.isActive("orderedList")?"bg-gray-200":""),title:"Numbered List",children:A.jsx(g,{size:18})}),A.jsx("button",{onClick:()=>{const e=null==s?void 0:s.getAttributes("link").href,t=window.prompt("Enter URL",e);if(null===t)return;if(""===t)return void(null==s||s.chain().focus().extendMarkRange("link").unsetLink().run());const n=t.match(/^https?:\/\//)?t:`https://${t}`;null==s||s.chain().focus().extendMarkRange("link").setLink({href:n}).run()},className:"p-2 rounded hover:bg-gray-100 "+(s.isActive("link")?"bg-gray-200":""),title:"Add Link",children:A.jsx(y,{size:18})}),s.isActive("link")&&A.jsx("button",{onClick:()=>{null==s||s.chain().focus().unsetLink().run()},className:"p-2 rounded hover:bg-gray-100",title:"Remove Link",children:A.jsx(v,{size:18})}),A.jsx("button",{onClick:()=>{const e=window.prompt("Enter embed URL (e.g., YouTube embed URL)");if(e){const t=`<iframe src="${e}" frameborder="0" allowfullscreen class="w-full aspect-video rounded-lg mb-4"></iframe>`;null==s||s.chain().focus().insertContent(t).run()}},className:"p-2 rounded hover:bg-gray-100",title:"Add Embed (iframe)",children:A.jsx(b,{size:18})})]}),A.jsx(rh,{editor:s,className:"p-4"})]}):null}function Ef({data:e,onChange:t,onSave:n}){const s=(n,s)=>{t({...e,[n]:s})};return A.jsxs("form",{onSubmit:t=>{t.preventDefault(),n(e)},className:"space-y-8",children:[A.jsx("div",{className:"flex justify-between items-center mb-8",children:A.jsx("h2",{className:"text-2xl font-light",children:"Edit Case Study"})}),A.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[A.jsxs("div",{children:[A.jsx("label",{htmlFor:"title",className:"form-label",children:"Title"}),A.jsx("input",{type:"text",id:"title",value:e.title||"",onChange:e=>s("title",e.target.value),className:"form-input"})]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"client",className:"form-label",children:"Client"}),A.jsx("input",{type:"text",id:"client",value:e.client||"",onChange:e=>s("client",e.target.value),className:"form-input"})]})]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"thumbnail",className:"form-label",children:"Thumbnail Image"}),A.jsxs("div",{className:"space-y-4",children:[A.jsx("input",{type:"file",id:"thumbnail",accept:"image/*",onChange:e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];if(n){const e=new FileReader;e.onloadend=()=>{s("thumbnailImage",e.result)},e.readAsDataURL(n)}},className:"form-input"}),e.thumbnailImage&&A.jsx("img",{src:e.thumbnailImage,alt:"Thumbnail preview",className:"w-full max-w-md aspect-video object-cover rounded-lg"})]})]}),A.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[A.jsxs("div",{children:[A.jsx("label",{htmlFor:"year",className:"form-label",children:"Year"}),A.jsx("input",{type:"text",id:"year",value:e.year||"",onChange:e=>s("year",e.target.value),className:"form-input"})]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"role",className:"form-label",children:"Role"}),A.jsx("input",{type:"text",id:"role",value:e.role||"",onChange:e=>s("role",e.target.value),className:"form-input"})]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"duration",className:"form-label",children:"Duration"}),A.jsx("input",{type:"text",id:"duration",value:e.duration||"",onChange:e=>s("duration",e.target.value),className:"form-input"})]})]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"team",className:"form-label",children:"Team"}),A.jsx("input",{type:"text",id:"team",value:e.team||"",onChange:e=>s("team",e.target.value),className:"form-input"})]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"challenge",className:"form-label",children:"Challenge"}),A.jsx(Of,{content:e.challenge||"",onChange:e=>s("challenge",e),placeholder:"Describe the challenge..."})]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"solution",className:"form-label",children:"Solution"}),A.jsx(Of,{content:e.solution||"",onChange:e=>s("solution",e),placeholder:"Describe the solution..."})]}),A.jsxs("div",{children:[A.jsx("label",{className:"form-label",children:"Impact"}),(e.impact||[]).map(((t,n)=>A.jsxs("div",{className:"flex gap-2 mb-2",children:[A.jsx("input",{type:"text",value:t,onChange:t=>{const r=[...e.impact||[]];r[n]=t.target.value,s("impact",r)},className:"form-input"}),A.jsx("button",{type:"button",onClick:()=>{const t=(e.impact||[]).filter(((e,t)=>t!==n));s("impact",t)},className:"px-3 py-2 text-red-500 hover:bg-red-50 rounded",children:"Remove"})]},n))),A.jsx("button",{type:"button",onClick:()=>s("impact",[...e.impact||[],""]),className:"btn-secondary mt-2",children:"Add Impact"})]}),A.jsxs("div",{children:[A.jsx("label",{className:"form-label",children:"Process"}),(e.process||[]).map(((t,n)=>A.jsx("div",{className:"border p-4 rounded-lg mb-4",children:A.jsxs("div",{className:"space-y-4",children:[A.jsx("input",{type:"text",value:t.title||"",onChange:r=>{const i=[...e.process||[]];i[n]={...t,title:r.target.value},s("process",i)},placeholder:"Phase Title",className:"form-input"}),A.jsxs("div",{children:[A.jsx("label",{className:"form-label",children:"Phase Image"}),A.jsx("input",{type:"file",accept:"image/*",onChange:t=>((t,n)=>{var r;const i=null==(r=t.target.files)?void 0:r[0];if(i){const t=new FileReader;t.onloadend=()=>{const r=[...e.process||[]];r[n]={...r[n],image:t.result},s("process",r)},t.readAsDataURL(i)}})(t,n),className:"form-input"}),t.image&&A.jsx("img",{src:t.image,alt:t.title||"Preview",className:"mt-2 w-full max-w-md aspect-video object-cover rounded"})]}),A.jsx(Of,{content:t.description||"",onChange:r=>{const i=[...e.process||[]];i[n]={...t,description:r},s("process",i)},placeholder:"Description..."}),A.jsx("button",{type:"button",onClick:()=>{const t=(e.process||[]).filter(((e,t)=>t!==n));s("process",t)},className:"text-red-500 hover:bg-red-50 px-3 py-2 rounded",children:"Remove Phase"})]})},n))),A.jsx("button",{type:"button",onClick:()=>s("process",[...e.process||[],{title:"",description:"",image:""}]),className:"btn-secondary",children:"Add Process Phase"})]}),A.jsx("div",{className:"flex justify-end space-x-4",children:A.jsx("button",{type:"submit",className:"btn",children:"Save Case Study"})})]})}function Nf({data:e}){const t=e.impact||[],n=e.process||[];return A.jsxs("div",{className:"prose max-w-none",children:[A.jsx("h2",{className:"text-2xl font-light mb-8",children:"Preview"}),A.jsxs("article",{className:"space-y-12",children:[A.jsxs("header",{className:"space-y-8",children:[A.jsx("h1",{className:"text-4xl font-light",children:e.title||""}),A.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[A.jsxs("div",{children:[A.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Client"}),A.jsx("p",{children:e.client||""})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Role"}),A.jsx("p",{children:e.role||""})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Duration"}),A.jsx("p",{children:e.duration||""})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Team"}),A.jsx("p",{children:e.team||""})]})]})]}),A.jsxs("section",{className:"space-y-4",children:[A.jsx("h2",{className:"text-2xl font-light",children:"Challenge"}),A.jsx("div",{className:"text-gray-600 prose",dangerouslySetInnerHTML:{__html:e.challenge||""}})]}),A.jsxs("section",{className:"space-y-4",children:[A.jsx("h2",{className:"text-2xl font-light",children:"Solution"}),A.jsx("div",{className:"text-gray-600 prose",dangerouslySetInnerHTML:{__html:e.solution||""}})]}),A.jsxs("section",{className:"space-y-4",children:[A.jsx("h2",{className:"text-2xl font-light",children:"Impact"}),A.jsx("ul",{className:"space-y-2",children:t.map(((e,t)=>A.jsx("li",{className:"text-gray-600",children:e},t)))})]}),A.jsxs("section",{className:"space-y-8",children:[A.jsx("h2",{className:"text-2xl font-light",children:"Process"}),n.map(((e,t)=>A.jsxs("div",{className:"space-y-4",children:[A.jsx("h3",{className:"text-xl",children:e.title||""}),e.image&&A.jsx("img",{src:e.image,alt:e.title||"Process phase",className:"w-full aspect-video object-cover"}),A.jsx("div",{className:"text-gray-600 prose",dangerouslySetInnerHTML:{__html:e.description||""}})]},t)))]})]})]})}function Mf({studies:e,selectedId:t,onSelect:n}){return A.jsxs("select",{value:t,onChange:e=>n(e.target.value),className:"form-input max-w-xs",children:[A.jsx("option",{value:"",children:"Select a case study"}),Object.entries(e).map((([e,t])=>A.jsx("option",{value:e,children:t.title},e)))]})}let jf,_f,Af,Df={data:""},Rf=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Pf=/\/\*[^]*?\*\/|  +/g,If=/\n+/g,$f=(e,t)=>{let n="",s="",r="";for(let i in e){let o=e[i];"@"==i[0]?"i"==i[1]?n=i+" "+o+";":s+="f"==i[1]?$f(o,i):i+"{"+$f(o,"k"==i[1]?"":t)+"}":"object"==typeof o?s+=$f(o,t?t.replace(/([^,])+/g,(e=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,(t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)))):i):null!=o&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),r+=$f.p?$f.p(i,o):i+":"+o+";")}return n+(t&&r?t+"{"+r+"}":r)+s},Lf={},Bf=e=>{if("object"==typeof e){let t="";for(let n in e)t+=n+Bf(e[n]);return t}return e};function zf(e){let t=this||{},n=e.call?e(t.p):e;return((e,t,n,s,r)=>{let i=Bf(e),o=Lf[i]||(Lf[i]=(e=>{let t=0,n=11;for(;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n})(i));if(!Lf[o]){let t=i!==e?e:(e=>{let t,n,s=[{}];for(;t=Rf.exec(e.replace(Pf,""));)t[4]?s.shift():t[3]?(n=t[3].replace(If," ").trim(),s.unshift(s[0][n]=s[0][n]||{})):s[0][t[1]]=t[2].replace(If," ").trim();return s[0]})(e);Lf[o]=$f(r?{["@keyframes "+o]:t}:t,n?"":"."+o)}let a=n&&Lf.g?Lf.g:null;return n&&(Lf.g=Lf[o]),l=Lf[o],c=t,d=s,(h=a)?c.data=c.data.replace(h,l):-1===c.data.indexOf(l)&&(c.data=d?l+c.data:c.data+l),o;var l,c,d,h})(n.unshift?n.raw?((e,t,n)=>e.reduce(((e,s,r)=>{let i=t[r];if(i&&i.call){let e=i(n),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;i=t?"."+t:e&&"object"==typeof e?e.props?"":$f(e,""):!1===e?"":e}return e+s+(null==i?"":i)}),""))(n,[].slice.call(arguments,1),t.p):n.reduce(((e,n)=>Object.assign(e,n&&n.call?n(t.p):n)),{}):n,(s=t.target,"object"==typeof window?((s?s.querySelector("#_goober"):window._goober)||Object.assign((s||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:s||Df),t.g,t.o,t.k);var s}zf.bind({g:1});let Ff=zf.bind({k:1});function Hf(e,t){let n=this||{};return function(){let t=arguments;return function s(r,i){let o=Object.assign({},r),a=o.className||s.className;n.p=Object.assign({theme:_f&&_f()},o),n.o=/ *go\d+/.test(a),o.className=zf.apply(n,t)+(a?" "+a:"");let l=e;return e[0]&&(l=o.as||e,delete o.as),Af&&l[0]&&Af(o),jf(l,o)}}}var Vf=(e,t)=>(e=>"function"==typeof e)(e)?e(t):e,Uf=(()=>{let e=0;return()=>(++e).toString()})(),qf=(()=>{let e;return()=>{if(void 0===e&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),Wf=new Map,Jf=e=>{if(Wf.has(e))return;let t=setTimeout((()=>{Wf.delete(e),Yf({type:4,toastId:e})}),1e3);Wf.set(e,t)},Kf=(e,t)=>{switch(t.type){case 0:return{...e,toasts:[t.toast,...e.toasts].slice(0,20)};case 1:return t.toast.id&&(e=>{let t=Wf.get(e);t&&clearTimeout(t)})(t.toast.id),{...e,toasts:e.toasts.map((e=>e.id===t.toast.id?{...e,...t.toast}:e))};case 2:let{toast:n}=t;return e.toasts.find((e=>e.id===n.id))?Kf(e,{type:1,toast:n}):Kf(e,{type:0,toast:n});case 3:let{toastId:s}=t;return s?Jf(s):e.toasts.forEach((e=>{Jf(e.id)})),{...e,toasts:e.toasts.map((e=>e.id===s||void 0===s?{...e,visible:!1}:e))};case 4:return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter((e=>e.id!==t.toastId))};case 5:return{...e,pausedAt:t.time};case 6:let r=t.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map((e=>({...e,pauseDuration:e.pauseDuration+r})))}}},Gf=[],Xf={toasts:[],pausedAt:void 0},Yf=e=>{Xf=Kf(Xf,e),Gf.forEach((e=>{e(Xf)}))},Qf={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Zf=e=>(t,n)=>{let s=((e,t="blank",n)=>({createdAt:Date.now(),visible:!0,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...n,id:(null==n?void 0:n.id)||Uf()}))(t,e,n);return Yf({type:2,toast:s}),s.id},em=(e,t)=>Zf("blank")(e,t);em.error=Zf("error"),em.success=Zf("success"),em.loading=Zf("loading"),em.custom=Zf("custom"),em.dismiss=e=>{Yf({type:3,toastId:e})},em.remove=e=>Yf({type:4,toastId:e}),em.promise=(e,t,n)=>{let s=em.loading(t.loading,{...n,...null==n?void 0:n.loading});return e.then((e=>(em.success(Vf(t.success,e),{id:s,...n,...null==n?void 0:n.success}),e))).catch((e=>{em.error(Vf(t.error,e),{id:s,...n,...null==n?void 0:n.error})})),e};var tm,nm,sm,rm,im=(e,t)=>{Yf({type:1,toast:{id:e,height:t}})},om=()=>{Yf({type:5,time:Date.now()})},am=t=>{let{toasts:n,pausedAt:s}=((t={})=>{let[n,s]=e.useState(Xf);e.useEffect((()=>(Gf.push(s),()=>{let e=Gf.indexOf(s);e>-1&&Gf.splice(e,1)})),[n]);let r=n.toasts.map((e=>{var n,s;return{...t,...t[e.type],...e,duration:e.duration||(null==(n=t[e.type])?void 0:n.duration)||(null==t?void 0:t.duration)||Qf[e.type],style:{...t.style,...null==(s=t[e.type])?void 0:s.style,...e.style}}}));return{...n,toasts:r}})(t);e.useEffect((()=>{if(s)return;let e=Date.now(),t=n.map((t=>{if(t.duration===1/0)return;let n=(t.duration||0)+t.pauseDuration-(e-t.createdAt);if(!(n<0))return setTimeout((()=>em.dismiss(t.id)),n);t.visible&&em.dismiss(t.id)}));return()=>{t.forEach((e=>e&&clearTimeout(e)))}}),[n,s]);let r=e.useCallback((()=>{s&&Yf({type:6,time:Date.now()})}),[s]),i=e.useCallback(((e,t)=>{let{reverseOrder:s=!1,gutter:r=8,defaultPosition:i}=t||{},o=n.filter((t=>(t.position||i)===(e.position||i)&&t.height)),a=o.findIndex((t=>t.id===e.id)),l=o.filter(((e,t)=>t<a&&e.visible)).length;return o.filter((e=>e.visible)).slice(...s?[l+1]:[0,l]).reduce(((e,t)=>e+(t.height||0)+r),0)}),[n]);return{toasts:n,handlers:{updateHeight:im,startPause:om,endPause:r,calculateOffset:i}}},lm=Ff`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,cm=Ff`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,dm=Ff`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,hm=Hf("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${lm} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${cm} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${dm} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,um=Ff`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,pm=Hf("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${um} 1s linear infinite;
`,fm=Ff`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,mm=Ff`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,gm=Hf("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${fm} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${mm} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,ym=Hf("div")`
  position: absolute;
`,vm=Hf("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,bm=Ff`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,wm=Hf("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${bm} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,xm=({toast:t})=>{let{icon:n,type:s,iconTheme:r}=t;return void 0!==n?"string"==typeof n?e.createElement(wm,null,n):n:"blank"===s?null:e.createElement(vm,null,e.createElement(pm,{...r}),"loading"!==s&&e.createElement(ym,null,"error"===s?e.createElement(hm,{...r}):e.createElement(gm,{...r})))},km=e=>`\n0% {transform: translate3d(0,${-200*e}%,0) scale(.6); opacity:.5;}\n100% {transform: translate3d(0,0,0) scale(1); opacity:1;}\n`,Sm=e=>`\n0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}\n100% {transform: translate3d(0,${-150*e}%,-1px) scale(.6); opacity:0;}\n`,Cm=Hf("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Tm=Hf("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Om=e.memo((({toast:t,position:n,style:s,children:r})=>{let i=t.height?((e,t)=>{let n=e.includes("top")?1:-1,[s,r]=qf()?["0%{opacity:0;} 100%{opacity:1;}","0%{opacity:1;} 100%{opacity:0;}"]:[km(n),Sm(n)];return{animation:t?`${Ff(s)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Ff(r)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}})(t.position||n||"top-center",t.visible):{opacity:0},o=e.createElement(xm,{toast:t}),a=e.createElement(Tm,{...t.ariaProps},Vf(t.message,t));return e.createElement(Cm,{className:t.className,style:{...i,...s,...t.style}},"function"==typeof r?r({icon:o,message:a}):e.createElement(e.Fragment,null,o,a))}));tm=e.createElement,$f.p=nm,jf=tm,_f=sm,Af=rm;var Em=({id:t,className:n,style:s,onHeightUpdate:r,children:i})=>{let o=e.useCallback((e=>{if(e){let n=()=>{let n=e.getBoundingClientRect().height;r(t,n)};n(),new MutationObserver(n).observe(e,{subtree:!0,childList:!0,characterData:!0})}}),[t,r]);return e.createElement("div",{ref:o,className:n,style:s},i)},Nm=zf`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Mm=({reverseOrder:t,position:n="top-center",toastOptions:s,gutter:r,children:i,containerStyle:o,containerClassName:a})=>{let{toasts:l,handlers:c}=am(s);return e.createElement("div",{style:{position:"fixed",zIndex:9999,top:16,left:16,right:16,bottom:16,pointerEvents:"none",...o},className:a,onMouseEnter:c.startPause,onMouseLeave:c.endPause},l.map((s=>{let o=s.position||n,a=((e,t)=>{let n=e.includes("top"),s=n?{top:0}:{bottom:0},r=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:qf()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(n?1:-1)}px)`,...s,...r}})(o,c.calculateOffset(s,{reverseOrder:t,gutter:r,defaultPosition:n}));return e.createElement(Em,{id:s.id,key:s.id,onHeightUpdate:c.updateHeight,className:s.visible?Nm:"",style:a},"custom"===s.type?Vf(s.message,s):i?i(s):e.createElement(Om,{toast:s,position:o}))})))},jm=em;function _m(){const[t,n]=e.useState({}),[s,r]=e.useState({id:"",title:"",client:"",year:"",role:"",duration:"",team:"",challenge:"",solution:"",impact:[],process:[],thumbnailImage:""}),[i,o]=e.useState(!0);e.useEffect((()=>{a()}),[]);const a=async()=>{try{const{data:e,error:t}=await as.from("case_studies").select('\n          *,\n          case_study_phases (\n            title,\n            description,\n            image,\n            "order"\n          )\n        ').order("created_at",{ascending:!1});if(t)throw t;if(e){const t={};e.forEach((e=>{const n=e.case_study_phases||[];n.sort(((e,t)=>e.order-t.order)),t[e.id]={id:e.id,title:e.title||"",client:e.client||"",year:e.year||"",role:e.role||"",duration:e.duration||"",team:e.team||"",challenge:e.challenge||"",solution:e.solution||"",impact:e.impact||[],thumbnailImage:e.thumbnail_image||"",process:n.map((e=>({title:e.title||"",description:e.description||"",image:e.image||""})))}})),n(t),!s.id&&e.length>0&&r(t[e[0].id])}}catch(e){console.error("Error loading case studies:",e),jm.error("Failed to load case studies")}finally{o(!1)}};return i?A.jsx("div",{className:"min-h-screen flex items-center justify-center",children:A.jsx("div",{className:"text-xl text-gray-600",children:"Loading..."})}):A.jsx("div",{className:"min-h-screen bg-gray-50",children:A.jsxs("div",{className:"max-w-screen-2xl mx-auto p-8",children:[A.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[A.jsx("h2",{className:"text-2xl font-light",children:"Edit Case Study"}),A.jsxs("div",{className:"flex items-center gap-4",children:[A.jsx(Mf,{studies:t,selectedId:s.id,onSelect:e=>{t[e]&&r(t[e])}}),A.jsx("button",{onClick:()=>{r({id:"",title:"",client:"",year:"",role:"",duration:"",team:"",challenge:"",solution:"",impact:[],process:[],thumbnailImage:""})},className:"btn-secondary",children:"New Case Study"})]})]}),A.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[A.jsx("div",{className:"bg-white p-8 rounded-lg shadow-sm",children:A.jsx(Ef,{data:s,onChange:r,onSave:async()=>{try{if(!s.title)return void jm.error("Please enter a title");const e=s.id||s.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),{error:t}=await as.from("case_studies").upsert({id:e,title:s.title,client:s.client,year:s.year,role:s.role,duration:s.duration,team:s.team,challenge:s.challenge,solution:s.solution,impact:s.impact,thumbnail_image:s.thumbnailImage});if(t)throw t;const{error:i}=await as.from("case_study_phases").delete().eq("case_study_id",e);if(i)throw i;if(s.process&&s.process.length>0){const t=s.process.map(((t,n)=>({case_study_id:e,title:t.title,description:t.description,image:t.image,order:n}))),{error:n}=await as.from("case_study_phases").insert(t);if(n)throw n}n((t=>({...t,[e]:{...s,id:e}}))),r((t=>({...t,id:e}))),jm.success("Case study saved successfully!")}catch(e){console.error("Error saving case study:",e),jm.error("Failed to save case study")}},lastSaved:null})}),A.jsx("div",{className:"bg-white p-8 rounded-lg shadow-sm",children:A.jsx(Nf,{data:s})})]})]})})}function Am(){const[t,n]=e.useState("admin@example.com"),[s,r]=e.useState(""),[i,a]=e.useState(!1),l=o();return A.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:A.jsxs("div",{className:"max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-sm",children:[A.jsxs("div",{children:[A.jsx("h2",{className:"text-3xl font-light text-center mb-8",children:"Admin Login"}),A.jsx("p",{className:"text-center text-gray-600 mb-8",children:"Please sign in with your Supabase credentials"})]}),A.jsxs("form",{className:"space-y-6",onSubmit:async e=>{e.preventDefault(),a(!0);try{const{error:e}=await as.auth.signInWithPassword({email:t,password:s});if(e)throw e;jm.success("Welcome back!"),l("/admin/dashboard")}catch(n){console.error("Login error:",n);let e="Login failed. Please try again.";n.message.includes("Invalid login credentials")&&(e="Incorrect email or password. Please try again."),jm.error(e)}finally{a(!1)}},children:[A.jsxs("div",{children:[A.jsx("label",{htmlFor:"email",className:"form-label",children:"Email"}),A.jsx("input",{id:"email",type:"email",required:!0,className:"form-input",value:t,onChange:e=>n(e.target.value)})]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"password",className:"form-label",children:"Password"}),A.jsx("input",{id:"password",type:"password",required:!0,className:"form-input",value:s,onChange:e=>r(e.target.value),placeholder:"Enter password"})]}),A.jsx("button",{type:"submit",className:"btn w-full",disabled:i,children:i?"Signing in...":"Sign in"})]})]})})}function Dm(){return A.jsx("div",{className:"min-h-screen bg-white",children:A.jsxs("article",{className:"max-w-4xl mx-auto px-4 py-24 space-y-24",children:[A.jsxs("header",{className:"space-y-12",children:[A.jsx("h1",{className:"text-5xl font-light",children:"New Product Startup"}),A.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-8",children:[A.jsxs("div",{children:[A.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Client"}),A.jsx("p",{children:"Confidential"})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Role"}),A.jsx("p",{children:"Lead Product Designer"})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Duration"}),A.jsx("p",{children:"4 months"})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Team"}),A.jsx("p",{children:"3 Engineers, Product Manager"})]})]})]}),A.jsxs("section",{className:"space-y-8",children:[A.jsx("h2",{className:"text-3xl font-light",children:"Challenge"}),A.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"A startup approached us with a vision for a revolutionary product in the smart home space. They needed to validate their concept, understand user needs, and create a compelling MVP that would attract both users and investors."})]}),A.jsxs("section",{className:"space-y-8",children:[A.jsx("h2",{className:"text-3xl font-light",children:"Solution"}),A.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"We developed a comprehensive product strategy and design system that enabled rapid iteration and testing. Through user research and prototyping, we refined the concept into a viable product that resonated with target users while maintaining technical feasibility."})]}),A.jsxs("section",{className:"space-y-8",children:[A.jsx("h2",{className:"text-3xl font-light",children:"Impact"}),A.jsxs("ul",{className:"space-y-4",children:[A.jsx("li",{className:"text-xl text-gray-600",children:"Successfully raised $2.5M in seed funding"}),A.jsx("li",{className:"text-xl text-gray-600",children:"Achieved 92% user satisfaction in beta testing"}),A.jsx("li",{className:"text-xl text-gray-600",children:"Reduced development time by 40% through systematic design approach"}),A.jsx("li",{className:"text-xl text-gray-600",children:"Featured in TechCrunch and Product Hunt"})]})]}),A.jsxs("section",{className:"space-y-12",children:[A.jsx("h2",{className:"text-3xl font-light",children:"Process"}),A.jsxs("div",{className:"space-y-6",children:[A.jsx("h3",{className:"text-2xl",children:"Discovery & Research"}),A.jsx("img",{src:"https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2940&q=80",alt:"Team collaborating on research",className:"w-full max-w-[800px] aspect-[16/9] object-cover rounded-lg"}),A.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"We conducted extensive user interviews, competitive analysis, and market research to understand the landscape and identify opportunities. This phase helped validate core assumptions and refine the product vision."})]}),A.jsxs("div",{className:"space-y-6",children:[A.jsx("h3",{className:"text-2xl",children:"Concept Development"}),A.jsx("img",{src:"https://images.unsplash.com/photo-1531403009284-440f080d1e12?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2940&q=80",alt:"Wireframes and sketches",className:"w-full max-w-[800px] aspect-[16/9] object-cover rounded-lg"}),A.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Through rapid prototyping and iteration, we explored various concepts and interaction models. Weekly design sprints helped us quickly validate ideas and pivot based on feedback."})]}),A.jsxs("div",{className:"space-y-6",children:[A.jsx("h3",{className:"text-2xl",children:"Design System"}),A.jsx("img",{src:"https://images.unsplash.com/photo-1581291518857-4e27b48ff24e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2940&q=80",alt:"Design system components",className:"w-full max-w-[800px] aspect-[16/9] object-cover rounded-lg"}),A.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"We created a comprehensive design system that ensured consistency across the product while enabling rapid development. This included a component library, interaction patterns, and documentation."})]}),A.jsxs("div",{className:"space-y-6",children:[A.jsx("h3",{className:"text-2xl",children:"Testing & Refinement"}),A.jsx("img",{src:"https://images.unsplash.com/photo-1522071820081-009f0129c71c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2940&q=80",alt:"User testing session",className:"w-full max-w-[800px] aspect-[16/9] object-cover rounded-lg"}),A.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Through multiple rounds of user testing, we refined the product based on real user feedback. This iterative process helped us identify and fix usability issues while validating our design decisions."})]})]})]})})}function Rm(){const[t,n]=e.useState(!1);return e.useEffect((()=>{n(!0)}),[]),A.jsx("h1",{className:"text-xl font-bold mb-16 cursor-pointer whitespace-nowrap text-gray-600",children:A.jsx("div",{className:"inline-flex overflow-hidden",children:["D","A","V","I","D","","","M","A","T","A","Y","O","S","H","I"].map(((e,n)=>A.jsx("span",{className:"transition-all duration-700 ease-in-out",style:{opacity:t?1:0,transform:t?"translateX(0)":"translateX(-100%)",width:"auto",transitionDelay:50*n+"ms"},children:e},n)))})})}const Pm=[{id:"intro",label:"Intro"},{id:"work",label:"Work"},{id:"values",label:"Values"},{id:"background",label:"Background"},{id:"references",label:"Recommendations"},{id:"contact",label:"Contact"}];function Im({activeTab:e,onTabChange:t}){return a(),A.jsx("nav",{className:"w-full",children:A.jsx("ul",{className:"flex flex-col space-y-3",children:Pm.map((n=>A.jsx("li",{children:A.jsx("button",{onClick:()=>t(n.id),className:"nav-link w-full text-left "+(e===n.id?"active":""),children:n.label})},n.id)))})})}function $m({isOpen:t,onClose:n,children:s}){return e.useEffect((()=>{const e=e=>{"Escape"===e.key&&n()};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}}),[t,n]),t?A.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[A.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm",onClick:n}),A.jsxs("div",{className:"relative w-full max-w-4xl max-h-[90vh] bg-white rounded-[23.33px] shadow-xl overflow-hidden",children:[A.jsx("button",{onClick:n,className:"absolute top-6 right-6 p-2 hover:bg-gray-100 rounded-full transition-colors z-10","aria-label":"Close modal",children:A.jsx(w,{size:24})}),A.jsx("div",{className:"relative overflow-y-auto h-[90vh]",children:A.jsx("div",{className:"p-8 pr-32",children:s})})]})]}):null}function Lm(){const[t,n]=e.useState("intro"),[s,r]=e.useState(null),[i,o]=e.useState(!1);!function(t,n={threshold:[.2,.5,.8],rootMargin:"-20% 0px -20% 0px"}){const s=e.useRef(null),r=e.useRef("");e.useEffect((()=>(s.current=new IntersectionObserver((e=>{const n=e.filter((e=>e.isIntersecting)).sort(((e,t)=>t.intersectionRatio-e.intersectionRatio));if(n.length>0){const e=n[0],s=e.target.id;s!==r.current&&e.intersectionRatio>.2&&(r.current=s,t(s))}}),n),document.querySelectorAll("section[id]").forEach((e=>{var t;return null==(t=s.current)?void 0:t.observe(e)})),()=>{s.current&&s.current.disconnect()})),[t,n])}(e.useCallback((e=>{requestAnimationFrame((()=>{n(e)}))}),[]));const a=()=>{r(null)};return e.useEffect((()=>{const e=e=>{const t=document.getElementById("mobile-nav"),n=document.getElementById("mobile-menu-button");t&&!t.contains(e.target)&&n&&!n.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]),A.jsxs("div",{className:"min-h-screen flex bg-white overflow-x-hidden",children:[A.jsx("button",{id:"mobile-menu-button",onClick:()=>o(!i),className:"lg:hidden fixed top-4 left-4 z-50 p-2 bg-white rounded-lg shadow-sm","aria-label":"Toggle menu",children:i?A.jsx(w,{size:24}):A.jsx(x,{size:24})}),A.jsx("div",{id:"mobile-nav",className:`\n          fixed inset-y-0 left-0 w-64 bg-white shadow-lg\n          transform transition-transform duration-300 ease-in-out z-40\n          lg:relative lg:transform-none lg:shadow-none\n          ${i?"translate-x-0":"-translate-x-full lg:translate-x-0"}\n        `,children:A.jsxs("div",{className:"fixed w-64 h-screen flex flex-col p-8",children:[A.jsx(Rm,{}),A.jsx("div",{className:"flex-1",children:A.jsx(Im,{activeTab:t,onTabChange:e=>{const t=document.getElementById(e);t&&(t.scrollIntoView({behavior:"smooth"}),requestAnimationFrame((()=>{n(e)}))),o(!1)}})})]})}),A.jsxs("main",{className:"flex-1 relative w-full",children:[A.jsx("div",{className:"p-4 sm:p-6 lg:p-8",children:A.jsxs("div",{className:"space-y-[calc(100vh-80px)]",children:[A.jsx("section",{id:"intro",className:"min-h-[calc(100vh-80px)] flex items-start",children:A.jsx(L,{})}),A.jsx("section",{id:"work",className:"min-h-[calc(100vh-80px)] flex items-center",children:A.jsx(ds,{onCaseStudyClick:e=>{r(e)}})}),A.jsx("section",{id:"values",className:"min-h-[calc(100vh-80px)] flex items-center",children:A.jsx(us,{})}),A.jsx("section",{id:"background",className:"min-h-[calc(100vh-80px)] flex items-center",children:A.jsx(ms,{})}),A.jsx("section",{id:"references",className:"min-h-[calc(100vh-80px)] flex items-center",children:A.jsx(ys,{})}),A.jsx("section",{id:"contact",className:"min-h-[calc(100vh-80px)] flex items-center",children:A.jsx(vs,{})})]})}),A.jsx($m,{isOpen:null!==s,onClose:a,children:s&&A.jsx(bs,{id:s,onClose:a})})]})]})}function Bm(){return A.jsx(l,{children:A.jsxs(P,{children:[A.jsxs(c,{children:[A.jsx(d,{path:"/admin",element:A.jsx(Am,{})}),A.jsx(d,{path:"/admin/dashboard",element:A.jsx(_m,{})}),A.jsx(d,{path:"/case-studies/new-product-startup",element:A.jsx(Dm,{})}),A.jsx(d,{path:"/*",element:A.jsx(Lm,{})})]}),A.jsx(Mm,{position:"bottom-right"})]})})}const zm=document.getElementById("root");if(!zm)throw new Error("Failed to find the root element");_(zm).render(A.jsx(r.StrictMode,{children:A.jsx(Bm,{})}));
